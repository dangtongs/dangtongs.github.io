<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <meta name="powered-by" content="https://github.com/menduo/mdtree">
    <title>Learning Kubernetes</title>
    <style>
        #sidebar:hover,pre{overflow:auto}#footer,#footer a{color:#eee}body{padding:40px}#layout>header,.btns{width:auto}#sidebar{width:400px;height:100%;position:fixed;top:0;right:0;overflow:hidden;background:#fff;z-index:100;padding:18px;border:1px solid #ddd;border-top:none;border-bottom:none}#sidebar h1{font-size:16px}#sidebar a,#sidebar a:visited{color:#4183c4}#sidebar a:hover{font-size:120%;color:#1e90ff}#custom-toc-container{padding-left:0;padding-bottom:20px}#content-container{padding-left:0;padding-right:430px;margin:0}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto}pre{background-color:#f8f8f8;border:1px solid #ccc;font-size:13px;line-height:19px;padding:6px 10px;border-radius:3px}
#footer{margin:30px auto 10px;}
#generated-at{margin-top:30px;}

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     /** code highliting start **/
.codehilite .hll{background-color:#ffc}.codehilite{background:#f8f8f8}.codehilite .c{color:#408080;font-style:italic}.codehilite .err{border:1px solid red}.codehilite .k{color:green;font-weight:700}.codehilite .o{color:#666}.codehilite .ch,.codehilite .cm{color:#408080;font-style:italic}.codehilite .cp{color:#BC7A00}.codehilite .c1,.codehilite .cpf,.codehilite .cs{color:#408080;font-style:italic}.codehilite .gd{color:#A00000}.codehilite .ge{font-style:italic}.codehilite .gr{color:red}.codehilite .gh{color:navy;font-weight:700}.codehilite .gi{color:#00A000}.codehilite .go{color:#888}.codehilite .gp{color:navy;font-weight:700}.codehilite .gs{font-weight:700}.codehilite .gu{color:purple;font-weight:700}.codehilite .gt{color:#04D}.codehilite .kc,.codehilite .kd,.codehilite .kn{color:green;font-weight:700}.codehilite .kp{color:green}.codehilite .kr{color:green;font-weight:700}.codehilite .kt{color:#B00040}.codehilite .m{color:#666}.codehilite .s{color:#BA2121}.codehilite .na{color:#7D9029}.codehilite .nb{color:green}.codehilite .nc{color:#00F;font-weight:700}.codehilite .no{color:#800}.codehilite .nd{color:#A2F}.codehilite .ni{color:#999;font-weight:700}.codehilite .ne{color:#D2413A;font-weight:700}.codehilite .nf{color:#00F}.codehilite .nl{color:#A0A000}.codehilite .nn{color:#00F;font-weight:700}.codehilite .nt{color:green;font-weight:700}.codehilite .nv{color:#19177C}.codehilite .ow{color:#A2F;font-weight:700}.codehilite .w{color:#bbb}.codehilite .mb,.codehilite .mf,.codehilite .mh,.codehilite .mi,.codehilite .mo{color:#666}.codehilite .s2,.codehilite .sb,.codehilite .sc{color:#BA2121}.codehilite .sd{color:#BA2121;font-style:italic}.codehilite .se{color:#B62;font-weight:700}.codehilite .sh{color:#BA2121}.codehilite .si{color:#B68;font-weight:700}.codehilite .sx{color:green}.codehilite .sr{color:#B68}.codehilite .s1{color:#BA2121}.codehilite .ss{color:#19177C}.codehilite .bp{color:green}.codehilite .vc,.codehilite .vg,.codehilite .vi{color:#19177C}.codehilite .il{color:#666}

/** code highliting end **/
/** css from https://github.com/pandao/editor.md */
@font-face {
  font-family: octicons-anchor;
  src: url(data:font/woff;charset=utf-8;base64,d09GRgABAAAAAAYcAA0AAAAACjQAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABGRlRNAAABMAAAABwAAAAca8vGTk9TLzIAAAFMAAAARAAAAFZG1VHVY21hcAAAAZAAAAA+AAABQgAP9AdjdnQgAAAB0AAAAAQAAAAEACICiGdhc3AAAAHUAAAACAAAAAj//wADZ2x5ZgAAAdwAAADRAAABEKyikaNoZWFkAAACsAAAAC0AAAA2AtXoA2hoZWEAAALgAAAAHAAAACQHngNFaG10eAAAAvwAAAAQAAAAEAwAACJsb2NhAAADDAAAAAoAAAAKALIAVG1heHAAAAMYAAAAHwAAACABEAB2bmFtZQAAAzgAAALBAAAFu3I9x/Nwb3N0AAAF/AAAAB0AAAAvaoFvbwAAAAEAAAAAzBdyYwAAAADP2IQvAAAAAM/bz7t4nGNgZGFgnMDAysDB1Ml0hoGBoR9CM75mMGLkYGBgYmBlZsAKAtJcUxgcPsR8iGF2+O/AEMPsznAYKMwIkgMA5REMOXicY2BgYGaAYBkGRgYQsAHyGMF8FgYFIM0ChED+h5j//yEk/3KoSgZGNgYYk4GRCUgwMaACRoZhDwCs7QgGAAAAIgKIAAAAAf//AAJ4nHWMMQrCQBBF/0zWrCCIKUQsTDCL2EXMohYGSSmorScInsRGL2DOYJe0Ntp7BK+gJ1BxF1stZvjz/v8DRghQzEc4kIgKwiAppcA9LtzKLSkdNhKFY3HF4lK69ExKslx7Xa+vPRVS43G98vG1DnkDMIBUgFN0MDXflU8tbaZOUkXUH0+U27RoRpOIyCKjbMCVejwypzJJG4jIwb43rfl6wbwanocrJm9XFYfskuVC5K/TPyczNU7b84CXcbxks1Un6H6tLH9vf2LRnn8Ax7A5WQAAAHicY2BkYGAA4teL1+yI57f5ysDNwgAC529f0kOmWRiYVgEpDgYmEA8AUzEKsQAAAHicY2BkYGB2+O/AEMPCAAJAkpEBFbAAADgKAe0EAAAiAAAAAAQAAAAEAAAAAAAAKgAqACoAiAAAeJxjYGRgYGBhsGFgYgABEMkFhAwM/xn0QAIAD6YBhwB4nI1Ty07cMBS9QwKlQapQW3VXySvEqDCZGbGaHULiIQ1FKgjWMxknMfLEke2A+IJu+wntrt/QbVf9gG75jK577Lg8K1qQPCfnnnt8fX1NRC/pmjrk/zprC+8D7tBy9DHgBXoWfQ44Av8t4Bj4Z8CLtBL9CniJluPXASf0Lm4CXqFX8Q84dOLnMB17N4c7tBo1AS/Qi+hTwBH4rwHHwN8DXqQ30XXAS7QaLwSc0Gn8NuAVWou/gFmnjLrEaEh9GmDdDGgL3B4JsrRPDU2hTOiMSuJUIdKQQayiAth69r6akSSFqIJuA19TrzCIaY8sIoxyrNIrL//pw7A2iMygkX5vDj+G+kuoLdX4GlGK/8Lnlz6/h9MpmoO9rafrz7ILXEHHaAx95s9lsI7AHNMBWEZHULnfAXwG9/ZqdzLI08iuwRloXE8kfhXYAvE23+23DU3t626rbs8/8adv+9DWknsHp3E17oCf+Z48rvEQNZ78paYM38qfk3v/u3l3u3GXN2Dmvmvpf1Srwk3pB/VSsp512bA/GG5i2WJ7wu430yQ5K3nFGiOqgtmSB5pJVSizwaacmUZzZhXLlZTq8qGGFY2YcSkqbth6aW1tRmlaCFs2016m5qn36SbJrqosG4uMV4aP2PHBmB3tjtmgN2izkGQyLWprekbIntJFing32a5rKWCN/SdSoga45EJykyQ7asZvHQ8PTm6cslIpwyeyjbVltNikc2HTR7YKh9LBl9DADC0U/jLcBZDKrMhUBfQBvXRzLtFtjU9eNHKin0x5InTqb8lNpfKv1s1xHzTXRqgKzek/mb7nB8RZTCDhGEX3kK/8Q75AmUM/eLkfA+0Hi908Kx4eNsMgudg5GLdRD7a84npi+YxNr5i5KIbW5izXas7cHXIMAau1OueZhfj+cOcP3P8MNIWLyYOBuxL6DRylJ4cAAAB4nGNgYoAALjDJyIAOWMCiTIxMLDmZedkABtIBygAAAA==) format("woff");
}
.markdown-body hr:after,.markdown-body hr:before{display:table;content:""}.markdown-body ol,.markdown-body td,.markdown-body th,.markdown-body ul{padding:0}.markdown-body{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;color:#333;overflow:hidden;font-family:"Microsoft YaHei",Helvetica,"Meiryo UI","Malgun Gothic","Segoe UI","Trebuchet MS",Monaco,monospace,Tahoma,STXihei,"åŽæ–‡ç»†é»‘",STHeiti,"Helvetica Neue","Droid Sans","wenquanyi micro hei",FreeSans,Arimo,Arial,SimSun,"å®‹ä½“",Heiti,"é»‘ä½“",sans-serif;font-size:16px;line-height:1.6;word-wrap:break-word}.markdown-body strong{font-weight:700}.markdown-body h1{margin:.67em 0}.markdown-body img{border:0}.markdown-body hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}.markdown-body input{color:inherit;margin:0;line-height:normal;font:13px/1.4 Helvetica,arial,freesans,clean,sans-serif,"Segoe UI Emoji","Segoe UI Symbol"}.markdown-body html input[disabled]{cursor:default}.markdown-body input[type=checkbox]{-moz-box-sizing:border-box;box-sizing:border-box;padding:0}.markdown-body *{-moz-box-sizing:border-box;box-sizing:border-box}.markdown-body a{background:0 0;color:#4183c4;text-decoration:none}.markdown-body a:active,.markdown-body a:hover{outline:0;text-decoration:underline}.markdown-body hr{margin:15px 0;overflow:hidden;background:0 0;border:0;border-bottom:1px solid #ddd}.markdown-body hr:after{clear:both}.markdown-body blockquote{margin:0}.markdown-body h1,.markdown-body h2{padding-bottom:.3em;border-bottom:1px solid #eee}.markdown-body ol ol,.markdown-body ul ol{list-style-type:lower-roman}.markdown-body ol ol ol,.markdown-body ol ul ol,.markdown-body ul ol ol,.markdown-body ul ul ol{list-style-type:lower-alpha}.markdown-body .task-list-item,li.L0,li.L1,li.L2,li.L3,li.L5,li.L6,li.L7,li.L8{list-style-type:none}.markdown-body dd{margin-left:0}.markdown-body code{font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace}.markdown-body pre{font:12px Consolas,"Liberation Mono",Menlo,Courier,monospace;word-wrap:normal}.markdown-body .octicon{font:normal normal 16px octicons-anchor;line-height:1;display:inline-block;text-decoration:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-body .octicon-link:before{content:'\f05c'}.markdown-body>:first-child{margin-top:0!important}.markdown-body>:last-child{margin-bottom:0!important}.markdown-body .anchor{position:absolute;top:0;left:0;display:block;padding-right:6px;padding-left:30px;margin-left:-30px}.markdown-body .anchor:focus{outline:0}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{position:relative;margin-top:1em;margin-bottom:16px;font-weight:700;line-height:1.4}.markdown-body h1 .octicon-link,.markdown-body h2 .octicon-link,.markdown-body h3 .octicon-link,.markdown-body h4 .octicon-link,.markdown-body h5 .octicon-link,.markdown-body h6 .octicon-link{display:none;color:#000;vertical-align:middle}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{padding-left:8px;margin-left:-30px;text-decoration:none}.markdown-body h1:hover .anchor .octicon-link,.markdown-body h2:hover .anchor .octicon-link,.markdown-body h3:hover .anchor .octicon-link,.markdown-body h4:hover .anchor .octicon-link,.markdown-body h5:hover .anchor .octicon-link,.markdown-body h6:hover .anchor .octicon-link{display:inline-block}.markdown-body h1{font-size:2.25em;line-height:1.2}.markdown-body h1 .anchor{line-height:1}.markdown-body h2{font-size:1.75em;line-height:1.225}.markdown-body h2 .anchor{line-height:1}.markdown-body h3{font-size:1.5em;line-height:1.43}.markdown-body h3 .anchor,.markdown-body h4 .anchor{line-height:1.2}.markdown-body h4{font-size:1.25em}.markdown-body h5 .anchor,.markdown-body h6 .anchor{line-height:1.1}.markdown-body h5{font-size:1em}.markdown-body h6{font-size:1em;color:#777}.markdown-body blockquote,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-top:0;margin-bottom:16px}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:0;margin-bottom:0}.markdown-body li>p{margin-top:16px}.markdown-body dl{padding:0}.markdown-body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}.markdown-body dl dd{padding:0 16px;margin-bottom:16px}.markdown-body blockquote{padding:0 15px;color:#777;border-left:4px solid #ddd}.markdown-body blockquote>:first-child{margin-top:0}.markdown-body blockquote>:last-child{margin-bottom:0}.markdown-body table{border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}.markdown-body table th{font-weight:700}.markdown-body table td,.markdown-body table th{padding:6px 13px;border:1px solid #ddd}.markdown-body table tr{background-color:#fff;border-top:1px solid #ccc}.markdown-body table tr:nth-child(2n){background-color:#f8f8f8}.markdown-body img{max-width:100%;-moz-box-sizing:border-box;box-sizing:border-box}.markdown-body code{padding:.2em 0;margin:0;font-size:85%;background-color:rgba(0,0,0,.04);border-radius:3px}.markdown-body code:after,.markdown-body code:before{letter-spacing:-.2em;content:"\00a0"}.markdown-body pre>code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:0 0;border:0}.markdown-body .highlight{margin-bottom:16px}.markdown-body .highlight pre,.markdown-body pre{padding:16px;overflow:auto;font-size:85%;background-color:#f7f7f7;border-radius:3px}.markdown-body .highlight pre{margin-bottom:0;word-break:normal}.markdown-body pre code{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}.markdown-body pre code:after,.markdown-body pre code:before{content:normal}.markdown-body .pl-c{color:#969896}.markdown-body .pl-c1,.markdown-body .pl-mdh,.markdown-body .pl-mm,.markdown-body .pl-mp,.markdown-body .pl-mr,.markdown-body .pl-s1 .pl-v,.markdown-body .pl-s3,.markdown-body .pl-sc,.markdown-body .pl-sv{color:#0086b3}.markdown-body .pl-e,.markdown-body .pl-en{color:#795da3}.markdown-body .pl-s1 .pl-s2,.markdown-body .pl-smi,.markdown-body .pl-smp,.markdown-body .pl-stj,.markdown-body .pl-vo,.markdown-body .pl-vpf{color:#333}.markdown-body .pl-ent{color:#63a35c}.markdown-body .pl-k,.markdown-body .pl-s,.markdown-body .pl-st{color:#a71d5d}.markdown-body .pl-pds,.markdown-body .pl-s1,.markdown-body .pl-s1 .pl-pse .pl-s2,.markdown-body .pl-sr,.markdown-body .pl-sr .pl-cce,.markdown-body .pl-sr .pl-sra,.markdown-body .pl-sr .pl-sre,.markdown-body .pl-src{color:#df5000}.markdown-body .pl-mo,.markdown-body .pl-v{color:#1d3e81}.markdown-body .pl-id{color:#b52a1d}.markdown-body .pl-ii{background-color:#b52a1d;color:#f8f8f8}.markdown-body .pl-sr .pl-cce{color:#63a35c;font-weight:700}.markdown-body .pl-ml{color:#693a17}.markdown-body .pl-mh,.markdown-body .pl-mh .pl-en,.markdown-body .pl-ms{color:#1d3e81;font-weight:700}.markdown-body .pl-mq{color:teal}.markdown-body .pl-mi{color:#333;font-style:italic}.markdown-body .pl-mb{color:#333;font-weight:700}.markdown-body .pl-md,.markdown-body .pl-mdhf{background-color:#ffecec;color:#bd2c00}.markdown-body .pl-mdht,.markdown-body .pl-mi1{background-color:#eaffea;color:#55a532}.markdown-body .pl-mdr{color:#795da3;font-weight:700}.markdown-body kbd{display:inline-block;padding:3px 5px;font:11px Consolas,"Liberation Mono",Menlo,Courier,monospace;line-height:10px;color:#555;vertical-align:middle;background-color:#fcfcfc;border:1px solid #ccc;border-bottom-color:#bbb;border-radius:3px;box-shadow:inset 0 -1px 0 #bbb}.markdown-body .task-list-item+.task-list-item{margin-top:3px}.markdown-body .task-list-item input{float:left;margin:.3em 0 .25em -1.6em;vertical-align:middle}.markdown-body :checked+.radio-label{z-index:1;position:relative;border-color:#4183c4}.editormd-html-preview,.editormd-preview-container{text-align:left;font-size:14px;line-height:1.6;padding:20px;overflow:auto;width:100%;background-color:#fff}.editormd-html-preview blockquote,.editormd-preview-container blockquote{color:#666;border-left:4px solid #ddd;padding-left:20px;margin-left:0;font-size:14px;font-style:italic}.editormd-html-preview p code,.editormd-preview-container p code{margin-left:5px;margin-right:4px}.editormd-html-preview abbr,.editormd-preview-container abbr{background:#ffd}.editormd-html-preview hr,.editormd-preview-container hr{height:1px;border:none;border-top:1px solid #ddd;background:0 0}.editormd-html-preview code,.editormd-preview-container code{border:1px solid #ddd;background:#f6f6f6;padding:3px;border-radius:3px;font-size:14px}.editormd-html-preview pre,.editormd-preview-container pre{border:1px solid #ddd;background:#f6f6f6;padding:10px;-webkit-border-radius:3px;-moz-border-radius:3px;-ms-border-radius:3px;-o-border-radius:3px;border-radius:3px}.editormd-html-preview pre code,.editormd-preview-container pre code{padding:0}.editormd-html-preview code,.editormd-html-preview kbd,.editormd-html-preview pre,.editormd-preview-container code,.editormd-preview-container kbd,.editormd-preview-container pre{font-family:"YaHei Consolas Hybrid",Consolas,"Meiryo UI","Malgun Gothic","Segoe UI","Trebuchet MS",Helvetica,monospace,monospace}.editormd-html-preview table thead tr,.editormd-preview-container table thead tr{background-color:#F8F8F8}.editormd-html-preview p.editormd-tex,.editormd-preview-container p.editormd-tex{text-align:center}.editormd-html-preview span.editormd-tex,.editormd-preview-container span.editormd-tex{margin:0 5px}.editormd-html-preview .emoji,.editormd-preview-container .emoji{width:24px;height:24px}.editormd-html-preview .katex,.editormd-preview-container .katex{font-size:1.4em}.editormd-html-preview .flowchart,.editormd-html-preview .sequence-diagram,.editormd-preview-container .flowchart,.editormd-preview-container .sequence-diagram{margin:0 auto;text-align:center}.editormd-html-preview .flowchart svg,.editormd-html-preview .sequence-diagram svg,.editormd-preview-container .flowchart svg,.editormd-preview-container .sequence-diagram svg{margin:0 auto}.editormd-html-preview .flowchart text,.editormd-html-preview .sequence-diagram text,.editormd-preview-container .flowchart text,.editormd-preview-container .sequence-diagram text{font-size:15px!important;font-family:"YaHei Consolas Hybrid",Consolas,"Microsoft YaHei","Malgun Gothic","Segoe UI",Helvetica,Arial!important}/*! Pretty printing styles. Used with prettify.js. */.pln{color:#000}@media screen{.str{color:#080}.kwd{color:#008}.com{color:#800}.typ{color:#606}.lit{color:#066}.clo,.opn,.pun{color:#660}.tag{color:#008}.atn{color:#606}.atv{color:#080}.dec,.var{color:#606}.fun{color:red}}@media print,projection{.kwd,.tag,.typ{font-weight:700}.str{color:#060}.kwd{color:#006}.com{color:#600;font-style:italic}.typ{color:#404}.lit{color:#044}.clo,.opn,.pun{color:#440}.tag{color:#006}.atn{color:#404}.atv{color:#060}}pre.prettyprint{padding:2px;border:1px solid #888}ol.linenums{margin-top:0;margin-bottom:0}li.L1,li.L3,li.L5,li.L7,li.L9{background:#eee}.editormd-html-preview pre.prettyprint,.editormd-preview-container pre.prettyprint{padding:10px;border:1px solid #ddd;white-space:pre-wrap;word-wrap:break-word}.editormd-html-preview ol.linenums,.editormd-preview-container ol.linenums{color:#999;padding-left:2.5em}.editormd-html-preview ol.linenums li,.editormd-preview-container ol.linenums li{list-style-type:decimal}.editormd-html-preview ol.linenums li code,.editormd-preview-container ol.linenums li code{border:none;background:0 0;padding:0}.editormd-html-preview .editormd-toc-menu,.editormd-preview-container .editormd-toc-menu{margin:8px 0 12px;display:inline-block}.editormd-html-preview .editormd-toc-menu>.markdown-toc,.editormd-preview-container .editormd-toc-menu>.markdown-toc{position:relative;-webkit-border-radius:4px;-moz-border-radius:4px;-ms-border-radius:4px;-o-border-radius:4px;border-radius:4px;border:1px solid #ddd;display:inline-block;font-size:1em}.editormd-html-preview .editormd-toc-menu>.markdown-toc>ul,.editormd-preview-container .editormd-toc-menu>.markdown-toc>ul{width:160%;min-width:180px;position:absolute;left:-1px;top:-2px;z-index:100;padding:0 10px 10px;display:none;background:#fff;border:1px solid #ddd;-webkit-border-radius:4px;-moz-border-radius:4px;-ms-border-radius:4px;-o-border-radius:4px;border-radius:4px;-webkit-box-shadow:0 3px 5px rgba(0,0,0,.2);-moz-box-shadow:0 3px 5px rgba(0,0,0,.2);-ms-box-shadow:0 3px 5px rgba(0,0,0,.2);-o-box-shadow:0 3px 5px rgba(0,0,0,.2);box-shadow:0 3px 5px rgba(0,0,0,.2)}.editormd-html-preview .editormd-toc-menu>.markdown-toc>ul>li ul,.editormd-preview-container .editormd-toc-menu>.markdown-toc>ul>li ul{width:100%;min-width:180px;border:1px solid #ddd;display:none;background:#fff;-webkit-border-radius:4px;-moz-border-radius:4px;-ms-border-radius:4px;-o-border-radius:4px;border-radius:4px}.editormd-html-preview .editormd-toc-menu .toc-menu-btn:hover,.editormd-html-preview .editormd-toc-menu>.markdown-toc>ul>li a:hover,.editormd-preview-container .editormd-toc-menu .toc-menu-btn:hover,.editormd-preview-container .editormd-toc-menu>.markdown-toc>ul>li a:hover{background-color:#f6f6f6}.editormd-html-preview .editormd-toc-menu>.markdown-toc>ul>li a,.editormd-preview-container .editormd-toc-menu>.markdown-toc>ul>li a{color:#666;padding:6px 10px;display:block;-webkit-transition:background-color .5s ease-out;-moz-transition:background-color .5s ease-out;transition:background-color .5s ease-out}.editormd-html-preview .editormd-toc-menu>.markdown-toc li,.editormd-preview-container .editormd-toc-menu>.markdown-toc li{position:relative}.editormd-html-preview .editormd-toc-menu>.markdown-toc li>ul,.editormd-preview-container .editormd-toc-menu>.markdown-toc li>ul{position:absolute;top:32px;left:10%;display:none;-webkit-box-shadow:0 3px 5px rgba(0,0,0,.2);-moz-box-shadow:0 3px 5px rgba(0,0,0,.2);-ms-box-shadow:0 3px 5px rgba(0,0,0,.2);-o-box-shadow:0 3px 5px rgba(0,0,0,.2);box-shadow:0 3px 5px rgba(0,0,0,.2)}.editormd-html-preview .editormd-toc-menu>.markdown-toc li>ul:after,.editormd-html-preview .editormd-toc-menu>.markdown-toc li>ul:before,.editormd-preview-container .editormd-toc-menu>.markdown-toc li>ul:after,.editormd-preview-container .editormd-toc-menu>.markdown-toc li>ul:before{pointer-events:pointer-events;position:absolute;left:15px;top:-6px;display:block;content:"";width:0;height:0;border:6px solid transparent;border-width:0 6px 6px;z-index:10}.editormd-html-preview .editormd-toc-menu>.markdown-toc li>ul:before,.editormd-preview-container .editormd-toc-menu>.markdown-toc li>ul:before{border-bottom-color:#ccc}.editormd-html-preview .editormd-toc-menu>.markdown-toc li>ul:after,.editormd-preview-container .editormd-toc-menu>.markdown-toc li>ul:after{border-bottom-color:#fff;top:-5px}.editormd-html-preview .editormd-toc-menu ul,.editormd-preview-container .editormd-toc-menu ul{list-style:none}.editormd-html-preview .editormd-toc-menu a,.editormd-preview-container .editormd-toc-menu a{text-decoration:none}.editormd-html-preview .editormd-toc-menu h1,.editormd-preview-container .editormd-toc-menu h1{font-size:16px;padding:5px 0 10px 10px;line-height:1;border-bottom:1px solid #eee}.editormd-html-preview .editormd-toc-menu h1 .fa,.editormd-preview-container .editormd-toc-menu h1 .fa{padding-left:10px}.editormd-html-preview .editormd-toc-menu .toc-menu-btn,.editormd-preview-container .editormd-toc-menu .toc-menu-btn{color:#666;min-width:180px;padding:5px 10px;border-radius:4px;display:inline-block;-webkit-transition:background-color .5s ease-out;-moz-transition:background-color .5s ease-out;transition:background-color .5s ease-out}.editormd-html-preview .editormd-toc-menu .toc-menu-btn .fa,.editormd-preview-container .editormd-toc-menu .toc-menu-btn .fa{float:right;padding:3px 0 0 10px;font-size:1.3em}.markdown-body .editormd-toc-menu ul{padding-left:0}.markdown-body .highlight pre,.markdown-body pre{line-height:1.6}hr.editormd-page-break{border:1px dotted #ccc;font-size:0;height:2px}@media only print{hr.editormd-page-break{background:0 0;border:none;height:0}}.editormd-html-preview textarea{display:none}.editormd-html-preview hr.editormd-page-break{background:0 0;border:none;height:0}.editormd-preview-close-btn{color:#fff;padding:4px 6px;font-size:18px;-webkit-border-radius:500px;-moz-border-radius:500px;-ms-border-radius:500px;-o-border-radius:500px;border-radius:500px;display:none;background-color:#ccc;position:absolute;top:25px;right:35px;z-index:19;-webkit-transition:background-color .3s ease-out;-moz-transition:background-color .3s ease-out;transition:background-color .3s ease-out}.editormd-preview-close-btn:hover{background-color:#999}.editormd-preview-active{width:100%;padding:40px}



    </style>
    
</head>
<body>
<div id="layout">
        <div id="sidebar">
            <h1>Table of Contents</h1>
            <div id="custom-toc-container">
                <div class="toc">
<ul>
<li><a href="#learning-kubernetes">Learning Kubernetes</a><ul>
<li><a href="#3">3. 도커 기본 다지기</a><ul>
<li><a href="#31">3.1 도커 설치하기</a><ul>
<li><a href="#311-ubuntu">3.1.1 Ubuntu 설치</a></li>
<li><a href="#312-centos-6">3.1.2 CentOS 6</a></li>
<li><a href="#313-centos-7">3.1.3 CentOS 7</a></li>
</ul>
</li>
<li><a href="#32">3.2 도커 기본 명령어</a><ul>
<li><a href="#321-hub">3.2.1 도커 hub 사용을 위한 계정생성</a></li>
<li><a href="#322">3.2.2 도커 이미지 검색</a></li>
<li><a href="#323">3.2.3 도커 이미지 다운로드</a></li>
<li><a href="#324">3.2.4 도커 이미지 목록 보기</a></li>
</ul>
</li>
<li><a href="#33">3.3 도커 이미지 생성 하기</a><ul>
<li><a href="#331-application">3.3.1 서비스를 위한 Application 코드 작성</a></li>
<li><a href="#332-dockerfile">3.3.2 이미지 생성을 위한 Dockerfile 작성</a></li>
<li><a href="#333">3.3.3 컨테이너 이미지 생성</a></li>
</ul>
</li>
<li><a href="#34">3.4 도커 컨테이너 시작 및 서비스 확인</a><ul>
<li><a href="#341">3.4.1 도커 컨테이너 시작</a></li>
<li><a href="#342">3.4.2 도커 컨테이스 서비스 확인</a></li>
<li><a href="#343">3.4.3 도커 프로세서 확인</a></li>
<li><a href="#344">3.4.4 프로세서 상세 정보 출력</a></li>
<li><a href="#345-docker">3.4.5 Docker 컨테이너 접속</a></li>
<li><a href="#346">3.4.6 도커 인스턴스 중단 및 삭제</a></li>
</ul>
</li>
<li><a href="#35">3.5. 도커 이미지를 도커 허브에 업로드</a><ul>
<li><a href="#351-tag">3.5.1  도커 허브양식에 맞게 tag 수정하기</a></li>
<li><a href="#352">3.5.2 도커 허브에 이미지 업로드 하기</a></li>
<li><a href="#353">3.5.3  도커 허브의 이미지로 컨테이너 실행</a></li>
</ul>
</li>
<li><a href="#exercise-1">[Exercise #1]</a></li>
</ul>
</li>
<li><a href="#4">4. 쿠버네티스 간단하게 맛보기</a><ul>
<li><a href="#41">4.1 도커 허브 이미지로 컨테이너 생성 및 확인</a></li>
</ul>
</li>
<li><a href="#5-pods">5. PODS</a><ul>
<li><a href="#51-pod">5.1 POD 기본</a></li>
<li><a href="#51-pod-yaml">5.1 POD 설정을 yaml 파일로 가져오기</a></li>
<li><a href="#52-pod-yaml">5.2 POD 생성을 위한 YAML 파일 만들기</a></li>
<li><a href="#53-yaml-pod">5.3  YAML 파일을 이용한 POD 생성 및 확인</a></li>
<li><a href="#54-pod-container">5.4 POD 및 Container 로그 확인</a></li>
<li><a href="#exercise-2">[Exercise #2]</a></li>
</ul>
</li>
<li><a href="#6-lable">6. Lable</a><ul>
<li><a href="#61-lable-pod">6.1 Lable 정보를 추가해서 POD 생성하기</a></li>
<li><a href="#62-pod-yaml">6.2 생성된 POD 로 부터 yaml 파일 얻기</a></li>
<li><a href="#63-lable-pod">6.3 Lable을 이용한 POD 스케줄링</a></li>
</ul>
</li>
<li><a href="#7-annotation">7.   Annotation</a><ul>
<li><a href="#71-pod-annotation">7.1 POD 에 Annotation 추가하기</a></li>
<li><a href="#72-annotation">7.2 Annotation 확인하기</a></li>
<li><a href="#73-annotation">7.3 Annotation 삭제</a></li>
<li><a href="#exercise-3">[[Exercise #3]]</a></li>
</ul>
</li>
<li><a href="#8-namespace">8. Namespace</a><ul>
<li><a href="#81">8.1 네임스페이스 조회</a></li>
<li><a href="#82-pod">8.2 특정 네임스페이스의 POD 조회</a></li>
<li><a href="#83-yaml">8.3 YAML 파일을 이용한 네임스페이스 생성</a></li>
<li><a href="#84-pod">8.4 특정 네임스페이스에 POD 생성</a></li>
<li><a href="#85-pod">8.5 POD 삭제</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_1">네임스페이스 설정</a></li>
<li><a href="#_2">확인</a><ul>
<li><a href="#exercise-4">[[ Exercise #4 ]]</a></li>
<li><a href="#9-kubectl">9. kubectl 기본 사용법</a><ul>
<li><a href="#91">9.1 단축형 키워드 사용하기</a></li>
<li><a href="#92">9.2 도움말 보기</a></li>
<li><a href="#93">9.3 리소스 정의에 대한 도움말</a></li>
<li><a href="#94">9.4 리소스 감시하기</a></li>
<li><a href="#95">9.5 리소스 비교하기</a></li>
<li><a href="#96-kubectx-kubens">9.6 kubectx 및 kubens 사용하기</a><ul>
<li><a href="#961-kubectx-kubens">9.6.1 kubectx 및 kubens 설치</a></li>
<li><a href="#962-kubectx-kubens">9.6.2 kubectx 및 kubens 사용</a></li>
</ul>
</li>
<li><a href="#97-kubernetes">9.7  kubernetes 컨텍 및 네임스페이스 표시하기</a></li>
</ul>
</li>
<li><a href="#10-liveness-probes">10. Liveness probes</a><ul>
<li><a href="#101-pod">10.1 Pod 생성</a></li>
<li><a href="#102-pod">10.2 Pod 확인</a></li>
<li><a href="#103-pod">10.3 Pod 로그 이벤트 확인</a></li>
</ul>
</li>
<li><a href="#11-replication-controller">11. Replication Controller</a><ul>
<li><a href="#111-replication-controller">11.1 Replication Controller 생성</a></li>
<li><a href="#112-pod">11.2 Pod 생성</a></li>
<li><a href="#113-pod">11.3 Pod 생성 확인</a></li>
<li><a href="#114-replication-controller">11.4 Replication Controller 확인</a></li>
<li><a href="#115-pod">11.5 특정 Pod 삭제하고 변화 확인하기</a></li>
<li><a href="#116-pod">11.6 Pod 정보를 라벨과 함께 출력해보기</a></li>
<li><a href="#117-pod">11.7 Pod 라벨을 변경해보기</a></li>
<li><a href="#118-pod-template">11.8 Pod Template 변경 해보기</a></li>
<li><a href="#119-pod-template-pod">11.9 Pod Template 를 적용하기 위해 임의의 Pod 삭제하기</a></li>
<li><a href="#1110-pod">11.10 Pod 스케일링</a></li>
<li><a href="#1111-replication-controller">11.11 Replication Controller 삭제</a></li>
</ul>
</li>
<li><a href="#12replicaset">12.ReplicaSet</a><ul>
<li><a href="#121-rs">12.1 RS 생성</a></li>
<li><a href="#122-rs">12.2 RS 확인</a></li>
<li><a href="#exercise-5">[[ Exercise #5 ]]</a></li>
</ul>
</li>
<li><a href="#13deamonset">13.DeamonSet</a><ul>
<li><a href="#131">13.1 데몬셋 생성</a></li>
</ul>
</li>
<li><a href="#14deployment">14.Deployment</a><ul>
<li><a href="#141-deployment">14.1 Deployment 생성</a></li>
<li><a href="#142-deployment">14.2 Deployment 확인</a></li>
<li><a href="#143">14.3 이미지 업데이트</a></li>
<li><a href="#144-deployment-scaleout">14.4 Deployment ScaleOut</a></li>
<li><a href="#144-deployment">14.4 deployment 확인 하기</a></li>
<li><a href="#exercise-6">[[ Exercise #6 ]]</a></li>
</ul>
</li>
<li><a href="#5-service">5. 서비스 (Service)</a><ul>
<li><a href="#51-clusterip">5.1 ClusterIP</a><ul>
<li><a href="#510-nodes-app">5.1.0 nodes app 생성</a></li>
<li><a href="#511-pod">5.1.1. pod 생성</a></li>
<li><a href="#512-yaml-clusterip">5.1.2 yaml을 통한 ClusterIP 생성</a></li>
<li><a href="#513">5.1.3 서비스 상태 확인</a></li>
<li><a href="#514">5.1.4 서비스 확인</a></li>
<li><a href="#515-pod-curl">5.1.5 원격 Pod에서 curl 명령 수행하기</a></li>
<li><a href="#516">5.1.6 서비스 삭제</a></li>
</ul>
</li>
<li><a href="#52-nodeport">5.2 NodePort</a><ul>
<li><a href="#521-yaml-nodeport-gcp">5.2.1 yaml 을 이용한 NodePort 생성 (GCP 에서 수행 하기)</a></li>
<li><a href="#522-nodeport">5.2.2 NodePort 조회</a></li>
<li><a href="#523-nodeport">5.2.3 NodePort 를 통한 서비스 접속 확인(여러번 수행)</a></li>
<li><a href="#524-nodeport">5.2.4 NodePort 삭제</a></li>
</ul>
</li>
<li><a href="#53-loadbalancer-gcp">5.3 LoadBalancer (GCP 에서 수행)</a><ul>
<li><a href="#531-yaml-deployment">5.3.1 yaml 파일로 deployment 생성</a></li>
<li><a href="#532">5.3.2 서비스 확인</a></li>
<li><a href="#532-nodeapp">5.3.2 nodeapp 접속 해보기</a></li>
<li><a href="#533-yaml-loadbalancer">5.3.3 yaml 파일을 이용해 LoadBalancer 생성</a></li>
<li><a href="#535-loadbalancer">5.3.5 LoadBalancer 생성 확인</a></li>
<li><a href="#536">5.3.6 서비스 확인</a></li>
</ul>
</li>
<li><a href="#54-ingress-gcp">5.4 Ingress (GCP 에서 수행)</a><ul>
<li><a href="#541-deployment">5.4.1 Deployment 생성</a></li>
<li><a href="#542-service">5.4.2 Service 생성</a></li>
<li><a href="#543-ingress">5.4.3 Ingress 생성</a></li>
<li><a href="#544-ingress">5.4.4 Ingress 조회</a></li>
<li><a href="#545-etchosts">5.4.5 /etc/hosts 파일 수정</a></li>
<li><a href="#546">5.4.6 서비스 확인</a></li>
<li><a href="#547-https-tls-offload">5.4.7 HTTPS 서비스 (TLS OffLoad)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#6-readiness-probe">6. Readiness Probe</a></li>
<li><a href="#7volums">7.Volums</a><ul>
<li><a href="#71-emptydir">7.1 EmptyDir</a><ul>
<li><a href="#711-docker">7.1.1 Docker 이미지 만들기</a></li>
<li><a href="#712-deployment">7.1.2 Deployment 작성</a></li>
<li><a href="#713-loadbalancer">7.1.3 LoadBalancer 작성</a></li>
<li><a href="#714-deployment-loadbalancer">7.1.4 Deployment 및 Loadbalancer 생성</a></li>
<li><a href="#715">7.1.5. 서비스 확인</a></li>
</ul>
</li>
<li><a href="#72-git-emptydir">7.2 Git EmptyDir</a><ul>
<li><a href="#721-git">7.2.1 웹서비스용 Git 리포지토리 생성</a></li>
<li><a href="#722-deployment-yaml">7.2.2 Deployment 용 yaml 파일 작성</a></li>
<li><a href="#723-deployment">7.2.3 Deployment 생성</a></li>
</ul>
</li>
<li><a href="#73-gce-persisteent-disk">7.3 GCE Persisteent DISK 사용하기</a><ul>
<li><a href="#731-persistent-disk">7.3.1. Persistent DISK 생성</a></li>
<li><a href="#732-pod-yaml">7.3.2 Pod 생성을 위한 yaml 파일 작성</a></li>
<li><a href="#733-mongodb-insert">7.3.3 Mongodb 접속 및 데이터 Insert</a></li>
<li><a href="#734-mongodb-pod">7.3.4 MongoDB Pod 재시작</a></li>
<li><a href="#735-pod">7.3.5 Pod 삭제</a></li>
</ul>
</li>
<li><a href="#74-persistentvolume-persistentvolumeclaim">7.4 PersistentVolume 및 PersistentVolumeClaim</a><ul>
<li><a href="#741-persistentvolume">7.4.1 PersistentVolume 생성</a></li>
<li><a href="#742-persistentvolumeclaim">7.4.2 PersistentVolumeClaim 생성</a></li>
<li><a href="#743-pv-pvc-pod">7.4.3 PV, PVC 를 이용한 Pod 생성</a></li>
<li><a href="#744-mongodb">7.4.4 Mongodb 접속 및 데이터 확인</a></li>
</ul>
</li>
<li><a href="#75-persistent-volume">7.5 Persistent Volume 의 동적 할당</a><ul>
<li><a href="#751-storageclass">7.5.1 StorageClass 를 이용해 스토리지 유형 정의</a></li>
<li><a href="#752-pvc">7.5.2 PVC 생성</a></li>
<li><a href="#753-pv-pvc">7.5.3 PV 및 PVC 확인</a></li>
<li><a href="#754-pvc-pod">7.5.4 PVC 를 이용한 POD 생성</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#8-configmap">8. ConfigMap</a><ul>
<li><a href="#81_1">8.1 도커에서 매개변수 전달</a><ul>
<li><a href="#811">8.1.1 디렉토리 생성 및 소스 코드 작성</a></li>
<li><a href="#812-docker">8.1.2 Docker 이미지 생성</a></li>
<li><a href="#813-pod">8.1.3 Pod생성</a></li>
</ul>
</li>
<li><a href="#82-yaml">8.2 Yaml 파일을 통한 매개변수 전달</a><ul>
<li><a href="#821-fortuneloopsh">8.2.1 fortuneloop.sh 작성</a></li>
<li><a href="#822-dockerfile-build">8.2.2 Dockerfile 작성 및 build</a></li>
<li><a href="#822-pod-yaml">8.2.2 Pod 생성및 매개변수 전달을 위한 yaml 파일 작성</a></li>
</ul>
</li>
<li><a href="#83-configmap">8.3 ConfigMap 을 통한 설정</a><ul>
<li><a href="#831-configmap">8.3.1 ConfigMap 생성 및 확인</a></li>
<li><a href="#832-configmap-yaml">8.3.2 ConfigMap을 환경변수로  전달한는 yaml 파일 작성</a></li>
<li><a href="#833-pod">8.3.3 Pod 생성 및 확인</a></li>
</ul>
</li>
<li><a href="#84-configmap-volume">8.4 ConfigMap Volume 사용 (파일숨김)</a><ul>
<li><a href="#841-configmap">8.4.1 ConfigMap 생성</a></li>
<li><a href="#842-configmap-volume-pod">8.4.2 configMap volume 이용 Pod 생성</a></li>
<li><a href="#843-configmap-volume">8.4.3 ConfigMap Volume  참조  확인</a></li>
<li><a href="#844-configmap">8.4.4 ConfigMap 동적 변경</a></li>
</ul>
</li>
<li><a href="#85-configmap-volume">8.5 ConfigMap Volume(파일 추가)</a><ul>
<li><a href="#851-configmap-volume-pod">8.5.1 configMap volume 이용 Pod 생성</a></li>
<li><a href="#852-confimap">8.5.2 서비스 및 ConfiMap 확인</a></li>
<li><a href="#853-configmap">8.5.3 ConfigMap 추가</a></li>
<li><a href="#854-configmap-pod">8.5.4 ConfigMap 추가된 Pod 생성</a></li>
<li><a href="#856-configmap">8.5.6 추가된 ConfigMap 확인</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#9-secret">9. Secret</a></li>
</ul>
</li>
<li><a href="#appendix">Appendix</a><ul>
<li><a href="#appendix-0-virtualbox">Appendix 0. VirtualBox 이미지 구성</a><ul>
<li><a href="#1-virtualbox">1. VirtualBox 다운로드 및 설치</a></li>
<li><a href="#2">2. 가상 이미지 가져오기</a></li>
<li><a href="#3_1">3. 가상 이미지 가져오기</a></li>
<li><a href="#4-vm">4. VM 설정</a></li>
<li><a href="#5-vm">5. VM 복제</a></li>
</ul>
</li>
<li><a href="#appendix-1">Appendix 1. 쿠버네티스 설치</a><ul>
<li><a href="#1">1.설치 사전 작업</a><ul>
<li><a href="#11-nftable-disable">1.1 Nftable disable</a></li>
<li><a href="#12">1.2 호스트명 변경</a></li>
<li><a href="#13">1.3 각노드에 호스트 파일 등록</a></li>
<li><a href="#14">1.4 방화벽 점검</a><ul>
<li><a href="#141-control-plane">1.4.1 Control Plane 노드</a></li>
<li><a href="#142-worker">1.4.2 worker 노드</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#2-runtime">2. Runtime 설치</a><ul>
<li><a href="#21-all-nodes">2.1  도커 설치 (all nodes)</a></li>
<li><a href="#22-kubernetes-all-nodes">2.2 kubernetes 설치 (all nodes)</a></li>
</ul>
</li>
<li><a href="#3-post-installation">3. Post Installation</a><ul>
<li><a href="#31-swap-all-nodes">3.1 SWAP 기능 해제(all nodes)</a></li>
<li><a href="#32-kubeadm-master-node">3.2 kubeadm을 사용하여 마스터 설정 (master node)</a></li>
</ul>
</li>
<li><a href="#4_1">4. 워커 노드 등록</a><ul>
<li><a href="#41-worker-nodes">4.1 워커 노드 등록 (worker nodes)</a></li>
<li><a href="#42-kube-client">4.2 마스터 노드 kube client 설정</a></li>
<li><a href="#43">4.3 클러스터 상태 확인</a></li>
<li><a href="#44">4.4 네트워크 어플리케이션 설치</a></li>
<li><a href="#45-kubectl">4.5 kubectl 명령어 자동완성 패키지 설치</a></li>
</ul>
</li>
<li><a href="#5-etcd">5. etcd 설치</a></li>
</ul>
</li>
<li><a href="#appendix-2-gke">Appendix 2. 구글 GKE 사용하기</a><ul>
<li><a href="#1_1">1. 회원가입</a></li>
<li><a href="#2_1">2. 프로젝트 생성</a></li>
<li><a href="#3_2">3. 쿠버네티스 클러스터 생성</a></li>
<li><a href="#4_2">4. 쿠버네티스 클러스터 접속 테스트</a></li>
</ul>
</li>
<li><a href="#appendix-3-git-sync">Appendix 3.  Git 계정 생성 및 Sync</a><ul>
<li><a href="#1git">1.Git 계정생성</a></li>
<li><a href="#2-git">2. Git 리포지토리 생성</a></li>
<li><a href="#3_3">3. 소스 파일 작성</a></li>
<li><a href="#4-git">4. Git 리포지토리 생성 및 초기화</a></li>
</ul>
</li>
<li><a href="#appendix-4-persist-volume-ceph">Appendix 4. Persist Volume 서비스를 위한 Ceph 설치</a><ul>
<li><a href="#1-ceph-worker01-worker02">1. Ceph 설치(worker01, worker02)</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>

            </div>
        </div>
        <div id="content-container">
            <div class="markdown-body markdown-content">
                <h1 id="learning-kubernetes">Learning Kubernetes</h1>
<p>[toc]</p>
<h2 id="3">3. 도커 기본 다지기</h2>
<h3 id="31">3.1 도커 설치하기</h3>
<h4 id="311-ubuntu">3.1.1 Ubuntu 설치</h4>
<div class="codehilite"><pre><span></span>sudo apt-get update
sudo apt-get install docker.io
sudo ln -sf /usr/bin/docker.io /usr/local/bin/docker
</pre></div>


<blockquote>
<p>우분투 패키지 메니저는 apt-get , apt-cache, apt 가 있습니다. 모두 동일한 명령어라고 보면 되지만, apt 를 쓸경우 일단 글자수가 적고, 출력 Output 에 색상이 추가되어 좀더 예쁘게 보입니다.</p>
</blockquote>
<h4 id="312-centos-6">3.1.2 CentOS 6</h4>
<div class="codehilite"><pre><span></span>sudo yum install http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm
sudo yum install docker-io   
</pre></div>


<h4 id="313-centos-7">3.1.3 CentOS 7</h4>
<div class="codehilite"><pre><span></span>sudo yum install docker
sudo service docker start
sudo chkconfig docker on <span class="c1"># 부팅시에 자동 스타트업</span>
</pre></div>


<h3 id="32">3.2 도커 기본 명령어</h3>
<h4 id="321-hub">3.2.1 도커 hub 사용을 위한 계정생성</h4>
<div class="codehilite"><pre><span></span>sudo docker login
</pre></div>


<blockquote>
<p><a href="https://hub.docker.com/">docker hub</a> (hub.docker.dom) 에 가입 후 명령어를 실행 해야 로그인이 가능 합니다.</p>
</blockquote>
<h4 id="322">3.2.2 도커 이미지 검색</h4>
<p>search 명령으로 nginx 를 검색해 봅니다.</p>
<div class="codehilite"><pre><span></span>sudo docker search nginx
</pre></div>


<p><img alt="docker_k8s_search" src="./img/docker_k8s_search.png" /></p>
<h4 id="323">3.2.3 도커 이미지 다운로드</h4>
<p>]</p>
<p>nodejs 이미지를 설치해봅니다. 최신 안정버전인 12.14 버전을 설치 합니다.</p>
<div class="codehilite"><pre><span></span>sudo docker pull nodejs:latest    <span class="c1"># 최신버전 다운로드</span>
sudo docker pull nodejs:12.14.0   <span class="c1"># 특정버전 다운로드 </span>
sudo docker pull -a nodejs        <span class="c1"># 모든버전 다운로드</span>
</pre></div>


<p><img alt="dcoker-pull" src="./img/dcoker-pull.png" /></p>
<h4 id="324">3.2.4 도커 이미지 목록 보기</h4>
<div class="codehilite"><pre><span></span>docker image list
docker image ls
docker images
</pre></div>


<p><img alt="docker-image-list" src="./img/docker-image-list.png" /></p>
<h3 id="33">3.3 도커 이미지 생성 하기</h3>
<h4 id="331-application">3.3.1 서비스를 위한 Application 코드 작성</h4>
<p>hostname_finder 라는 폴더를 만들고 그 아래 main.go 및 Dockerfiles 2개 파일을 작성 합니다.</p>
<p>먼저 vi 또는 gedit 를 실행해서 아래 파일을 main.go 라는 이름 으로 작성 합니다.</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;os&quot;</span>
    <span class="s">&quot;log&quot;</span>
    <span class="s">&quot;net/http&quot;</span>
<span class="p">)</span>
<span class="kd">func</span> <span class="nx">handler</span><span class="p">(</span><span class="nx">w</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">r</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">){</span>
    <span class="nx">name</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Hostname</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="s">&quot;hostname:&quot;</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Stdout</span><span class="p">,</span><span class="s">&quot;Starting GoApp Server......&quot;</span><span class="p">)</span>
    <span class="nx">http</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="nx">handler</span><span class="p">)</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">ListenAndServe</span><span class="p">(</span><span class="s">&quot;:8080&quot;</span><span class="p">,</span><span class="kc">nil</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>


<h4 id="332-dockerfile">3.3.2 이미지 생성을 위한 Dockerfile 작성</h4>
<div class="codehilite"><pre><span></span><span class="k">FROM</span><span class="s"> golang:1.11-alpine AS build</span>

<span class="k">WORKDIR</span><span class="s"> /src/</span>
COPY main.go go.* /src/
<span class="k">RUN</span> <span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> go build -o /bin/demo

<span class="k">FROM</span><span class="s"> scratch</span>
COPY --from<span class="o">=</span>build /bin/demo /bin/demo
<span class="k">ENTRYPOINT</span><span class="s"> [&quot;/bin/demo&quot;]</span>
</pre></div>


<h4 id="333">3.3.3 컨테이너 이미지 생성</h4>
<p>hostname_finder 라는 폴더 안에서 아래 명령어를 실행 합니다.</p>
<div class="codehilite"><pre><span></span>docker build -t goapp .
</pre></div>


<blockquote>
<p>. 은 현재 디렉토리서 Dockerfile 참조해서 first-container 라는 이미지를 생성 합니다.</p>
</blockquote>
<p>[출력]</p>
<div class="codehilite"><pre><span></span>Sending build context to Docker daemon  3.072kB
Step 1/7 : FROM golang:1.11-alpine AS build
 ---&gt; e116d2efa2ab
Step 2/7 : WORKDIR /src/
 ---&gt; Using cachedocker 
 ---&gt; c3210d8eb11f
Step 3/7 : COPY main.go go.* /src/
 ---&gt; ef55118ea78c
Step 4/7 : RUN CGO_ENABLED=0 go build -o /bin/demo
 ---&gt; Running in e557730bf11c
Removing intermediate container e557730bf11c
 ---&gt; d55bd9bd3f81
Step 5/7 : FROM scratch
 ---&gt;
Step 6/7 : COPY --from=build /bin/demo /bin/demo
 ---&gt; bb4b1250a05e
Step 7/7 : ENTRYPOINT [&quot;/bin/demo&quot;]
 ---&gt; Running in 4419d56988aa
Removing intermediate container 4419d56988aa
 ---&gt; 36f5c919e3b8
Successfully built 36f5c919e3b8
Successfully tagged goapp:latest
</pre></div>


<p>이미지가 생성 되었는지 명령어를 통해 확인 합니다.</p>
<div class="codehilite"><pre><span></span>docker images
</pre></div>


<p>[출력]</p>
<div class="codehilite"><pre><span></span>REPOSITORY                           TAG                 IMAGE ID            CREATED              SIZE
&lt;none&gt;                               &lt;none&gt;              d55bd9bd3f81        About a minute ago   325MB
goapp                              latest              36f5c919e3b8        About a minute ago   6.51MB
&lt;none&gt;                               &lt;none&gt;              1c688e9c7e3c        3 days ago           325MB
&lt;none&gt;                               &lt;none&gt;              9b60c66a5b82        3 days ago           6.51MB
&lt;none&gt;                               &lt;none&gt;              7fc44021a96f        3 days ago           325MB
&lt;none&gt;                               &lt;none&gt;              2caa0c2ac791        3 days ago           325MB
&lt;none&gt;                               &lt;none&gt;              c46d81105b65        3 days ago           6.51MB
&lt;none&gt;                               &lt;none&gt;              2d78705fb4ae        3 days ago           312MB
</pre></div>


<h3 id="34">3.4 도커 컨테이너 시작 및 서비스 확인</h3>
<h4 id="341">3.4.1 도커 컨테이너 시작</h4>
<div class="codehilite"><pre><span></span>docker run --name goapp-project -p <span class="m">8080</span>:8080 -d goapp
docker run -it --name goapp-project -p <span class="m">8080</span>:8080 -d goapp /bin/bash   
</pre></div>


<blockquote>
<p>--name : 실행한 도커 컨테이너의 이름 지정</p>
<p>-p : 포트 맵핑 정보 localhost 와 컨테이너 포트를 맵핑 합니다.</p>
<p>-d : Docker 컨테이너를 백그라운드로 수행하고 컨테이너 ID를 출력 합니다.</p>
<p>-i : STDIN 계속 interactive 모드로 유지</p>
</blockquote>
<h4 id="342">3.4.2 도커 컨테이스 서비스 확인</h4>
<p>curl 명령어를 통해 정상적인 서비스 수행 여부를 확인 합니다.</p>
<div class="codehilite"><pre><span></span>curl localhost:8080
</pre></div>


<p>[출력]</p>
<div class="codehilite"><pre><span></span><span class="n">hostname</span><span class="o">:</span> <span class="mi">96</span><span class="n">fc3a5eb914</span>
</pre></div>


<h4 id="343">3.4.3 도커 프로세서 확인</h4>
<div class="codehilite"><pre><span></span>docker ps
</pre></div>


<p><strong>[출력]</strong></p>
<div class="codehilite"><pre><span></span>CONTAINER ID        IMAGE                   COMMAND                  CREATED             STATUS              PORTS                    NAMES
96fc3a5eb914        goapp                   &quot;/bin/demo&quot;              43 seconds ago      Up 42 seconds       0.0.0.0:8080-&gt;8080/tcp   goapp-project
</pre></div>


<h4 id="344">3.4.4 프로세서 상세 정보 출력</h4>
<div class="codehilite"><pre><span></span>docker inspect goapp-project
</pre></div>


<p>[출력]</p>
<div class="codehilite"><pre><span></span>[
    {
        &quot;Id&quot;: &quot;96fc3a5eb914c58ed83e088681d53a46188edeaab061ff2de0b9852e9dd276c9&quot;,
        &quot;Created&quot;: &quot;2020-01-10T04:32:12.269012485Z&quot;,
        &quot;Path&quot;: &quot;/bin/demo&quot;,
        &quot;Args&quot;: [],
        &quot;State&quot;: {
            &quot;Status&quot;: &quot;running&quot;,
            &quot;Running&quot;: true,
            &quot;Paused&quot;: false,
            &quot;Restarting&quot;: false,
            &quot;OOMKilled&quot;: false,
            &quot;Dead&quot;: false,
            &quot;Pid&quot;: 31285,
            &quot;ExitCode&quot;: 0,
            &quot;Error&quot;: &quot;&quot;,
            &quot;StartedAt&quot;: &quot;2020-01-10T04:32:12.902395362Z&quot;,
            &quot;FinishedAt&quot;: &quot;0001-01-01T00:00:00Z&quot;
        },
        &quot;Image&quot;: &quot;sha256:36f5c919e3b88f1c991eda67d96e62fe02b763182e44f19fb78b2fc055165f3d&quot;,
        &quot;ResolvConfPath&quot;: &quot;/var/lib/docker/containers/96fc3a5eb914c58ed83e088681d53a46188edeaab061ff2de0b9852e9dd276c9/resolv.conf&quot;,
        &quot;HostnamePath&quot;: &quot;/var/lib/docker/containers/96fc3a5eb914c58ed83e088681d53a46188edeaab061ff2de0b9852e9dd276c9/hostname&quot;,
        &quot;HostsPath&quot;: &quot;/var/lib/docker/containers/96fc3a5eb914c58ed83e088681d53a46188edeaab061ff2de0b9852e9dd276c9/hosts&quot;,
        &quot;LogPath&quot;: &quot;/var/lib/docker/containers/96fc3a5eb914c58ed83e088681d53a46188edeaab061ff2de0b9852e9dd276c9/96fc3a5eb914c58ed83e088681d53a46188edeaab061ff2de0b9852e9dd276c9-json.log&quot;,
</pre></div>


<h4 id="345-docker">3.4.5 Docker 컨테이너 접속</h4>
<div class="codehilite"><pre><span></span><span class="c1"># docker 컨테이너 접속</span>
docker <span class="nb">exec</span> -it goapp-project bash

<span class="c1"># docker 외부에서 컨테이너에 명령수행 (ls 명령 수행)</span>
docker <span class="nb">exec</span> goapp-project ls
</pre></div>


<blockquote>
<p>-i  또는  --interactive : STDIN을 오픈한 상태로 인터랙티브 모드상태</p>
<p>-t  또는 --tty  : terminal 모드</p>
<p>container 이름이 보이지 않고 ID 만 기본적으로 보입니다. 컨테이너 이름을 출력하려면 아래 명령어를 수행 하면 됩니다.</p>
<p>docker ps --format "{{.Names}}" </p>
</blockquote>
<h4 id="346">3.4.6 도커 인스턴스 중단 및 삭제</h4>
<div class="codehilite"><pre><span></span>docker stop goapp-project
docker rm goapp-project
</pre></div>


<h3 id="35">3.5. 도커 이미지를 도커 허브에 업로드</h3>
<h4 id="351-tag">3.5.1  도커 허브양식에 맞게 tag 수정하기</h4>
<div class="codehilite"><pre><span></span>docker tag goapp  dangtong/goapp
</pre></div>


<p>[출력]</p>
<div class="codehilite"><pre><span></span>REPOSITORY                           TAG                 IMAGE ID            CREATED             SIZE
dangtong/goapp                       latest              12e9a84d9e23        3 days ago          6.51MB
goapp                                latest              12e9a84d9e23        3 days ago          6.51MB
</pre></div>


<blockquote>
<p>dangtong/firstapp 과 first-container 의 image ID 가 같은 것을 확인 할 수 있습니다.</p>
<p>사실 하나의 이미지를 서로 다른 TAGID 로 공유 하는 것입니다. 디스크 공간이 늘어나지 않습니다.</p>
</blockquote>
<h4 id="352">3.5.2 도커 허브에 이미지 업로드 하기</h4>
<div class="codehilite"><pre><span></span>docker login --username dangtong
docker push dangtong/goapp
</pre></div>


<p>[출력]</p>
<div class="codehilite"><pre><span></span>The push refers to repository [docker.io/dangtong/goapp]
cc282a374c26: Pushed
latest: digest: sha256:b18b5ff03599893a7361feda054ebe26de61a71f019dc8725bb33d87f2115968 size: 528
</pre></div>


<p>도커 허브에 로그인 하게 되면 아래와 같이 goapp 이미지가 업로드 된것을 확인 할 수 있습니다. 이제 인터넷만 연결  되면 어디서는 자신이 만든 이미지로 컨테이너를 실행 할 수 있습니다.</p>
<p><img alt="image-20200110124234902" src="./img/image-20200110124234902.png" /></p>
<h4 id="353">3.5.3  도커 허브의 이미지로 컨테이너 실행</h4>
<p>docker hub 에 있는 이미지를 로딩하여 컨테이너 생성</p>
<div class="codehilite"><pre><span></span>docker run --name goapp-project -p <span class="m">8080</span>:8080 -d dangtong/goapp
</pre></div>


<div class="codehilite"><pre><span></span>docker ps 
</pre></div>


<p>[출력]</p>
<div class="codehilite"><pre><span></span>CONTAINER ID        IMAGE                   COMMAND                  CREATED             STATUS              PORTS                    NAMES
0938068f8709        dangtong/goapp          &quot;/bin/demo&quot;              5 seconds ago       Up 4 seconds        0.0.0.0:8080-&gt;8080/tcp   goapp-project
</pre></div>


<p>현재 서비스에 접속하여 확인</p>
<div class="codehilite"><pre><span></span>curl http://localhost:8080
</pre></div>


<div class="codehilite"><pre><span></span><span class="n">hostname</span><span class="o">:</span> <span class="mi">0938068</span><span class="n">f8709</span>
</pre></div>


<h3 id="exercise-1">[Exercise #1]</h3>
<ol>
<li>
<p>서버 호스트명을 출력하는 node.js 프로그램을 만드세요</p>
</li>
<li>
<p>해당 소스로 node 버전 7 기반으로 서비스 하는 Docker file을 만들고 이미지를 build 하세요</p>
</li>
<li>
<p>tag 명령을 이용해서 docker hub 에 올릴수 있도록 이름을 바꾸세요</p>
</li>
<li>
<p>docker login 후에 docker hub 에 업로드하여 실제 업로드가 되었는지 확인하세요</p>
</li>
</ol>
<p>이름은 username/nodejs-app 으로 하세요</p>
<ul>
<li>node.js 프로그램</li>
</ul>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">os</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;os&#39;</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Kubia server starting...&quot;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">handler</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Received request from &quot;</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">connection</span><span class="p">.</span><span class="nx">remoteAddress</span><span class="p">);</span>
  <span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
  <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s2">&quot;You&#39;ve hit &quot;</span> <span class="o">+</span> <span class="nx">os</span><span class="p">.</span><span class="nx">hostname</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span><span class="p">);</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">www</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="nx">handler</span><span class="p">);</span>
<span class="nx">www</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8080</span><span class="p">);</span>
</pre></div>


<ul>
<li>Dcokerfile</li>
</ul>
<div class="codehilite"><pre><span></span><span class="c1"># FROM 으로 BASE 이미지 로드</span>
FROM node:7

<span class="c1"># ADD 명령어로 이미지에 app.js 파일 추가</span>
ADD app.js /app.js

<span class="c1"># ENTRYPOINT 명령어로 node 를 실행하고 매개변수로 app.js 를 전달</span>
ENTRYPOINT <span class="o">[</span><span class="s2">&quot;node&quot;</span>, <span class="s2">&quot;app.js&quot;</span><span class="o">]</span>
</pre></div>


<h2 id="4">4. 쿠버네티스 간단하게 맛보기</h2>
<h3 id="41">4.1 도커 허브 이미지로 컨테이너 생성 및 확인</h3>
<ul>
<li>컨테이너 생성 : run/v1 으로 수행 합니다.</li>
</ul>
<p><code>{bash}
  # POD 및 Replication Controller 생성 (향후 버전에서 deprecated 될 예정)
  $ kubectl run goapp-project --image=dangtong/goapp --port=8080 --generator=run/v1
  # POD 만 생성
  $ kubectl run goapp-project --image=dangtong/goapp --port=8080 --generator=run-pod/v1</code></p>
<blockquote>
<p>generator 를 run/v1 으로 수행 할 경우 내부적으로 goapp-project-{random-String} 이라는 컨테이너를 만들면서 goapp-project- 이름의 replication controller  도 생기게 됩니다.</p>
</blockquote>
<ul>
<li>Generator 의 종류 : <strong>run-pod/v1</strong>  외에 모두 deprecated 될 예정</li>
</ul>
<table>
<thead>
<tr>
<th align="left">Resource</th>
<th align="left">API group</th>
<th align="left">kubectl command</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Pod</td>
<td align="left">v1</td>
<td align="left"><code>kubectl run --generator=run-pod/v1</code></td>
</tr>
<tr>
<td align="left">ReplicationController <em>(deprecated)</em></td>
<td align="left">v1</td>
<td align="left"><code>kubectl run --generator=run/v1</code></td>
</tr>
<tr>
<td align="left">Deployment <em>(deprecated)</em></td>
<td align="left">extensions/v1beta1</td>
<td align="left"><code>kubectl run --generator=deployment/v1beta1</code></td>
</tr>
<tr>
<td align="left">Deployment <em>(deprecated)</em></td>
<td align="left">apps/v1beta1</td>
<td align="left"><code>kubectl run --generator=deployment/apps.v1beta1</code></td>
</tr>
<tr>
<td align="left">Job <em>(deprecated)</em></td>
<td align="left">batch/v1</td>
<td align="left"><code>kubectl run --generator=job/v1</code></td>
</tr>
<tr>
<td align="left">CronJob <em>(deprecated)</em></td>
<td align="left">batch/v2alpha1</td>
<td align="left"><code>kubectl run --generator=cronjob/v2alpha1</code></td>
</tr>
<tr>
<td align="left">CronJob <em>(deprecated)</em></td>
<td align="left">batch/v1beta1</td>
<td align="left"><code>kubectl run --generator=cronjob/v1beta1</code></td>
</tr>
</tbody>
</table>
<ul>
<li>컨테이너 확인</li>
</ul>
<p><code>{bash}
  $ kubectl get pods
  $ kubectl get rc</code></p>
<p>```{text}
  $ kubectl get pods
  NAME             READY   STATUS    RESTARTS   AGE
  goapp-project-bcv5q   1/1     Running   0          2m26s</p>
<p>$ kubectl get rc
  NAME            DESIRED   CURRENT   READY   AGE
  goapp-project   1         1         1       8m58s
  ```</p>
<blockquote>
<p>아래 명령어를 추가적으로 수행해 보세요</p>
<p><code>kubectl get pods -o wide
kubectl describe pod goapp-project-bcv5q</code></p>
</blockquote>
<ul>
<li>k8s 서비스 생성</li>
</ul>
<p><code>{bash}
  $ kubectl expose rc goapp-project --type=LoadBalancer --name goapp-http</code></p>
<p><code>{text}
  service/firstapp-http exposed</code></p>
<ul>
<li>생성한 서비스 조회</li>
</ul>
<p><code>{bash}
  $ kubectl get services</code></p>
<p><code>{text}
  NAME         TYPE           CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE
  goapp-http   LoadBalancer   10.96.225.172   &lt;pending&gt;     8080:31585/TCP   104s
  kubernetes   ClusterIP      10.96.0.1       &lt;none&gt;        443/TCP          14d</code></p>
<ul>
<li>서비스 테스트 (여러번 수행)</li>
</ul>
<p><code>{bash}
  curl http://10.96.225.172:8080</code></p>
<p>[출력]</p>
<p><code>{text}
hostname: goapp-project-bcv5q
  hostname: goapp-project-bcv5q
  hostname: goapp-project-bcv5q
  hostname: goapp-project-bcv5q</code></p>
<ul>
<li>replication controller 를 통한 scale-out 수행</li>
</ul>
<p><code>{bash}
  kubectl scale rc goapp-project --replicas=3</code></p>
<p>[출력]</p>
<p><code>{txt}
  replicationcontroller/goapp-project scaled</code></p>
<ul>
<li>Scale-Out 결과 확인</li>
</ul>
<p><code>{bash}
  kubectl get pod</code></p>
<p>[출력]</p>
<p><code>{txt}
  NAME                  READY   STATUS    RESTARTS   AGE
  goapp-project-bcv5q   1/1     Running   0          16m
  goapp-project-c8hml   1/1     Running   0          26s
  goapp-project-r7kx5   1/1     Running   0          26s</code></p>
<ul>
<li>서비스 테스트 (여러번 수행)</li>
</ul>
<p><code>{bash}
  curl http://10.96.225.172:8080</code></p>
<p>[출력]</p>
<p><code>{txt}
  NAME                  READY   STATUS    RESTARTS   AGE
  goapp-project-bcv5q   1/1     Running   0          16m
  goapp-project-c8hml   1/1     Running   0          26s
  goapp-project-r7kx5   1/1     Running   0          26s</code></p>
<ul>
<li>POD 삭제</li>
</ul>
<p>Replication Controller 를 통해 생성된 POD 는 개별 POD 가 삭제 되지 않습니다. Replication Controller 자체를 삭제 해야 합니다.</p>
<div class="codehilite"><pre><span></span>kubectl delete rc goapp-project
</pre></div>


<h2 id="5-pods">5. PODS</h2>
<h3 id="51-pod">5.1 POD 기본</h3>
<h3 id="51-pod-yaml">5.1 POD 설정을 yaml 파일로 가져오기</h3>
<div class="codehilite"><pre><span></span>kubectl get pod goapp-project-bcv5q -o yaml
kubectl get po goapp-project-bcv5q -o json
</pre></div>


<p>크게 <strong>metadata, spec, status</strong> 항목으로 나누어 집니다.</p>
<p>[출력 - yaml]</p>
<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">apiVersion</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">creationTimestamp</span><span class="p p-Indicator">:</span> <span class="s">&quot;2020-01-10T07:37:49Z&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">generateName</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">goapp-project-</span>
  <span class="l l-Scalar l-Scalar-Plain">labels</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">run</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">goapp-project</span>
  <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">goapp-project-bcv5q</span>
  <span class="l l-Scalar l-Scalar-Plain">namespace</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
  <span class="l l-Scalar l-Scalar-Plain">ownerReferences</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">apiVersion</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
    <span class="l l-Scalar l-Scalar-Plain">blockOwnerDeletion</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="l l-Scalar l-Scalar-Plain">controller</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ReplicationController</span>
    <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">goapp-project</span>
    <span class="l l-Scalar l-Scalar-Plain">uid</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">e223237f-17e2-44f4-aaee-07e8ff4592b2</span>
  <span class="l l-Scalar l-Scalar-Plain">resourceVersion</span><span class="p p-Indicator">:</span> <span class="s">&quot;3082141&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">selfLink</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/api/v1/namespaces/default/pods/goapp-project-bcv5q</span>
  <span class="l l-Scalar l-Scalar-Plain">uid</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">72bebcbd-8e6e-4906-9f66-1c3821fa49ec</span>
<span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">containers</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">dangtong/goapp</span>
    <span class="l l-Scalar l-Scalar-Plain">imagePullPolicy</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Always</span>
    <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">goapp-project</span>
    <span class="l l-Scalar l-Scalar-Plain">ports</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">containerPort</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">8080</span>
      <span class="l l-Scalar l-Scalar-Plain">protocol</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">TCP</span>
    <span class="l l-Scalar l-Scalar-Plain">resources</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{}</span>
    <span class="l l-Scalar l-Scalar-Plain">terminationMessagePath</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/dev/termination-log</span>
    <span class="l l-Scalar l-Scalar-Plain">terminationMessagePolicy</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">File</span>
    <span class="l l-Scalar l-Scalar-Plain">volumeMounts</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">mountPath</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/var/run/secrets/kubernetes.io/serviceaccount</span>
      <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">default-token-qz4fh</span>
      <span class="l l-Scalar l-Scalar-Plain">readOnly</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
  <span class="l l-Scalar l-Scalar-Plain">dnsPolicy</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ClusterFirst</span>
  <span class="l l-Scalar l-Scalar-Plain">enableServiceLinks</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
  <span class="l l-Scalar l-Scalar-Plain">nodeName</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">worker01.sas.com</span>
  <span class="l l-Scalar l-Scalar-Plain">priority</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
  <span class="l l-Scalar l-Scalar-Plain">restartPolicy</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Always</span>
  <span class="l l-Scalar l-Scalar-Plain">schedulerName</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">default-scheduler</span>
  <span class="l l-Scalar l-Scalar-Plain">securityContext</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{}</span>
  <span class="l l-Scalar l-Scalar-Plain">serviceAccount</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
  <span class="l l-Scalar l-Scalar-Plain">serviceAccountName</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
  <span class="l l-Scalar l-Scalar-Plain">terminationGracePeriodSeconds</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">30</span>
  <span class="l l-Scalar l-Scalar-Plain">tolerations</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">effect</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">NoExecute</span>
    <span class="l l-Scalar l-Scalar-Plain">key</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">node.kubernetes.io/not-ready</span>
    <span class="l l-Scalar l-Scalar-Plain">operator</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Exists</span>
    <span class="l l-Scalar l-Scalar-Plain">tolerationSeconds</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">300</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">effect</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">NoExecute</span>
    <span class="l l-Scalar l-Scalar-Plain">key</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">node.kubernetes.io/unreachable</span>
    <span class="l l-Scalar l-Scalar-Plain">operator</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Exists</span>
    <span class="l l-Scalar l-Scalar-Plain">tolerationSeconds</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">300</span>
  <span class="l l-Scalar l-Scalar-Plain">volumes</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">default-token-qz4fh</span>
    <span class="l l-Scalar l-Scalar-Plain">secret</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">defaultMode</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">420</span>
      <span class="l l-Scalar l-Scalar-Plain">secretName</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">default-token-qz4fh</span>
<span class="l l-Scalar l-Scalar-Plain">status</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">conditions</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">lastProbeTime</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">null</span>
    <span class="l l-Scalar l-Scalar-Plain">lastTransitionTime</span><span class="p p-Indicator">:</span> <span class="s">&quot;2020-01-10T07:37:49Z&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">status</span><span class="p p-Indicator">:</span> <span class="s">&quot;True&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Initialized</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">lastProbeTime</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">null</span>
    <span class="l l-Scalar l-Scalar-Plain">lastTransitionTime</span><span class="p p-Indicator">:</span> <span class="s">&quot;2020-01-10T07:37:55Z&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">status</span><span class="p p-Indicator">:</span> <span class="s">&quot;True&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Ready</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">lastProbeTime</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">null</span>
    <span class="l l-Scalar l-Scalar-Plain">lastTransitionTime</span><span class="p p-Indicator">:</span> <span class="s">&quot;2020-01-10T07:37:55Z&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">status</span><span class="p p-Indicator">:</span> <span class="s">&quot;True&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ContainersReady</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">lastProbeTime</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">null</span>
    <span class="l l-Scalar l-Scalar-Plain">lastTransitionTime</span><span class="p p-Indicator">:</span> <span class="s">&quot;2020-01-10T07:37:49Z&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">status</span><span class="p p-Indicator">:</span> <span class="s">&quot;True&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">PodScheduled</span>
  <span class="l l-Scalar l-Scalar-Plain">containerStatuses</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">containerID</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">docker://de3418e51fea7f7a19e7b1d6ff5a4a6f386f337578838e6f1ec0589275ca6f48</span>
    <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">dangtong/goapp:latest</span>
    <span class="l l-Scalar l-Scalar-Plain">imageID</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">docker-pullable://dangtong/goapp@sha256:e5872256539152aecd2a8fb1f079e132a6a8f247c7a2295f0946ce2005e36d05</span>
    <span class="l l-Scalar l-Scalar-Plain">lastState</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{}</span>
    <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">goapp-project</span>
    <span class="l l-Scalar l-Scalar-Plain">ready</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="l l-Scalar l-Scalar-Plain">restartCount</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
    <span class="l l-Scalar l-Scalar-Plain">started</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="l l-Scalar l-Scalar-Plain">state</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">running</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">startedAt</span><span class="p p-Indicator">:</span> <span class="s">&quot;2020-01-10T07:37:55Z&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">hostIP</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">192.168.56.103</span>
  <span class="l l-Scalar l-Scalar-Plain">phase</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Running</span>
  <span class="l l-Scalar l-Scalar-Plain">podIP</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">10.40.0.2</span>
  <span class="l l-Scalar l-Scalar-Plain">podIPs</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ip</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">10.40.0.2</span>
  <span class="l l-Scalar l-Scalar-Plain">qosClass</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">BestEffort</span>
  <span class="l l-Scalar l-Scalar-Plain">startTime</span><span class="p p-Indicator">:</span> <span class="s">&quot;2020-01-10T07:37:49Z&quot;</span>
</pre></div>


<h3 id="52-pod-yaml">5.2 POD 생성을 위한 YAML 파일 만들기</h3>
<p>아래와 같이 goapp.yaml 파일을 만듭니다.</p>
<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">apiVersion</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>               
<span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Pod</span>                    
<span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">goapp-pod</span>
<span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">containers</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">dangtong/goapp</span>
    <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">goapp-container</span>
    <span class="l l-Scalar l-Scalar-Plain">ports</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">containerPort</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">8080</span>
      <span class="l l-Scalar l-Scalar-Plain">protocol</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">TCP</span>
</pre></div>


<blockquote>
<p>ports 정보를 yaml 파일에 기록  하지 않으면 아래 명령어로 향후에  포트를 할당해도 됩니다.</p>
<p><code>kubectl port-forward goapp-pod 8080:8080</code></p>
</blockquote>
<h3 id="53-yaml-pod">5.3  YAML 파일을 이용한 POD 생성 및 확인</h3>
<div class="codehilite"><pre><span></span>$ kubectl create -f goapp.yaml
</pre></div>


<p>[output]</p>
<div class="codehilite"><pre><span></span> pod/goapp-pod created
</pre></div>


<div class="codehilite"><pre><span></span>$ kubectl get pod
</pre></div>


<p>[output]</p>
<div class="codehilite"><pre><span></span>NAME                  READY   STATUS    RESTARTS   AGE
goapp-pod             1/1     Running   0          12m
goapp-project-bcv5q   1/1     Running   0          41m
goapp-project-c8hml   1/1     Running   0          25m
goapp-project-r7kx5   1/1     Running   0          25m
</pre></div>


<h3 id="54-pod-container">5.4 POD 및 Container 로그 확인</h3>
<ul>
<li>POD 로그 확인</li>
</ul>
<div class="codehilite"><pre><span></span>kubectl logs goapp-pod
</pre></div>


<p>[output]</p>
<div class="codehilite"><pre><span></span>Starting GoApp Server......
</pre></div>


<ul>
<li>Container 로그 확인</li>
</ul>
<div class="codehilite"><pre><span></span>kubectl logs goapp-pod -c goapp-container
</pre></div>


<p>[output]</p>
<div class="codehilite"><pre><span></span>Starting GoApp Server......
</pre></div>


<blockquote>
<p>현재 1개 POD 내에 Container 가 1이기 때문에 출력 결과는 동일 합니다. POD 내의 Container 가 여러개 일 경우 모든 컨테이너의 표준 출력이 화면에  출력됩니다.</p>
</blockquote>
<h3 id="exercise-2">[Exercise #2]</h3>
<ol>
<li>Yaml 파일로 nginx 11.1 버전기반의 이미지를 사용해 nginx-app 이라는 이름의 Pod 를 만드세요(port : 8080)</li>
<li>curl 명령어르 사용해. Nginx 서비스에 접속</li>
<li>nginx Pod 의 정보를 yaml 파일로 출력 하세요</li>
<li>nginx-app Pod 를 삭제 하세요</li>
</ol>
<h2 id="6-lable">6. Lable</h2>
<h3 id="61-lable-pod">6.1 Lable 정보를 추가해서 POD 생성하기</h3>
<ul>
<li>goapp-with-lable.yaml 이라 파일에 아래 내용을 추가 하여 작성 합니다.</li>
</ul>
<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">apiVersion</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">goapp-pod2</span>
  <span class="l l-Scalar l-Scalar-Plain">labels</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">env</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">prod</span>
<span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">containers</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">dangtong/goapp</span>
    <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">goapp-container</span>
    <span class="l l-Scalar l-Scalar-Plain">ports</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">containerPort</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">8080</span>
      <span class="l l-Scalar l-Scalar-Plain">protocol</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">TCP</span>
</pre></div>


<ul>
<li>yaml 파일을 이용해 pod 를 생성 합니다.</li>
</ul>
<div class="codehilite"><pre><span></span>$ kubectl create -f ./goapp-with-lable.yaml
</pre></div>


<p>[output]</p>
<div class="codehilite"><pre><span></span>pod/goapp-pod2 created
</pre></div>


<ul>
<li>생성된 POD를 조회 합니다.</li>
</ul>
<div class="codehilite"><pre><span></span>kubectl get po --show-labels
</pre></div>


<p>[output]</p>
<div class="codehilite"><pre><span></span>NAME                  READY   STATUS    RESTARTS   AGE     LABELS
goapp-pod             1/1     Running   0          160m    &lt;none&gt;
goapp-pod2            1/1     Running   0          3m53s   env=prod
goapp-project-bcv5q   1/1     Running   0          9h      run=goapp-project
goapp-project-c8hml   1/1     Running   0          9h      run=goapp-project
goapp-project-r7kx5   1/1     Running   0          9h      run=goapp-project
</pre></div>


<ul>
<li>Lable 태그를 출력 화면에 컬럼을 분리해서 출력</li>
</ul>
<div class="codehilite"><pre><span></span>kubectl get pod -L env
</pre></div>


<p>[output]</p>
<div class="codehilite"><pre><span></span>NAME                  READY   STATUS    RESTARTS   AGE     ENV
goapp-pod             1/1     Running   0          161m
goapp-pod2            1/1     Running   0          5m19s   prod
goapp-project-bcv5q   1/1     Running   0          9h
goapp-project-c8hml   1/1     Running   0          9h
goapp-project-r7kx5   1/1     Running   0          9h
</pre></div>


<ul>
<li>Lable을 이용한 필터링 조회</li>
</ul>
<div class="codehilite"><pre><span></span>kubectl get pod -l <span class="nv">env</span><span class="o">=</span>prod
</pre></div>


<p>[output]</p>
<div class="codehilite"><pre><span></span>NAME         READY   STATUS    RESTARTS   AGE
goapp-pod2   1/1     Running   0          39h
</pre></div>


<h3 id="62-pod-yaml">6.2 생성된 POD 로 부터 yaml 파일 얻기</h3>
<div class="codehilite"><pre><span></span>kubectl get pod goapp-pod -o yaml
</pre></div>


<p>[output]</p>
<div class="codehilite"><pre><span></span><span class="n">apiVersion</span><span class="o">:</span> <span class="n">v1</span>
<span class="n">kind</span><span class="o">:</span> <span class="n">Pod</span>
<span class="n">metadata</span><span class="o">:</span>
  <span class="n">creationTimestamp</span><span class="o">:</span> <span class="s2">&quot;2020-01-10T08:07:04Z&quot;</span>
  <span class="n">name</span><span class="o">:</span> <span class="n">goapp</span><span class="o">-</span><span class="n">pod</span>
  <span class="kd">namespace</span><span class="o">:</span> <span class="k">default</span>
  <span class="n">resourceVersion</span><span class="o">:</span> <span class="s2">&quot;3086366&quot;</span>
  <span class="n">selfLink</span><span class="o">:</span> <span class="sr">/api/v1/namespaces/default/pods/g</span><span class="n">oapp</span><span class="o">-</span><span class="n">pod</span>
  <span class="n">uid</span><span class="o">:</span> <span class="mi">18</span><span class="n">cf0ed0</span><span class="o">-</span><span class="n">be56</span><span class="o">-</span><span class="mi">4</span><span class="n">b54</span><span class="o">-</span><span class="mi">869</span><span class="n">c</span><span class="o">-</span><span class="mi">4473117800</span><span class="n">b1</span>
<span class="n">spec</span><span class="o">:</span>
  <span class="n">containers</span><span class="o">:</span>
  <span class="o">-</span> <span class="n">image</span><span class="o">:</span> <span class="n">dangtong</span><span class="o">/</span><span class="n">goapp</span>
    <span class="n">imagePullPolicy</span><span class="o">:</span> <span class="n">Always</span>
    <span class="n">name</span><span class="o">:</span> <span class="n">goapp</span><span class="o">-</span><span class="n">container</span>
    <span class="n">ports</span><span class="o">:</span>
    <span class="o">-</span> <span class="n">containerPort</span><span class="o">:</span> <span class="mi">8080</span>
      <span class="n">protocol</span><span class="o">:</span> <span class="n">TCP</span>
    <span class="n">resources</span><span class="o">:</span> <span class="o">{}</span>
    <span class="n">terminationMessagePath</span><span class="o">:</span> <span class="sr">/dev/</span><span class="n">termination</span><span class="o">-</span><span class="n">log</span>
    <span class="n">terminationMessagePolicy</span><span class="o">:</span> <span class="n">File</span>
    <span class="n">volumeMounts</span><span class="o">:</span>
    <span class="o">-</span> <span class="n">mountPath</span><span class="o">:</span> <span class="sr">/var/run/secrets/kubernetes.io/s</span><span class="n">erviceaccount</span>
      <span class="n">name</span><span class="o">:</span> <span class="k">default</span><span class="o">-</span><span class="n">token</span><span class="o">-</span><span class="n">qz4fh</span>
      <span class="n">readOnly</span><span class="o">:</span> <span class="kc">true</span>
  <span class="n">dnsPolicy</span><span class="o">:</span> <span class="n">ClusterFirst</span>
  <span class="n">enableServiceLinks</span><span class="o">:</span> <span class="kc">true</span>
  <span class="n">nodeName</span><span class="o">:</span> <span class="n">worker02</span><span class="o">.</span><span class="na">sas</span><span class="o">.</span><span class="na">com</span>
  <span class="n">priority</span><span class="o">:</span> <span class="mi">0</span>
  <span class="n">restartPolicy</span><span class="o">:</span> <span class="n">Always</span>
  <span class="n">schedulerName</span><span class="o">:</span> <span class="k">default</span><span class="o">-</span><span class="n">scheduler</span>
  <span class="n">securityContext</span><span class="o">:</span> <span class="o">{}</span>
  <span class="n">serviceAccount</span><span class="o">:</span> <span class="k">default</span>
  <span class="n">serviceAccountName</span><span class="o">:</span> <span class="k">default</span>
  <span class="n">terminationGracePeriodSeconds</span><span class="o">:</span> <span class="mi">30</span>
  <span class="n">tolerations</span><span class="o">:</span>
  <span class="o">-</span> <span class="n">effect</span><span class="o">:</span> <span class="n">NoExecute</span>
    <span class="n">key</span><span class="o">:</span> <span class="n">node</span><span class="o">.</span><span class="na">kubernetes</span><span class="o">.</span><span class="na">io</span><span class="o">/</span><span class="n">not</span><span class="o">-</span><span class="n">ready</span>
    <span class="n">operator</span><span class="o">:</span> <span class="n">Exists</span>
    <span class="n">tolerationSeconds</span><span class="o">:</span> <span class="mi">300</span>
  <span class="o">-</span> <span class="n">effect</span><span class="o">:</span> <span class="n">NoExecute</span>
    <span class="n">key</span><span class="o">:</span> <span class="n">node</span><span class="o">.</span><span class="na">kubernetes</span><span class="o">.</span><span class="na">io</span><span class="o">/</span><span class="n">unreachable</span>
    <span class="n">operator</span><span class="o">:</span> <span class="n">Exists</span>
    <span class="n">tolerationSeconds</span><span class="o">:</span> <span class="mi">300</span>
  <span class="n">volumes</span><span class="o">:</span>
  <span class="o">-</span> <span class="n">name</span><span class="o">:</span> <span class="k">default</span><span class="o">-</span><span class="n">token</span><span class="o">-</span><span class="n">qz4fh</span>
    <span class="n">secret</span><span class="o">:</span>
      <span class="n">defaultMode</span><span class="o">:</span> <span class="mi">420</span>
      <span class="n">secretName</span><span class="o">:</span> <span class="k">default</span><span class="o">-</span><span class="n">token</span><span class="o">-</span><span class="n">qz4fh</span>
<span class="n">status</span><span class="o">:</span>
  <span class="n">conditions</span><span class="o">:</span>
  <span class="o">-</span> <span class="n">lastProbeTime</span><span class="o">:</span> <span class="kc">null</span>
    <span class="n">lastTransitionTime</span><span class="o">:</span> <span class="s2">&quot;2020-01-10T08:07:04Z&quot;</span>
    <span class="n">status</span><span class="o">:</span> <span class="s2">&quot;True&quot;</span>
    <span class="n">type</span><span class="o">:</span> <span class="n">Initialized</span>
  <span class="o">-</span> <span class="n">lastProbeTime</span><span class="o">:</span> <span class="kc">null</span>
    <span class="n">lastTransitionTime</span><span class="o">:</span> <span class="s2">&quot;2020-01-10T08:07:09Z&quot;</span>
    <span class="n">status</span><span class="o">:</span> <span class="s2">&quot;True&quot;</span>
    <span class="n">type</span><span class="o">:</span> <span class="n">Ready</span>
  <span class="o">-</span> <span class="n">lastProbeTime</span><span class="o">:</span> <span class="kc">null</span>
    <span class="n">lastTransitionTime</span><span class="o">:</span> <span class="s2">&quot;2020-01-10T08:07:09Z&quot;</span>
    <span class="n">status</span><span class="o">:</span> <span class="s2">&quot;True&quot;</span>
    <span class="n">type</span><span class="o">:</span> <span class="n">ContainersReady</span>
  <span class="o">-</span> <span class="n">lastProbeTime</span><span class="o">:</span> <span class="kc">null</span>
    <span class="n">lastTransitionTime</span><span class="o">:</span> <span class="s2">&quot;2020-01-10T08:07:04Z&quot;</span>
    <span class="n">status</span><span class="o">:</span> <span class="s2">&quot;True&quot;</span>
    <span class="n">type</span><span class="o">:</span> <span class="n">PodScheduled</span>
  <span class="n">containerStatuses</span><span class="o">:</span>
  <span class="o">-</span> <span class="n">containerID</span><span class="o">:</span> <span class="n">docker</span><span class="o">://</span><span class="n">d76af359c556c60d3ac1957d7498513f42ace14998c763456190274a3e4a1d5e</span>
    <span class="n">image</span><span class="o">:</span> <span class="n">dangtong</span><span class="o">/</span><span class="n">goapp</span><span class="o">:</span><span class="n">latest</span>
    <span class="n">imageID</span><span class="o">:</span> <span class="n">docker</span><span class="o">-</span><span class="n">pullable</span><span class="o">://</span><span class="n">dangtong</span><span class="o">/</span><span class="n">goapp</span><span class="err">@</span><span class="n">sha256</span><span class="o">:</span><span class="n">e5872256539152aecd2a8fb1f079e132a6a8f247c7a2295f0946ce2005e36d05</span>
    <span class="n">lastState</span><span class="o">:</span> <span class="o">{}</span>
    <span class="n">name</span><span class="o">:</span> <span class="n">goapp</span><span class="o">-</span><span class="n">container</span>
    <span class="n">ready</span><span class="o">:</span> <span class="kc">true</span>
    <span class="n">restartCount</span><span class="o">:</span> <span class="mi">0</span>
    <span class="n">started</span><span class="o">:</span> <span class="kc">true</span>
    <span class="n">state</span><span class="o">:</span>
      <span class="n">running</span><span class="o">:</span>
        <span class="n">startedAt</span><span class="o">:</span> <span class="s2">&quot;2020-01-10T08:07:08Z&quot;</span>
  <span class="n">hostIP</span><span class="o">:</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">2.5</span>
  <span class="n">phase</span><span class="o">:</span> <span class="n">Running</span>
  <span class="n">podIP</span><span class="o">:</span> <span class="mf">10.32</span><span class="o">.</span><span class="mf">0.4</span>
  <span class="n">podIPs</span><span class="o">:</span>
  <span class="o">-</span> <span class="n">ip</span><span class="o">:</span> <span class="mf">10.32</span><span class="o">.</span><span class="mf">0.4</span>
  <span class="n">qosClass</span><span class="o">:</span> <span class="n">BestEffort</span>
  <span class="n">startTime</span><span class="o">:</span> <span class="s2">&quot;2020-01-10T08:07:04Z&quot;</span>
</pre></div>


<h3 id="63-lable-pod">6.3 Lable을 이용한 POD 스케줄링</h3>
<ul>
<li>노드목록 조회</li>
</ul>
<div class="codehilite"><pre><span></span>kubectl get nodes
</pre></div>


<p>[output]</p>
<div class="codehilite"><pre><span></span>NAME               STATUS   ROLES    AGE   VERSION
master.sas.com     Ready    master   16d   v1.17.0
worker01.sas.com   Ready    &lt;none&gt;   16d   v1.17.0
worker02.sas.com   Ready    &lt;none&gt;   16d   v1.17.0
</pre></div>


<ul>
<li>특정 노드에 레이블 부여</li>
</ul>
<div class="codehilite"><pre><span></span>kubectl label node worker02.sas.com <span class="nv">memsize</span><span class="o">=</span>high
</pre></div>


<ul>
<li>레이블 조회 필터 사용하여 조회</li>
</ul>
<div class="codehilite"><pre><span></span>kubectl get nodes -l <span class="nv">memsize</span><span class="o">=</span>high
</pre></div>


<p>[output]</p>
<div class="codehilite"><pre><span></span>NAME               STATUS   ROLES    AGE   VERSION
worker02.sas.com   Ready    &lt;none&gt;   17d   v1.17.0
</pre></div>


<ul>
<li>특정 노드에 신규 POD 스케줄링</li>
</ul>
<p>아래 내용과 같이 goapp-label-node.yaml 파을을 작성 합니다.</p>
<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">apiVersion</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">goapp-pod-memhigh</span>
<span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">nodeSelector</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">memsize</span><span class="p p-Indicator">:</span> <span class="s">&quot;high&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">containers</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">dangtong/goapp</span>
    <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">goapp-container-memhigh</span>
</pre></div>


<ul>
<li>YAML 파일을 이용한 POD 스케줄링</li>
</ul>
<div class="codehilite"><pre><span></span>kubectl create -f ./goapp-lable-node.yaml
</pre></div>


<p>[output]</p>
<div class="codehilite"><pre><span></span>pod/goapp-pod-memhigh created
</pre></div>


<ul>
<li>생성된 노드 조회</li>
</ul>
<div class="codehilite"><pre><span></span>kubectl get pod -o wide
</pre></div>


<p>[output]</p>
<div class="codehilite"><pre><span></span>NAME                  READY   STATUS    RESTARTS   AGE    IP          NODE               NOMINATED NODE   READINESS GATES
goapp-pod-memhigh     1/1     Running   0          17s    10.32.0.5   worker02.sas.com   &lt;none&gt;           &lt;none&gt;
</pre></div>


<h2 id="7-annotation">7.   Annotation</h2>
<h3 id="71-pod-annotation">7.1 POD 에 Annotation 추가하기</h3>
<div class="codehilite"><pre><span></span>kubectl annotate pod goapp-pod-memhigh <span class="nv">maker</span><span class="o">=</span><span class="s2">&quot;dangtong&quot;</span> <span class="nv">team</span><span class="o">=</span><span class="s2">&quot;k8s-team&quot;</span>
</pre></div>


<p>[output]</p>
<div class="codehilite"><pre><span></span>pod/goapp-pod-memhigh annotated
</pre></div>


<h3 id="72-annotation">7.2 Annotation 확인하기</h3>
<ul>
<li>YAML 파일을 통해 확인하기</li>
</ul>
<div class="codehilite"><pre><span></span>kubectl get po goapp-pod-memhigh -o yaml
</pre></div>


<p>[output]</p>
<div class="codehilite"><pre><span></span><span class="n">kind</span><span class="o">:</span> <span class="n">Pod</span>
<span class="n">metadata</span><span class="o">:</span>
  <span class="n">annotations</span><span class="o">:</span>
    <span class="n">maker</span><span class="o">:</span> <span class="n">dangtong</span>
    <span class="n">team</span><span class="o">:</span> <span class="n">k8s</span><span class="o">-</span><span class="n">team</span>
  <span class="n">creationTimestamp</span><span class="o">:</span> <span class="s2">&quot;2020-01-12T15:25:05Z&quot;</span>
  <span class="n">name</span><span class="o">:</span> <span class="n">goapp</span><span class="o">-</span><span class="n">pod</span><span class="o">-</span><span class="n">memhigh</span>
  <span class="kd">namespace</span><span class="o">:</span> <span class="k">default</span>
  <span class="n">resourceVersion</span><span class="o">:</span> <span class="s2">&quot;3562877&quot;</span>
  <span class="n">selfLink</span><span class="o">:</span> <span class="sr">/api/v1/namespaces/default/pods/g</span><span class="n">oapp</span><span class="o">-</span><span class="n">pod</span><span class="o">-</span><span class="n">memhigh</span>
  <span class="n">uid</span><span class="o">:</span> <span class="n">a12c35d7</span><span class="o">-</span><span class="n">d0e6</span><span class="o">-</span><span class="mi">4</span><span class="n">c01</span><span class="o">-</span><span class="n">b607</span><span class="o">-</span><span class="n">cccd267e39ec</span>
<span class="n">spec</span><span class="o">:</span>
  <span class="n">containers</span><span class="o">:</span>
</pre></div>


<ul>
<li>DESCRIBE 를 통해 확인하기</li>
</ul>
<div class="codehilite"><pre><span></span>kubectl describe pod goapp-pod-memhigh
</pre></div>


<p>[output]</p>
<div class="codehilite"><pre><span></span><span class="n">Name</span><span class="p">:</span>         <span class="n">goapp</span><span class="o">-</span><span class="n">pod</span><span class="o">-</span><span class="n">memhigh</span>
<span class="n">Namespace</span><span class="p">:</span>    <span class="k">default</span>
<span class="n">Priority</span><span class="p">:</span>     <span class="mi">0</span>
<span class="n">Node</span><span class="p">:</span>         <span class="n">worker02</span><span class="p">.</span><span class="n">sas</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="mf">10.0</span><span class="p">.</span><span class="mf">2.5</span>
<span class="n">Start</span> <span class="n">Time</span><span class="p">:</span>   <span class="n">Mon</span><span class="p">,</span> <span class="mi">13</span> <span class="n">Jan</span> <span class="mi">2020</span> <span class="mi">00</span><span class="p">:</span><span class="mi">25</span><span class="p">:</span><span class="mi">05</span> <span class="o">+</span><span class="mi">0900</span>
<span class="n">Labels</span><span class="p">:</span>       <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
<span class="n">Annotations</span><span class="p">:</span>  <span class="n">maker</span><span class="p">:</span> <span class="n">dangtong</span>
              <span class="n">team</span><span class="p">:</span> <span class="n">k8s</span><span class="o">-</span><span class="n">team</span>
<span class="n">Status</span><span class="p">:</span>       <span class="n">Running</span>
<span class="n">IP</span><span class="p">:</span>           <span class="mf">10.32</span><span class="p">.</span><span class="mf">0.5</span>
</pre></div>


<h3 id="73-annotation">7.3 Annotation 삭제</h3>
<div class="codehilite"><pre><span></span>kubectl annotate pod  goapp-pod-memhigh <span class="nv">maker</span><span class="o">=</span>make- team-
</pre></div>


<h3 id="exercise-3">[[Exercise #3]]</h3>
<ul>
<li>Bitnami/apache 이미지로 Pod 를 만들고 tier=FronEnd, app=apache  라벨 정보를 포함하세요</li>
<li>Pod 정보를 출력 할때 라벨을 함께 출력 하세요</li>
<li>app=apache 라벨틀 가진 Pod 만 조회 하세요</li>
<li>만들어진 Pod에 env=dev 라는 라벨 정보를 추가 하세요</li>
<li>created_by=kevin 이라는 Annotation을 추가 하세요</li>
<li>만들어진 Pod (app=nginx) 에 rel=beta 라벨을 추가 하세요</li>
<li>apache Pod를 삭제 하세요</li>
</ul>
<h2 id="8-namespace">8. Namespace</h2>
<h3 id="81">8.1 네임스페이스 조회</h3>
<div class="codehilite"><pre><span></span>kubectl get namespace
</pre></div>


<blockquote>
<p>kubectl get ns 와 동일함</p>
</blockquote>
<p>[output]</p>
<div class="codehilite"><pre><span></span>NAME              STATUS   AGE
default           Active   17d
kube-node-lease   Active   17d
kube-public       Active   17d
kube-system       Active   17d
</pre></div>


<h3 id="82-pod">8.2 특정 네임스페이스의 POD 조회</h3>
<div class="codehilite"><pre><span></span>kubectl get pod --namespace kube-system
</pre></div>


<blockquote>
<p>kubectl get pod -n kube-system 과 동일함</p>
</blockquote>
<p>[output]</p>
<div class="codehilite"><pre><span></span>coredns-6955765f44-glcdc                 1/1     Running   0          17d
coredns-6955765f44-h7fbb                 1/1     Running   0          17d
etcd-master.sas.com                      1/1     Running   1          17d
kube-apiserver-master.sas.com            1/1     Running   1          17d
kube-controller-manager-master.sas.com   1/1     Running   1          17d
kube-proxy-gm44f                         1/1     Running   1          17d
kube-proxy-ngqr6                         1/1     Running   0          17d
kube-proxy-wmq7d                         1/1     Running   0          17d
kube-scheduler-master.sas.com            1/1     Running   1          17d
weave-net-2pm2x                          2/2     Running   0          17d
weave-net-4wksv                          2/2     Running   0          17d
weave-net-7j7mn                          2/2     Running   0          17d
</pre></div>


<h3 id="83-yaml">8.3 YAML 파일을 이용한 네임스페이스 생성</h3>
<ul>
<li>YAML 파일 작성 : first-namespace.yaml 이름으로 파일 작성</li>
</ul>
<div class="codehilite"><pre><span></span>apiVersion: v1
kind: Namespace
metadata:
  name: first-namespace
</pre></div>


<ul>
<li>YAML 파일을 이용한 네이스페이스 생성</li>
</ul>
<div class="codehilite"><pre><span></span>kubectl create -f first-namespace.yaml
</pre></div>


<p>[output]</p>
<div class="codehilite"><pre><span></span>namespace/first-namespace created
</pre></div>


<ul>
<li>생성된 네임스페이스 확인</li>
</ul>
<div class="codehilite"><pre><span></span>kubectl get namespace
kubectl get ns
</pre></div>


<p>[output]</p>
<div class="codehilite"><pre><span></span>NAME              STATUS   AGE
default           Active   17d
first-namespace   Active   5s
kube-node-lease   Active   17d
kube-public       Active   17d
kube-system       Active   17d
</pre></div>


<blockquote>
<p>kubectl create namespace first-namespace 와 동일 합니다.</p>
</blockquote>
<h3 id="84-pod">8.4 특정 네임스페이스에 POD 생성</h3>
<ul>
<li>first-namespace 에 goapp 생성</li>
</ul>
<div class="codehilite"><pre><span></span>kubectl create -f goapp.yaml -n first-namespace
</pre></div>


<p>[output]</p>
<div class="codehilite"><pre><span></span>pod/goapp-pod created
</pre></div>


<ul>
<li>생성된 POD 확인하기</li>
</ul>
<div class="codehilite"><pre><span></span>kubectl get pod -n first-namespace
</pre></div>


<p>[output]</p>
<div class="codehilite"><pre><span></span>NAME        READY   STATUS    RESTARTS   AGE
goapp-pod   1/1     Running   0          12h
</pre></div>


<h3 id="85-pod">8.5 POD 삭제</h3>
<div class="codehilite"><pre><span></span><span class="s1">&#39;kubectl&#39;</span> delete pod goapp-pod-memhigh
</pre></div>


<div class="codehilite"><pre><span></span>kubectl delete pod goapp-pod
</pre></div>


<div class="codehilite"><pre><span></span>kubectl delete pod goapp-pod -n first-namespace
</pre></div>


<blockquote>
<p>현재 네임스페이스 에서 존재 하는 모든 리소스를 삭제하는 명령은 아래와 같습니다.</p>
<p>kubectl delete all --all</p>
<p>현재 네임스페이스를 설정하고 조회 하는 명령은 아래와 같습니다.</p>
<p>```shell</p>
<h1 id="_1">네임스페이스 설정</h1>
<p>kubectl config set-context --current --namespace=<insert-namespace-name-here></p>
<h1 id="_2">확인</h1>
<p>kubectl config view --minify | grep namespace:
```</p>
</blockquote>
<h3 id="exercise-4">[[ Exercise #4 ]]</h3>
<ol>
<li>
<p>쿠버네티스 클러스터에 몇개의 네임스페이가 존재 하나요?</p>
</li>
<li>
<p>my-dev 라는 네임스페이를 생성하고 nginx Pod를 배포 하세요</p>
</li>
</ol>
<h2 id="9-kubectl">9. kubectl 기본 사용법</h2>
<h3 id="91">9.1 단축형 키워드 사용하기</h3>
<div class="codehilite"><pre><span></span>kubectl get po          <span class="c1"># PODs</span>
kubectl get svc         <span class="c1"># Service</span>
kubectl get rc          <span class="c1"># Replication Controller</span>
kubectl get deploy  <span class="c1"># Deployment</span>
kubectl get ns          <span class="c1"># Namespace</span>
kubectl get no          <span class="c1"># Node</span>
kubectl get cm          <span class="c1"># Configmap</span>
kubectl get pv          <span class="c1"># PersistentVolumns</span>
</pre></div>


<h3 id="92">9.2 도움말 보기</h3>
<div class="codehilite"><pre><span></span>kubectl -h
</pre></div>


<div class="codehilite"><pre><span></span>kubectl controls the Kubernetes cluster manager.

 Find more information at: https://kubernetes.io/docs/reference/kubectl/overview/

Basic Commands (Beginner):
  create         Create a resource from a file or from stdin.
  expose         Take a replication controller, service, deployment or pod and expose it as a new Kubernetes Service
  run            Run a particular image on the cluster
  set            Set specific features on objects

Basic Commands (Intermediate):
  explain        Documentation of resources
  get            Display one or many resources
  edit           Edit a resource on the server
  delete         Delete resources by filenames, stdin, resources and names, or by resources and label selector

Deploy Commands:
</pre></div>


<div class="codehilite"><pre><span></span>kubectl get -h
</pre></div>


<div class="codehilite"><pre><span></span>Display one or many resources

 Prints a table of the most important information about the specified resources. You can filter the list using a label
selector and the --selector flag. If the desired resource type is namespaced you will only see results in your current
namespace unless you pass --all-namespaces.

 Uninitialized objects are not shown unless --include-uninitialized is passed.

 By specifying the output as &#39;template&#39; and providing a Go template as the value of the --template flag, you can filter
the attributes of the fetched resources.

Use &quot;kubectl api-resources&quot; for a complete list of supported resources.

Examples:
  # List all pods in ps output format.
  kubectl get pods

  # List all pods in ps output format with more information (such as node name).
  kubectl get pods -o wide
</pre></div>


<h3 id="93">9.3 리소스 정의에 대한 도움말</h3>
<div class="codehilite"><pre><span></span>kubectl explain pods
</pre></div>


<div class="codehilite"><pre><span></span><span class="n">KIND</span><span class="o">:</span>     <span class="n">Pod</span>
<span class="n">VERSION</span><span class="o">:</span>  <span class="n">v1</span>

<span class="n">DESCRIPTION</span><span class="o">:</span>
     <span class="n">Pod</span> <span class="k">is</span> <span class="n">a</span> <span class="n">collection</span> <span class="n">of</span> <span class="n">containers</span> <span class="n">that</span> <span class="n">can</span> <span class="n">run</span> <span class="n">on</span> <span class="n">a</span> <span class="n">host</span><span class="o">.</span> <span class="n">This</span> <span class="n">resource</span> <span class="k">is</span>
     <span class="n">created</span> <span class="n">by</span> <span class="n">clients</span> <span class="n">and</span> <span class="n">scheduled</span> <span class="n">onto</span> <span class="n">hosts</span><span class="o">.</span>

<span class="n">FIELDS</span><span class="o">:</span>
   <span class="n">apiVersion</span>   <span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span>
     <span class="n">APIVersion</span> <span class="n">defines</span> <span class="n">the</span> <span class="n">versioned</span> <span class="n">schema</span> <span class="n">of</span> <span class="k">this</span> <span class="n">representation</span> <span class="n">of</span> <span class="n">an</span>
     <span class="n">object</span><span class="o">.</span> <span class="n">Servers</span> <span class="n">should</span> <span class="n">convert</span> <span class="n">recognized</span> <span class="n">schemas</span> <span class="n">to</span> <span class="n">the</span> <span class="n">latest</span> <span class="kd">internal</span>
     <span class="n">value</span><span class="o">,</span> <span class="n">and</span> <span class="n">may</span> <span class="n">reject</span> <span class="n">unrecognized</span> <span class="n">values</span><span class="o">.</span> <span class="n">More</span> <span class="n">info</span><span class="o">:</span>
     <span class="n">https</span><span class="o">://</span><span class="n">git</span><span class="o">.</span><span class="na">k8s</span><span class="o">.</span><span class="na">io</span><span class="sr">/community/contributors/devel/sig-architecture/</span><span class="n">api</span><span class="o">-</span><span class="n">conventions</span><span class="o">.</span><span class="na">md</span><span class="err">#</span><span class="n">resources</span>

   <span class="n">kind</span> <span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span>
     <span class="n">Kind</span> <span class="k">is</span> <span class="n">a</span> <span class="n">string</span> <span class="n">value</span> <span class="n">representing</span> <span class="n">the</span> <span class="n">REST</span> <span class="n">resource</span> <span class="k">this</span> <span class="n">object</span>
     <span class="n">represents</span><span class="o">.</span> <span class="n">Servers</span> <span class="n">may</span> <span class="n">infer</span> <span class="k">this</span> <span class="n">from</span> <span class="n">the</span> <span class="n">endpoint</span> <span class="n">the</span> <span class="n">client</span> <span class="n">submits</span>
     <span class="n">requests</span> <span class="n">to</span><span class="o">.</span> <span class="n">Cannot</span> <span class="n">be</span> <span class="n">updated</span><span class="o">.</span> <span class="n">In</span> <span class="n">CamelCase</span><span class="o">.</span> <span class="n">More</span> <span class="n">info</span><span class="o">:</span>
     <span class="n">https</span><span class="o">://</span><span class="n">git</span><span class="o">.</span><span class="na">k8s</span><span class="o">.</span><span class="na">io</span><span class="sr">/community/contributors/devel/sig-architecture/</span><span class="n">api</span><span class="o">-</span><span class="n">conventions</span><span class="o">.</span><span class="na">md</span><span class="err">#</span><span class="n">types</span><span class="o">-</span><span class="n">kinds</span>

   <span class="n">metadata</span> <span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span>
     <span class="n">Standard</span> <span class="n">object</span><span class="err">&#39;</span><span class="n">s</span> <span class="n">metadata</span><span class="o">.</span> <span class="n">More</span> <span class="n">info</span><span class="o">:</span>
     <span class="n">https</span><span class="o">://</span><span class="n">git</span><span class="o">.</span><span class="na">k8s</span><span class="o">.</span><span class="na">io</span><span class="sr">/community/contributors/devel/sig-architecture/</span><span class="n">api</span><span class="o">-</span><span class="n">conventions</span><span class="o">.</span><span class="na">md</span><span class="err">#</span><span class="n">metadata</span>

   <span class="n">spec</span> <span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span>
     <span class="n">Specification</span> <span class="n">of</span> <span class="n">the</span> <span class="n">desired</span> <span class="n">behavior</span> <span class="n">of</span> <span class="n">the</span> <span class="n">pod</span><span class="o">.</span> <span class="n">More</span> <span class="n">info</span><span class="o">:</span>
     <span class="n">https</span><span class="o">://</span><span class="n">git</span><span class="o">.</span><span class="na">k8s</span><span class="o">.</span><span class="na">io</span><span class="sr">/community/contributors/devel/sig-architecture/</span><span class="n">api</span><span class="o">-</span><span class="n">conventions</span><span class="o">.</span><span class="na">md</span><span class="err">#</span><span class="n">spec</span><span class="o">-</span><span class="n">and</span><span class="o">-</span><span class="n">status</span>

   <span class="n">status</span>   <span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span>
     <span class="n">Most</span> <span class="n">recently</span> <span class="n">observed</span> <span class="n">status</span> <span class="n">of</span> <span class="n">the</span> <span class="n">pod</span><span class="o">.</span> <span class="n">This</span> <span class="n">data</span> <span class="n">may</span> <span class="n">not</span> <span class="n">be</span> <span class="n">up</span> <span class="n">to</span> <span class="n">date</span><span class="o">.</span>
     <span class="n">Populated</span> <span class="n">by</span> <span class="n">the</span> <span class="n">system</span><span class="o">.</span> <span class="n">Read</span><span class="o">-</span><span class="n">only</span><span class="o">.</span> <span class="n">More</span> <span class="n">info</span><span class="o">:</span>
     <span class="n">https</span><span class="o">://</span><span class="n">git</span><span class="o">.</span><span class="na">k8s</span><span class="o">.</span><span class="na">io</span><span class="sr">/community/contributors/devel/sig-architecture/</span><span class="n">api</span><span class="o">-</span><span class="n">conventions</span><span class="o">.</span><span class="na">md</span><span class="err">#</span><span class="n">spec</span><span class="o">-</span><span class="n">and</span><span class="o">-</span><span class="n">status</span>
</pre></div>


<h3 id="94">9.4 리소스 감시하기</h3>
<ul>
<li>Kube-system 네임스페이스에 있는 모든 pod에 대해 모니터링 합니다.</li>
</ul>
<div class="codehilite"><pre><span></span>kubectl get pods --watch -n kube-system
</pre></div>


<div class="codehilite"><pre><span></span>root@master:~# k get pods --watch -n kube-system
NAME                                     READY   STATUS    RESTARTS   AGE
coredns-6955765f44-glcdc                 1/1     Running   0          19d
coredns-6955765f44-h7fbb                 1/1     Running   0          19d
etcd-master.sas.com                      1/1     Running   1          19d
kube-apiserver-master.sas.com            1/1     Running   1          19d
kube-controller-manager-master.sas.com   1/1     Running   1          19d
kube-proxy-gm44f                         1/1     Running   1          19d
kube-proxy-ngqr6                         1/1     Running   0          19d
kube-proxy-wmq7d                         1/1     Running   0          19d
kube-scheduler-master.sas.com            1/1     Running   1          19d
weave-net-2pm2x                          2/2     Running   0          19d
weave-net-4wksv                          2/2     Running   0          19d
weave-net-7j7mn                          2/2     Running   0          19d
...
</pre></div>


<h3 id="95">9.5 리소스 비교하기</h3>
<div class="codehilite"><pre><span></span>kubectl diff -f goapp.yaml
</pre></div>


<h3 id="96-kubectx-kubens">9.6 kubectx 및 kubens 사용하기</h3>
<p>현재 컨텍스트 및 네임스페이스를 확인하고 전환 할때 손쉽게 사용 할수 있는 도구</p>
<h4 id="961-kubectx-kubens">9.6.1 kubectx 및 kubens 설치</h4>
<div class="codehilite"><pre><span></span>git clone https://github.com/ahmetb/kubectx.git ~/.kubectx
<span class="nv">COMPDIR</span><span class="o">=</span><span class="k">$(</span>pkg-config --variable<span class="o">=</span>completionsdir bash-completion<span class="k">)</span>
ln -sf ~/.kubectx/completion/kubens.bash <span class="nv">$COMPDIR</span>/kubens
ln -sf ~/.kubectx/completion/kubectx.bash <span class="nv">$COMPDIR</span>/kubectx
cat <span class="s">&lt;&lt; FOE &gt;&gt; ~/.bashrc</span>


<span class="s">#kubectx and kubens</span>
<span class="s">export PATH=~/.kubectx:\$PATH</span>
<span class="s">FOE</span>
</pre></div>


<h4 id="962-kubectx-kubens">9.6.2 kubectx 및 kubens 사용</h4>
<ul>
<li>kubectx 사용</li>
</ul>
<div class="codehilite"><pre><span></span>kubectx
kubectx &lt;변경하고 싶은 컨텍스트 이름&gt;
</pre></div>


<ul>
<li>kubens 사용 </li>
</ul>
<p>현재 사용중인 네임스페이스를  조회 합니다.  현재 사용중인 네이스페이스는 하이라이트 됩니다.</p>
<div class="codehilite"><pre><span></span>kubens
</pre></div>


<div class="codehilite"><pre><span></span>default
first-namespace
kube-node-lease
kube-public
kube-system
</pre></div>


<p>Kube-system 네이스페이스로 전환 해봅니다.</p>
<div class="codehilite"><pre><span></span>kubens kube-system
</pre></div>


<div class="codehilite"><pre><span></span>Context &quot;kubernetes-admin@kubernetes&quot; modified.
Active namespace is &quot;kube-system&quot;.
</pre></div>


<p>pod 조회 명령을 내리면 아래와 같이 kube-system 네임스페이스의 pod 들이 조회 됩니다.</p>
<div class="codehilite"><pre><span></span>kubectl get po
</pre></div>


<div class="codehilite"><pre><span></span>NAME                                     READY   STATUS    RESTARTS   AGE
coredns-6955765f44-glcdc                 <span class="m">1</span>/1     Running   <span class="m">0</span>          34d
coredns-6955765f44-h7fbb                 <span class="m">1</span>/1     Running   <span class="m">0</span>          34d
etcd-master.sas.com                      <span class="m">1</span>/1     Running   <span class="m">1</span>          34d
kube-apiserver-master.sas.com            <span class="m">1</span>/1     Running   <span class="m">1</span>          34d
kube-controller-manager-master.sas.com   <span class="m">1</span>/1     Running   <span class="m">1</span>          34d
kube-proxy-gm44f                         <span class="m">1</span>/1     Running   <span class="m">1</span>          34d
kube-proxy-ngqr6                         <span class="m">1</span>/1     Running   <span class="m">0</span>          34d
kube-proxy-wmq7d                         <span class="m">1</span>/1     Running   <span class="m">0</span>          34d
kube-scheduler-master.sas.com            <span class="m">1</span>/1     Running   <span class="m">1</span>          34d
weave-net-2pm2x                          <span class="m">2</span>/2     Running   <span class="m">0</span>          34d
weave-net-4wksv                          <span class="m">2</span>/2     Running   <span class="m">0</span>          34d
weave-net-7j7mn                          <span class="m">2</span>/2     Running   <span class="m">0</span>          34d
</pre></div>


<h3 id="97-kubernetes">9.7  kubernetes 컨텍 및 네임스페이스 표시하기</h3>
<p>kube-ps1을 다운로드 하여 /usr/local/kube-ps1 설치 하고 .bashrc 파일에 아래와 같이 설정 합니다.  <a href="https://github.com/jonmosco/kube-ps1">링크</a></p>
<div class="codehilite"><pre><span></span><span class="nb">source</span> /usr/local/kube-ps1/kube-ps1.sh
<span class="nv">PS1</span><span class="o">=</span><span class="s1">&#39;[\u@\h \W $(kube_ps1)]\$ &#39;</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="o">[</span>root@master ~ <span class="o">(</span>⎈ <span class="p">|</span>kubernetes-admin@kubernetes:kube-public<span class="o">)]</span><span class="c1">#</span>
</pre></div>


<h2 id="10-liveness-probes">10. Liveness probes</h2>
<p>liveness prove는 Pod에 지정된 주소에 Health Check 를 수행하고 실패할 경우 Pod를 다시 시작 합니다.</p>
<p>이때 중요한 점은 단순히 다시 시작만 하는 것이 아니라, 리포지토리로 부터 이미지를 다시 받아 Pod 를 다시 시작 합니다. </p>
<p>아래 내용으로. </p>
<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">apiVersion</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">labels</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">test</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">liveness</span>
  <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">liveness-http</span>
<span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">containers</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">liveness</span>
    <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">k8s.gcr.io/liveness</span>
    <span class="l l-Scalar l-Scalar-Plain">args</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">/server</span>
    <span class="l l-Scalar l-Scalar-Plain">livenessProbe</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">httpGet</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">path</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/healthz</span>
        <span class="l l-Scalar l-Scalar-Plain">port</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">8080</span>
        <span class="l l-Scalar l-Scalar-Plain">httpHeaders</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Custom-Header</span>
          <span class="l l-Scalar l-Scalar-Plain">value</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Awesome</span>
      <span class="l l-Scalar l-Scalar-Plain">initialDelaySeconds</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
      <span class="l l-Scalar l-Scalar-Plain">periodSeconds</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
</pre></div>


<p>K8s.gcr.io/liveness 이미지는 liveness 테스트를 위해 만들어진 이미지 입니다. Go 언어로 작성 되었으며, 처음 10초 동안은 정상적인 서비스를 하지만, 10초 후에는 에러를 발생 시킵니다. 자세한 사항은 <a href="https://github.com/kubernetes/kubernetes/blob/master/test/images/agnhost/liveness/server.go">URL</a> 을 참고 하세요</p>
<h3 id="101-pod">10.1 Pod 생성</h3>
<div class="codehilite"><pre><span></span>kubectl create -f ./liveness-probe-pod.yaml
</pre></div>


<h3 id="102-pod">10.2 Pod 확인</h3>
<div class="codehilite"><pre><span></span>kubectl get pod
</pre></div>


<p>아래</p>
<div class="codehilite"><pre><span></span>NAME            READY   STATUS    RESTARTS   AGE
liveness-http   1/1     Running   0          5s

NAME            READY   STATUS    RESTARTS   AGE
liveness-http   1/1     Running   1          26s

NAME            READY   STATUS    RESTARTS   AGE
liveness-http   1/1     Running   3          68s

NAME            READY   STATUS             RESTARTS   AGE
liveness-http   0/1     CrashLoopBackOff   3          81s

NAME            READY   STATUS             RESTARTS   AGE
liveness-http   0/1     CrashLoopBackOff   5          2m50s
</pre></div>


<h3 id="103-pod">10.3 Pod 로그 이벤트 확인</h3>
<div class="codehilite"><pre><span></span>kubectl describe pod liveness-http
</pre></div>


<div class="codehilite"><pre><span></span><span class="n">Name</span><span class="p">:</span>         <span class="n">liveness</span><span class="o">-</span><span class="n">http</span>
<span class="n">Namespace</span><span class="p">:</span>    <span class="k">default</span>
<span class="n">Priority</span><span class="p">:</span>     <span class="mi">0</span>
<span class="n">Node</span><span class="p">:</span>         <span class="n">worker02</span><span class="p">.</span><span class="n">acorn</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="mf">192.168</span><span class="p">.</span><span class="mf">56.110</span>
<span class="n">Start</span> <span class="n">Time</span><span class="p">:</span>   <span class="n">Wed</span><span class="p">,</span> <span class="mi">01</span> <span class="n">Apr</span> <span class="mi">2020</span> <span class="mi">05</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mi">29</span> <span class="o">+</span><span class="mi">0000</span>
<span class="n">Labels</span><span class="p">:</span>       <span class="n">test</span><span class="o">=</span><span class="n">liveness</span>
<span class="n">Annotations</span><span class="p">:</span>  <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
<span class="n">Status</span><span class="p">:</span>       <span class="n">Running</span>
<span class="n">IP</span><span class="p">:</span>           <span class="mf">10.36</span><span class="p">.</span><span class="mf">0.1</span>
<span class="n">IPs</span><span class="p">:</span>
  <span class="n">IP</span><span class="p">:</span>  <span class="mf">10.36</span><span class="p">.</span><span class="mf">0.1</span>
<span class="n">Containers</span><span class="p">:</span>
  <span class="n">liveness</span><span class="p">:</span>
    <span class="n">Container</span> <span class="n">ID</span><span class="p">:</span>  <span class="n">docker</span><span class="p">:</span><span class="o">//</span><span class="mi">0f1</span><span class="n">ba830b830d5879fe99776cd0db5f3678bf52a11e3ccb1a1e9c65460957817</span>
    <span class="n">Image</span><span class="p">:</span>         <span class="n">k8s</span><span class="p">.</span><span class="n">gcr</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="n">liveness</span>
    <span class="n">Image</span> <span class="n">ID</span><span class="p">:</span>      <span class="n">docker</span><span class="o">-</span><span class="n">pullable</span><span class="p">:</span><span class="o">//</span><span class="n">k8s</span><span class="p">.</span><span class="n">gcr</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="n">liveness@sha256</span><span class="p">:</span><span class="mi">1</span><span class="n">aef943db82cf1370d0504a51061fb082b4d351171b304ad194f6297c0bb726a</span>
    <span class="n">Port</span><span class="p">:</span>          <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
    <span class="n">Host</span> <span class="n">Port</span><span class="p">:</span>     <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
    <span class="n">Args</span><span class="p">:</span>
      <span class="o">/</span><span class="n">server</span>
    <span class="n">State</span><span class="p">:</span>          <span class="n">Running</span>
      <span class="n">Started</span><span class="p">:</span>      <span class="n">Wed</span><span class="p">,</span> <span class="mi">01</span> <span class="n">Apr</span> <span class="mi">2020</span> <span class="mi">06</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">15</span> <span class="o">+</span><span class="mi">0000</span>
    <span class="n">Last</span> <span class="n">State</span><span class="p">:</span>     <span class="n">Terminated</span>
      <span class="n">Reason</span><span class="p">:</span>       <span class="k">Error</span>
      <span class="k">Exit</span> <span class="n">Code</span><span class="p">:</span>    <span class="mi">2</span>
      <span class="n">Started</span><span class="p">:</span>      <span class="n">Wed</span><span class="p">,</span> <span class="mi">01</span> <span class="n">Apr</span> <span class="mi">2020</span> <span class="mi">05</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">16</span> <span class="o">+</span><span class="mi">0000</span>
      <span class="n">Finished</span><span class="p">:</span>     <span class="n">Wed</span><span class="p">,</span> <span class="mi">01</span> <span class="n">Apr</span> <span class="mi">2020</span> <span class="mi">05</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">32</span> <span class="o">+</span><span class="mi">0000</span>
    <span class="n">Ready</span><span class="p">:</span>          <span class="k">True</span>
    <span class="n">Restart</span> <span class="n">Count</span><span class="p">:</span>  <span class="mi">7</span>
    <span class="n">Liveness</span><span class="p">:</span>       <span class="n">http</span><span class="o">-</span><span class="k">get</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="p">:</span><span class="mi">8080</span><span class="o">/</span><span class="n">healthz</span> <span class="n">delay</span><span class="o">=</span><span class="mi">3s</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1s</span> <span class="n">period</span><span class="o">=</span><span class="mi">3s</span> <span class="p">#</span><span class="n">success</span><span class="o">=</span><span class="mi">1</span> <span class="p">#</span><span class="n">failure</span><span class="o">=</span><span class="mi">3</span>
    <span class="n">Environment</span><span class="p">:</span>    <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
    <span class="n">Mounts</span><span class="p">:</span>
      <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">secrets</span><span class="o">/</span><span class="n">kubernetes</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="n">serviceaccount</span> <span class="n">from</span> <span class="k">default</span><span class="o">-</span><span class="n">token</span><span class="o">-</span><span class="n">zshgs</span> <span class="p">(</span><span class="n">ro</span><span class="p">)</span>
<span class="n">Conditions</span><span class="p">:</span>
  <span class="n">Type</span>              <span class="n">Status</span>
  <span class="n">Initialized</span>       <span class="k">True</span>
  <span class="n">Ready</span>             <span class="k">True</span>
  <span class="n">ContainersReady</span>   <span class="k">True</span>
  <span class="n">PodScheduled</span>      <span class="k">True</span>
<span class="n">Volumes</span><span class="p">:</span>
  <span class="k">default</span><span class="o">-</span><span class="n">token</span><span class="o">-</span><span class="n">zshgs</span><span class="p">:</span>
    <span class="n">Type</span><span class="p">:</span>        <span class="n">Secret</span> <span class="p">(</span><span class="n">a</span> <span class="n">volume</span> <span class="n">populated</span> <span class="n">by</span> <span class="n">a</span> <span class="n">Secret</span><span class="p">)</span>
    <span class="n">SecretName</span><span class="p">:</span>  <span class="k">default</span><span class="o">-</span><span class="n">token</span><span class="o">-</span><span class="n">zshgs</span>
    <span class="k">Optional</span><span class="p">:</span>    <span class="k">false</span>
<span class="n">QoS</span> <span class="n">Class</span><span class="p">:</span>       <span class="n">BestEffort</span>
<span class="n">Node</span><span class="o">-</span><span class="n">Selectors</span><span class="p">:</span>  <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
<span class="n">Tolerations</span><span class="p">:</span>     <span class="n">node</span><span class="p">.</span><span class="n">kubernetes</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="k">not</span><span class="o">-</span><span class="n">ready</span><span class="p">:</span><span class="n">NoExecute</span> <span class="k">for</span> <span class="mi">300s</span>
                 <span class="n">node</span><span class="p">.</span><span class="n">kubernetes</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="n">unreachable</span><span class="p">:</span><span class="n">NoExecute</span> <span class="k">for</span> <span class="mi">300s</span>
<span class="n">Events</span><span class="p">:</span>
  <span class="n">Type</span>     <span class="n">Reason</span>     <span class="n">Age</span>                    <span class="n">From</span>                         <span class="n">Message</span>
  <span class="o">----</span>     <span class="o">------</span>     <span class="o">----</span>                   <span class="o">----</span>                         <span class="o">-------</span>
  <span class="n">Normal</span>   <span class="n">Scheduled</span>  <span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span>              <span class="k">default</span><span class="o">-</span><span class="n">scheduler</span>            <span class="n">Successfully</span> <span class="n">assigned</span> <span class="k">default</span><span class="o">/</span><span class="n">liveness</span><span class="o">-</span><span class="n">http</span> <span class="k">to</span> <span class="n">worker02</span><span class="p">.</span><span class="n">acorn</span><span class="p">.</span><span class="n">com</span>
  <span class="n">Normal</span>   <span class="n">Pulled</span>     <span class="mi">6</span><span class="n">m14s</span> <span class="p">(</span><span class="n">x3</span> <span class="n">over</span> <span class="mi">6</span><span class="n">m53s</span><span class="p">)</span>  <span class="n">kubelet</span><span class="p">,</span> <span class="n">worker02</span><span class="p">.</span><span class="n">acorn</span><span class="p">.</span><span class="n">com</span>  <span class="n">Successfully</span> <span class="n">pulled</span> <span class="n">image</span> <span class="s">&quot;k8s.gcr.io/liveness&quot;</span>
  <span class="n">Normal</span>   <span class="n">Created</span>    <span class="mi">6</span><span class="n">m14s</span> <span class="p">(</span><span class="n">x3</span> <span class="n">over</span> <span class="mi">6</span><span class="n">m52s</span><span class="p">)</span>  <span class="n">kubelet</span><span class="p">,</span> <span class="n">worker02</span><span class="p">.</span><span class="n">acorn</span><span class="p">.</span><span class="n">com</span>  <span class="n">Created</span> <span class="n">container</span> <span class="n">liveness</span>
  <span class="n">Normal</span>   <span class="n">Started</span>    <span class="mi">6</span><span class="n">m14s</span> <span class="p">(</span><span class="n">x3</span> <span class="n">over</span> <span class="mi">6</span><span class="n">m52s</span><span class="p">)</span>  <span class="n">kubelet</span><span class="p">,</span> <span class="n">worker02</span><span class="p">.</span><span class="n">acorn</span><span class="p">.</span><span class="n">com</span>  <span class="n">Started</span> <span class="n">container</span> <span class="n">liveness</span>
  <span class="n">Normal</span>   <span class="n">Pulling</span>    <span class="mi">5</span><span class="n">m55s</span> <span class="p">(</span><span class="n">x4</span> <span class="n">over</span> <span class="mi">6</span><span class="n">m54s</span><span class="p">)</span>  <span class="n">kubelet</span><span class="p">,</span> <span class="n">worker02</span><span class="p">.</span><span class="n">acorn</span><span class="p">.</span><span class="n">com</span>  <span class="n">Pulling</span> <span class="n">image</span> <span class="s">&quot;k8s.gcr.io/liveness&quot;</span>
  <span class="n">Warning</span>  <span class="n">Unhealthy</span>  <span class="mi">5</span><span class="n">m55s</span> <span class="p">(</span><span class="n">x9</span> <span class="n">over</span> <span class="mi">6</span><span class="n">m40s</span><span class="p">)</span>  <span class="n">kubelet</span><span class="p">,</span> <span class="n">worker02</span><span class="p">.</span><span class="n">acorn</span><span class="p">.</span><span class="n">com</span>  <span class="n">Liveness</span> <span class="n">probe</span> <span class="n">failed</span><span class="p">:</span> <span class="n">HTTP</span> <span class="n">probe</span> <span class="n">failed</span> <span class="k">with</span> <span class="n">statuscode</span><span class="p">:</span> <span class="mi">500</span>
  <span class="n">Normal</span>   <span class="n">Killing</span>    <span class="mi">5</span><span class="n">m55s</span> <span class="p">(</span><span class="n">x3</span> <span class="n">over</span> <span class="mi">6</span><span class="n">m34s</span><span class="p">)</span>  <span class="n">kubelet</span><span class="p">,</span> <span class="n">worker02</span><span class="p">.</span><span class="n">acorn</span><span class="p">.</span><span class="n">com</span>  <span class="n">Container</span> <span class="n">liveness</span> <span class="n">failed</span> <span class="n">liveness</span> <span class="n">probe</span><span class="p">,</span> <span class="n">will</span> <span class="n">be</span> <span class="n">restarted</span>
  <span class="n">Warning</span>  <span class="n">BackOff</span>    <span class="mi">108s</span> <span class="p">(</span><span class="n">x17</span> <span class="n">over</span> <span class="mi">5</span><span class="n">m36s</span><span class="p">)</span>  <span class="n">kubelet</span><span class="p">,</span> <span class="n">worker02</span><span class="p">.</span><span class="n">acorn</span><span class="p">.</span><span class="n">com</span>  <span class="n">Back</span><span class="o">-</span><span class="n">off</span> <span class="n">restarting</span> <span class="n">failed</span> <span class="n">container</span>
</pre></div>


<p>로그이벤트를 보면 Liveness Probe 가 실패해서 컨테이너를 재가동 하는 메시지가 보입니다.</p>
<p>뿐만아니라, 재가동 시에서 Pull image 를 통해 이미지를 다시 가져 와서 재가동 시키는 것을 볼 수 있습니다.</p>
<h2 id="11-replication-controller">11. Replication Controller</h2>
<h3 id="111-replication-controller">11.1 Replication Controller 생성</h3>
<p>아래와 같이 template를 작성합니다.</p>
<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">apiVersion</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ReplicationController</span>
<span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">goapp-rc</span>
<span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">replicas</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
  <span class="l l-Scalar l-Scalar-Plain">selector</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">app</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">goapp</span>
  <span class="l l-Scalar l-Scalar-Plain">template</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">goapp-pod</span>
      <span class="l l-Scalar l-Scalar-Plain">labels</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">tier</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">forntend</span>
        <span class="l l-Scalar l-Scalar-Plain">app</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">goapp</span>
        <span class="l l-Scalar l-Scalar-Plain">env</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">prod</span>
        <span class="l l-Scalar l-Scalar-Plain">priority</span><span class="p p-Indicator">:</span>  <span class="l l-Scalar l-Scalar-Plain">high</span>
    <span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">containers</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">goapp-container</span>
        <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">dangtong/goapp</span>
        <span class="l l-Scalar l-Scalar-Plain">ports</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">containerPort</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">8080</span>
</pre></div>


<h3 id="112-pod">11.2 Pod 생성</h3>
<div class="codehilite"><pre><span></span>kubectl create -f ./rc-goapp.yaml
</pre></div>


<h3 id="113-pod">11.3 Pod 생성 확인</h3>
<div class="codehilite"><pre><span></span>kubectl get po

NAME             READY   STATUS    RESTARTS   AGE
goapp-rc-9q689   <span class="m">1</span>/1     Running   <span class="m">0</span>          39s
goapp-rc-d5rnf   <span class="m">1</span>/1     Running   <span class="m">0</span>          39s
goapp-rc-fm7kr   <span class="m">1</span>/1     Running   <span class="m">0</span>          39s
</pre></div>


<h3 id="114-replication-controller">11.4 Replication Controller 확인</h3>
<div class="codehilite"><pre><span></span>kubectl get rc

NAME       DESIRED   CURRENT   READY   AGE
goapp-rc   <span class="m">3</span>         <span class="m">3</span>         <span class="m">3</span>       58s

kubectl get rc -o wide

NAME       DESIRED   CURRENT   READY   AGE   CONTAINERS        IMAGES           SELECTOR
goapp-rc   <span class="m">3</span>         <span class="m">3</span>         <span class="m">3</span>       72s   goapp-container   dangtong/goapp   <span class="nv">app</span><span class="o">=</span>goapp
</pre></div>


<h3 id="115-pod">11.5 특정 Pod 삭제하고 변화 확인하기</h3>
<p>아래와 같이 3개의 Pod 중에 하나를 선택해서 삭제 합니다.</p>
<div class="codehilite"><pre><span></span>kubectl deleete pod goapp-rc-9q689
</pre></div>


<div class="codehilite"><pre><span></span>kubectl get pod

NAME             READY   STATUS                         RESTARTS   AGE
goapp-rc-d5rnf   <span class="m">1</span>/1     Running                        <span class="m">0</span>          2m
goapp-rc-fm7kr   <span class="m">1</span>/1     Running                        <span class="m">0</span>          2m
goapp-rc-szv2r   <span class="m">1</span>/1     ContainerCreating      <span class="m">0</span>          6s
</pre></div>


<p>기존 컨테이너를 Terminating 하고 새로운 컨테이너를 생성하는 것을 볼 수 있습니다.</p>
<h3 id="116-pod">11.6 Pod 정보를 라벨과 함께 출력해보기</h3>
<div class="codehilite"><pre><span></span>kubectl get pod --show-labels

NAME             READY   STATUS    RESTARTS   AGE     LABELS
goapp-rc-d5rnf   <span class="m">1</span>/1     Running   <span class="m">0</span>          7m26s   <span class="nv">app</span><span class="o">=</span>goapp
goapp-rc-fm7kr   <span class="m">1</span>/1     Running   <span class="m">0</span>          7m26s   <span class="nv">app</span><span class="o">=</span>goapp
goapp-rc-szv2r   <span class="m">1</span>/1     Running   <span class="m">0</span>          4m51s   <span class="nv">app</span><span class="o">=</span>goapp
</pre></div>


<h3 id="117-pod">11.7 Pod 라벨을 변경해보기</h3>
<p>기존 "app=nginx" 라는 label 을 "app=goapp-exit" 로 변경 합니다.</p>
<div class="codehilite"><pre><span></span>kubectl label pod goapp-rc-szv2r <span class="nv">app</span><span class="o">=</span>goapp-exit --overwrite
</pre></div>


<p>아래와 같이 pod 를 조회 해봅니다.</p>
<div class="codehilite"><pre><span></span>kubectl get po

NAME             READY   STATUS              RESTARTS   AGE
goapp-rc-d5rnf   <span class="m">1</span>/1     Running             <span class="m">0</span>          8m49s
goapp-rc-fm7kr   <span class="m">1</span>/1     Running             <span class="m">0</span>          8m49s
goapp-rc-mmn2b   <span class="m">0</span>/1     ContainerCreating   <span class="m">0</span>          5s
goapp-rc-szv2r   <span class="m">1</span>/1     Running             <span class="m">0</span>          6m14s
</pre></div>


<p>기존 3개의 Pod 중 하나의 Label을 변경하면 기존 app=goapp 에는 2개의 Pod 만 남기 때문에 Replication Controller 는 <strong>추가적으로 하나의 Pod 를 생성</strong> 합니다.</p>
<div class="codehilite"><pre><span></span>NAME             READY   STATUS    RESTARTS   AGE     LABELS
goapp-rc-d5rnf   <span class="m">1</span>/1     Running   <span class="m">0</span>          9m27s   <span class="nv">app</span><span class="o">=</span>goapp
goapp-rc-fm7kr   <span class="m">1</span>/1     Running   <span class="m">0</span>          9m27s   <span class="nv">app</span><span class="o">=</span>goapp
goapp-rc-mmn2b   <span class="m">1</span>/1     Running   <span class="m">0</span>          43s     <span class="nv">app</span><span class="o">=</span>goapp
goapp-rc-szv2r   <span class="m">1</span>/1     Running   <span class="m">0</span>          6m52s   <span class="nv">app</span><span class="o">=</span>goapp-exit
</pre></div>


<h3 id="118-pod-template">11.8 Pod Template 변경 해보기</h3>
<p>아래와 같이 Pod Template의 spec ➢ spec ➢ containers ➢ image 항목을 dangtong/goapp-v2 로 변경 합니다.</p>
<div class="codehilite"><pre><span></span>kubectl edit rc nginx
</pre></div>


<div class="codehilite"><pre><span></span><span class="c1"># Please edit the object below. Lines beginning with a &#39;#&#39; will be ignored,</span>
<span class="c1"># and an empty file will abort the edit. If an error occurs while saving this file will be</span>
<span class="c1"># reopened with the relevant failures.</span>
<span class="c1">#</span>
<span class="l l-Scalar l-Scalar-Plain">apiVersion</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ReplicationController</span>
<span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">creationTimestamp</span><span class="p p-Indicator">:</span> <span class="s">&quot;2020-04-01T09:32:23Z&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">generation</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
  <span class="l l-Scalar l-Scalar-Plain">labels</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">app</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">goapp</span>
  <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">goapp-rc</span>
  <span class="l l-Scalar l-Scalar-Plain">namespace</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
  <span class="l l-Scalar l-Scalar-Plain">resourceVersion</span><span class="p p-Indicator">:</span> <span class="s">&quot;405444&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">selfLink</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/api/v1/namespaces/default/replicationcontrollers/goapp-rc</span>
  <span class="l l-Scalar l-Scalar-Plain">uid</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">17198300-d964-4de6-a160-825a7a9c16bf</span>
<span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">replicas</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
  <span class="l l-Scalar l-Scalar-Plain">selector</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">app</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">goapp</span>
  <span class="l l-Scalar l-Scalar-Plain">template</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">creationTimestamp</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">null</span>
      <span class="l l-Scalar l-Scalar-Plain">labels</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">app</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">goapp</span>
      <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">goapp-pod</span>
    <span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">containers</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">dangtong/goapp-v2</span> <span class="c1"># 이부분을 변경 합닏다.(기존 : dangtong/goapp)</span>
        <span class="l l-Scalar l-Scalar-Plain">imagePullPolicy</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Always</span>
        <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">goapp-container</span>
        <span class="l l-Scalar l-Scalar-Plain">ports</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">containerPort</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
          <span class="l l-Scalar l-Scalar-Plain">protocol</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">TCP</span>
        <span class="l l-Scalar l-Scalar-Plain">resources</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{}</span>
        <span class="l l-Scalar l-Scalar-Plain">terminationMessagePath</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/dev/termination-log</span>
        <span class="l l-Scalar l-Scalar-Plain">terminationMessagePolicy</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">File</span>
      <span class="l l-Scalar l-Scalar-Plain">dnsPolicy</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ClusterFirst</span>
      <span class="l l-Scalar l-Scalar-Plain">restartPolicy</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Always</span>
      <span class="l l-Scalar l-Scalar-Plain">schedulerName</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">default-scheduler</span>
      <span class="l l-Scalar l-Scalar-Plain">securityContext</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{}</span>
      <span class="l l-Scalar l-Scalar-Plain">terminationGracePeriodSeconds</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">30</span>
<span class="l l-Scalar l-Scalar-Plain">status</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">availableReplicas</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
  <span class="l l-Scalar l-Scalar-Plain">fullyLabeledReplicas</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
  <span class="l l-Scalar l-Scalar-Plain">observedGeneration</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
  <span class="l l-Scalar l-Scalar-Plain">readyReplicas</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
  <span class="l l-Scalar l-Scalar-Plain">replicas</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
</pre></div>


<p>저장후 편집기를 종료  합니다.</p>
<blockquote>
<p>리눅스 편집기에는 다양한 종유가 있습니다. 만약 기본 편집기를 변경하고 싶으면 </p>
<p>KUBE_EDITOR="/bin/nano" 를  $HOME/.bashrc 파일에 선언 해주면 원하는 편집기를 사용 할수 있습니다.</p>
</blockquote>
<h3 id="119-pod-template-pod">11.9 Pod Template 를 적용하기 위해 임의의 Pod 삭제하기</h3>
<div class="codehilite"><pre><span></span>kubectl get pod

goapp-rc-mvw57   <span class="m">1</span>/1     Running   <span class="m">0</span>          3h6m    <span class="m">10</span>.36.0.2   worker02.acorn.com
goapp-rc-qkrpw   <span class="m">1</span>/1     Running   <span class="m">0</span>          6m26s   <span class="m">10</span>.32.0.2   worker01.acorn.com
goapp-rc-x6q4d   <span class="m">1</span>/1     Running   <span class="m">0</span>          3h6m    <span class="m">10</span>.36.0.1   worker02.acorn.com
</pre></div>


<p>Pod 삭제</p>
<div class="codehilite"><pre><span></span>kubectl delete pod goapp-rc-mvw57

pod <span class="s2">&quot;goapp-rc-mvw57&quot;</span> deleted
</pre></div>


<p>Pod 확인</p>
<div class="codehilite"><pre><span></span>kubectl get pod

NAME             READY   STATUS              RESTARTS   AGE
goapp-rc-bf2xk   <span class="m">0</span>/1     ContainerCreating   <span class="m">0</span>          8s
goapp-rc-qkrpw   <span class="m">1</span>/1     Running             <span class="m">0</span>          7m5s
goapp-rc-x6q4d   <span class="m">1</span>/1     Running             <span class="m">0</span>          3h7m

kubectl get pod -o wide

NAME             READY   STATUS    RESTARTS   AGE     IP          NODE                 NOMINATED NODE   READINESS GATES
goapp-rc-bf2xk   <span class="m">1</span>/1     Running   <span class="m">0</span>          21s     <span class="m">10</span>.32.0.3   worker01.acorn.com
goapp-rc-qkrpw   <span class="m">1</span>/1     Running   <span class="m">0</span>          7m18s   <span class="m">10</span>.32.0.2   worker01.acorn.com
goapp-rc-x6q4d   <span class="m">1</span>/1     Running   <span class="m">0</span>          3h7m    <span class="m">10</span>.36.0.1   worker02.acorn.com 
</pre></div>


<p>접속 해보기</p>
<div class="codehilite"><pre><span></span><span class="c1"># dangtong/goapp</span>
curl http://10.32.0.2:8080
hostname: goapp-rc-qkrpw

<span class="c1"># dangtong/goapp-v3</span>
curl http://10.32.0.3:8080
hostname: goapp-rc-bf2xk
version: goapp-v2
</pre></div>


<h3 id="1110-pod">11.10 Pod 스케일링</h3>
<ul>
<li>Template 변경을 통한 스케일링</li>
</ul>
<p>아래와 같이 goapp-rc 를 edit 명령으로 수정 합니다. (replicas 항목을 3에서 4로 수정)</p>
<div class="codehilite"><pre><span></span>정kubectl edit rc goapp-rc
</pre></div>


<div class="codehilite"><pre><span></span><span class="c1"># Please edit the object below. Lines beginning with a &#39;#&#39; will be ignored,</span>
<span class="c1"># and an empty file will abort the edit. If an error occurs while saving this file will be</span>
<span class="c1"># reopened with the relevant failures.</span>
<span class="c1">#</span>
<span class="l l-Scalar l-Scalar-Plain">apiVersion</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ReplicationController</span>
<span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">creationTimestamp</span><span class="p p-Indicator">:</span> <span class="s">&quot;2020-04-01T09:51:49Z&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">generation</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
  <span class="l l-Scalar l-Scalar-Plain">labels</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">app</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">goapp</span>
  <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">goapp-rc</span>
  <span class="l l-Scalar l-Scalar-Plain">namespace</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
  <span class="l l-Scalar l-Scalar-Plain">resourceVersion</span><span class="p p-Indicator">:</span> <span class="s">&quot;416408&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">selfLink</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/api/v1/namespaces/default/replicationcontrollers/goapp-rc</span>
  <span class="l l-Scalar l-Scalar-Plain">uid</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">23f58f51-88ab-4828-9a76-cde8a646fff4</span>
<span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">replicas</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">4</span>  <span class="c1"># 이부분을 변경 합니다. (기존 : 3)</span>
  <span class="l l-Scalar l-Scalar-Plain">selector</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">app</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">goapp</span>
  <span class="l l-Scalar l-Scalar-Plain">template</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">creationTimestamp</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">null</span>
      <span class="l l-Scalar l-Scalar-Plain">labels</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">app</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">goapp</span>
      <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">goapp-pod</span>
    <span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">containers</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">dangtong/goapp-v2</span>
        <span class="l l-Scalar l-Scalar-Plain">imagePullPolicy</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Always</span>
        <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">goapp-container</span>
        <span class="l l-Scalar l-Scalar-Plain">ports</span><span class="p p-Indicator">:</span>
</pre></div>


<p>저장 한다음 Pod 및 RC 확인</p>
<div class="codehilite"><pre><span></span>kubectl get pod

NAME             READY   STATUS              RESTARTS   AGE
goapp-rc-bf2xk   <span class="m">1</span>/1     Running             <span class="m">0</span>          19m
goapp-rc-mr6kb   <span class="m">0</span>/1     ContainerCreating   <span class="m">0</span>          7s
goapp-rc-qkrpw   <span class="m">1</span>/1     Running             <span class="m">0</span>          26m
goapp-rc-x6q4d   <span class="m">1</span>/1     Running             <span class="m">0</span>          3h26m
</pre></div>


<div class="codehilite"><pre><span></span>kubectl get rc

NAME       DESIRED   CURRENT   READY   AGE
goapp-rc   <span class="m">4</span>         <span class="m">4</span>         <span class="m">4</span>       4h17m
</pre></div>


<ul>
<li>명령어를 통한 스케일링</li>
</ul>
<p>명령어를 이용해서 스케일링을 수행 할 수  있습니다.</p>
<div class="codehilite"><pre><span></span>kubectl scale rc goapp-rc --replicas<span class="o">=</span><span class="m">5</span>
</pre></div>


<p>실제로  Pod 가 늘어 났는지 확인해봅니다.</p>
<div class="codehilite"><pre><span></span>kubectl get pod

NAME             READY   STATUS              RESTARTS   AGE
goapp-rc-bf2xk   <span class="m">1</span>/1     Running             <span class="m">0</span>          72m
goapp-rc-dlgfc   <span class="m">0</span>/1     ContainerCreating   <span class="m">0</span>          4s
goapp-rc-mr6kb   <span class="m">1</span>/1     Running             <span class="m">0</span>          53m
goapp-rc-qkrpw   <span class="m">1</span>/1     Running             <span class="m">0</span>          79m
goapp-rc-x6q4d   <span class="m">1</span>/1     Running             <span class="m">0</span>          4h19m
</pre></div>


<h3 id="1111-replication-controller">11.11 Replication Controller 삭제</h3>
<p>Replication Controller 와 POD 모두 삭제</p>
<div class="codehilite"><pre><span></span>kubectl delete rc goapp-rc
</pre></div>


<p>Replication Controller 만 삭제. POD 는 그대로 유지 합니다.</p>
<div class="codehilite"><pre><span></span>kubectl delete rc goapp-rc --cascade<span class="o">=</span><span class="nb">false</span>
</pre></div>


<h2 id="12replicaset">12.ReplicaSet</h2>
<h3 id="121-rs">12.1 RS 생성</h3>
<p>Selector 를 작성 할때 <strong>ForntEnd</strong> 이고 <strong>운영계</strong> 이면서 중요도가 <strong>High</strong> 인 POD 에 대해 RS 를 생성 합니다.</p>
<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">apiVersion</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ReplicaSet</span>
<span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">frontend</span>
  <span class="l l-Scalar l-Scalar-Plain">labels</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">app</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">guestbook</span>
    <span class="l l-Scalar l-Scalar-Plain">tier</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">frontend</span>
<span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">replicas</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
  <span class="l l-Scalar l-Scalar-Plain">selector</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">matchLabels</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">tier</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">frontend</span>
    <span class="l l-Scalar l-Scalar-Plain">matchExpressions</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span><span class="nv">key</span><span class="p p-Indicator">:</span> <span class="nv">env</span><span class="p p-Indicator">,</span> <span class="nv">operator</span><span class="p p-Indicator">:</span> <span class="nv">In</span><span class="p p-Indicator">,</span> <span class="nv">values</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="nv">prod</span><span class="p p-Indicator">]}</span>
      <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span><span class="nv">key</span><span class="p p-Indicator">:</span> <span class="nv">priority</span><span class="p p-Indicator">,</span> <span class="nv">operator</span><span class="p p-Indicator">:</span> <span class="nv">NotIn</span><span class="p p-Indicator">,</span> <span class="nv">values</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="nv">low</span><span class="p p-Indicator">]}</span>
  <span class="l l-Scalar l-Scalar-Plain">template</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">labels</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">tier</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">frontend</span>
        <span class="l l-Scalar l-Scalar-Plain">env</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">prod</span>
        <span class="l l-Scalar l-Scalar-Plain">priority</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">high</span>
    <span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">containers</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">php-redis</span>
        <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">gcr.io/google_samples/gb-frontend:v3</span>
</pre></div>


<h3 id="122-rs">12.2 RS 확인</h3>
<div class="codehilite"><pre><span></span>$ kubectl get pod -o wide

NAME             READY   STATUS    RESTARTS   AGE   IP          NODE                         
frontend-bstms   <span class="m">1</span>/1     Running   <span class="m">0</span>          53s   <span class="m">10</span>.32.2.7   gke-gke1-default-pool-ad44d907-cq8j   
frontend-d4znb   <span class="m">1</span>/1     Running   <span class="m">0</span>          53s   <span class="m">10</span>.32.2.9   gke-gke1-default-pool-ad44d907-cq8j   
frontend-rv9bl   <span class="m">1</span>/1     Running   <span class="m">0</span>          53s   <span class="m">10</span>.32.2.8   gke-gke1-default-pool-ad44d907-cq8j
</pre></div>


<div class="codehilite"><pre><span></span>$ kubectl get rs -o wide

AME             READY   STATUS    RESTARTS   AGE   IP          NODE                           
frontend-bstms   <span class="m">1</span>/1     Running   <span class="m">0</span>          68s   <span class="m">10</span>.32.2.7   gke-gke1-default-pool-ad44d907-cq8j
frontend-d4znb   <span class="m">1</span>/1     Running   <span class="m">0</span>          68s   <span class="m">10</span>.32.2.9   gke-gke1-default-pool-ad44d907-cq8j
frontend-rv9bl   <span class="m">1</span>/1     Running   <span class="m">0</span>          68s   <span class="m">10</span>.32.2.8   gke-gke1-default-pool-ad44d907-cq8j
</pre></div>


<div class="codehilite"><pre><span></span>$ kubectl get pod --show-labels

NAME             READY   STATUS    RESTARTS   AGE    LABELS
frontend-bstms   <span class="m">1</span>/1     Running   <span class="m">0</span>          107s   <span class="nv">env</span><span class="o">=</span>prod,priority<span class="o">=</span>high,tier<span class="o">=</span>frontend
frontend-d4znb   <span class="m">1</span>/1     Running   <span class="m">0</span>          107s   <span class="nv">env</span><span class="o">=</span>prod,priority<span class="o">=</span>high,tier<span class="o">=</span>frontend
frontend-rv9bl   <span class="m">1</span>/1     Running   <span class="m">0</span>          107s   <span class="nv">env</span><span class="o">=</span>prod,priority<span class="o">=</span>high,tier<span class="o">=</span>frontend
</pre></div>


<h3 id="exercise-5">[[ Exercise #5 ]]</h3>
<ol>
<li>Nginx Pod 3개로 구성된 Replication Controller를 작성 하세요</li>
<li>Replication Controller 만 삭제 하세요(Pod 는 유지)</li>
<li>남겨진 Nginx Pod를 관리하는 ReplicaSet 을 작성하된 replica 4개로 구성 하시요</li>
<li>Nginx Pod 를 6개로 Scale Out 하세요</li>
</ol>
<h2 id="13deamonset">13.DeamonSet</h2>
<h3 id="131">13.1 데몬셋 생성</h3>
<p>goapp-ds.yaml 이라는 이름으로 아래 파일을 작성 합니다.</p>
<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">piVersion</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">DaemonSet</span>
<span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">goapp-on-ssd</span>
<span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">selector</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">matchLabels</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">app</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">goapp-pod</span>
  <span class="l l-Scalar l-Scalar-Plain">template</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">labels</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">app</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">goapp-pod</span>
    <span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">nodeSelector</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">disk</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ssd</span>
      <span class="l l-Scalar l-Scalar-Plain">containers</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">goapp-container</span>
        <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">dangtong/goapp</span>
</pre></div>


<p>데몬셋을 생성 합니다.</p>
<div class="codehilite"><pre><span></span>$ kubectl create -f ./goapp-ds.yaml
</pre></div>


<p>Pod 와 데몬셋을 조회 합니다.</p>
<div class="codehilite"><pre><span></span>$ kubectl get pod

$ kubectl get ds

NAME           DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR   AGE
goapp-on-ssd   <span class="m">0</span>         <span class="m">0</span>         <span class="m">0</span>       <span class="m">0</span>            <span class="m">0</span>           <span class="nv">disk</span><span class="o">=</span>ssd        &lt;nome&gt;
</pre></div>


<p>조회 하면 Pod 도 존재하지 않고 데몬셋 정보를 조회 해도 모두 0 으로 나옵닏다. 노드에 disk=ssd 라벨이 없기 때문입니다.</p>
<p>이제 라벨을 추가 합니다.</p>
<div class="codehilite"><pre><span></span>$ kubectl label node worker01.acorn.com <span class="nv">disk</span><span class="o">=</span>ssd

$ kubectl get pod
NAME                 READY   STATUS    RESTARTS   AGE
goapp-on-ssd-vwvks   <span class="m">1</span>/1     Running   <span class="m">0</span>          7s

$ kubectl label node worker02.acorn.com <span class="nv">disk</span><span class="o">=</span>ssd

$ kubectl get pod
NAME                 READY   STATUS    RESTARTS   AGE
goapp-on-ssd-nbnwz   <span class="m">1</span>/1     Running   <span class="m">0</span>          7s
goapp-on-ssd-vwvks   <span class="m">1</span>/1     Running   <span class="m">0</span>          36s

$ kubectl get ds -o wide
AME           DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR   AGE
goapp-on-ssd   <span class="m">2</span>         <span class="m">2</span>         <span class="m">2</span>       <span class="m">2</span>            <span class="m">2</span>           <span class="nv">disk</span><span class="o">=</span>ssd        10m
</pre></div>


<h2 id="14deployment">14.Deployment</h2>
<h3 id="141-deployment">14.1 Deployment 생성</h3>
<p>아래와 같이 nginx 를 서비스 하고 replica 가 3개인 Deployment 를 작성합니다.(nginx-deploy.yaml)</p>
<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">apiVersion</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx-deployment</span>
  <span class="l l-Scalar l-Scalar-Plain">labels</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">app</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">replicas</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
  <span class="l l-Scalar l-Scalar-Plain">selector</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">matchLabels</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">app</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
  <span class="l l-Scalar l-Scalar-Plain">template</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">labels</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">app</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
    <span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">containers</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
        <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx:1.7.9</span>
        <span class="l l-Scalar l-Scalar-Plain">ports</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">containerPort</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
</pre></div>


<div class="codehilite"><pre><span></span>kubectl apply -f ./nginx-deploy.yaml
</pre></div>


<h3 id="142-deployment">14.2 Deployment 확인</h3>
<div class="codehilite"><pre><span></span>kubectl get pod,rs,deploy
NAME                                    READY   STATUS    RESTARTS   AGE
pod/nginx-deployment-54f57cf6bf-dpsn4   <span class="m">1</span>/1     Running   <span class="m">0</span>          30s
pod/nginx-deployment-54f57cf6bf-ghfwm   <span class="m">1</span>/1     Running   <span class="m">0</span>          30s
pod/nginx-deployment-54f57cf6bf-rswwk   <span class="m">1</span>/1     Running   <span class="m">0</span>          30s

NAME                                          DESIRED   CURRENT   READY   AGE
replicaset.apps/nginx-deployment-54f57cf6bf   <span class="m">3</span>         <span class="m">3</span>         <span class="m">3</span>       30s

NAME                               READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/nginx-deployment   <span class="m">3</span>/3     <span class="m">3</span>            <span class="m">3</span>           30s
</pre></div>


<h3 id="143">14.3 이미지 업데이트</h3>
<ul>
<li>기본 방식</li>
</ul>
<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">kubectl --record deployment.apps/nginx-deployment set image deployment.v1.apps/nginx-deployment nginx=nginx:1.9.1</span>
</pre></div>


<ul>
<li>단축 방식</li>
</ul>
<div class="codehilite"><pre><span></span>kubectl <span class="nb">set</span> image deployment/nginx-deployment <span class="nv">nginx</span><span class="o">=</span>nginx:1.9.1 --record
</pre></div>


<ul>
<li>yaml 파일 수정(.spec.template.spec.containers[0].image 변경)</li>
</ul>
<div class="codehilite"><pre><span></span>kubectl edit deployment.v1.apps/nginx-deployment
</pre></div>


<ul>
<li>롤백</li>
</ul>
<div class="codehilite"><pre><span></span>kubectl <span class="nb">set</span> image deployment.v1.apps/nginx-deployment <span class="nv">nginx</span><span class="o">=</span>nginx:1.7.9 --record<span class="o">=</span><span class="nb">true</span>
</pre></div>


<h3 id="144-deployment-scaleout">14.4 Deployment ScaleOut</h3>
<div class="codehilite"><pre><span></span>kubectl edit deploy goapp-deployment

kubectl scale deploy nginx-deployment
goapp-deployment-5857594fbb-2hhnv   <span class="m">1</span>/1     Running   <span class="m">0</span>          32m
goapp-deployment-5857594fbb-6s9lx   <span class="m">1</span>/1     Running   <span class="m">0</span>          6s
goapp-deployment-5857594fbb-7nqsg   <span class="m">1</span>/1     Running   <span class="m">0</span>          32m
goapp-deployment-5857594fbb-9b28s   <span class="m">1</span>/1     Running   <span class="m">0</span>          32m
</pre></div>


<h3 id="144-deployment">14.4 deployment 확인 하기</h3>
<ul>
<li>롤아웃 확인</li>
</ul>
<div class="codehilite"><pre><span></span>kubectl rollout status deployment.v1.apps/nginx-deployment
</pre></div>


<ul>
<li>deployment 상세 확인</li>
</ul>
<div class="codehilite"><pre><span></span>kubectl describe deploy nginx-deployment
</pre></div>


<h3 id="exercise-6">[[ Exercise #6 ]]</h3>
<ol>
<li></li>
</ol>
<h2 id="5-service">5. 서비스 (Service)</h2>
<h3 id="51-clusterip">5.1 ClusterIP</h3>
<h4 id="510-nodes-app">5.1.0 nodes app 생성</h4>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">os</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;os&#39;</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Kubia server starting...&quot;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">handler</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Received request from &quot;</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">connection</span><span class="p">.</span><span class="nx">remoteAddress</span><span class="p">);</span>
  <span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
  <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s2">&quot;You&#39;ve hit &quot;</span> <span class="o">+</span> <span class="nx">os</span><span class="p">.</span><span class="nx">hostname</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span><span class="p">);</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">www</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="nx">handler</span><span class="p">);</span>
<span class="nx">www</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8080</span><span class="p">);</span>
</pre></div>


<h4 id="511-pod">5.1.1. pod 생성</h4>
<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">apiVersion</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">nodeapp-deployment</span>
  <span class="l l-Scalar l-Scalar-Plain">labels</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">app</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">nodeapp</span>
<span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">replicas</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
  <span class="l l-Scalar l-Scalar-Plain">selector</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">matchLabels</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">app</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">nodeapp</span>
  <span class="l l-Scalar l-Scalar-Plain">template</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">labels</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">app</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">nodeapp-pod</span>
    <span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">containers</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">goapp-container</span>
        <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">dangtong/nodeapp</span>
        <span class="l l-Scalar l-Scalar-Plain">ports</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">containerPort</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">8080</span>
</pre></div>


<h4 id="512-yaml-clusterip">5.1.2 yaml을 통한 ClusterIP 생성</h4>
<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">apiVersion</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">nodeapp-service</span>
<span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">ports</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">port</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
    <span class="l l-Scalar l-Scalar-Plain">targetPort</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">8080</span>
  <span class="l l-Scalar l-Scalar-Plain">selector</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">app</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">nodeapp</span>
</pre></div>


<h4 id="513">5.1.3 서비스 상태 확인</h4>
<div class="codehilite"><pre><span></span>kubectl get  po,deploy,svc

NAME                                      READY   STATUS    RESTARTS   AGE
pod/nodeapp-deployment-55688d9d4b-8pzsk   <span class="m">1</span>/1     Running   <span class="m">0</span>          2m45s
pod/nodeapp-deployment-55688d9d4b-pslvb   <span class="m">1</span>/1     Running   <span class="m">0</span>          2m46s
pod/nodeapp-deployment-55688d9d4b-whbk8   <span class="m">1</span>/1     Running   <span class="m">0</span>          2m46s

NAME                                 READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/nodeapp-deployment   <span class="m">3</span>/3     <span class="m">3</span>            <span class="m">3</span>           2m46s

NAME                      TYPE           CLUSTER-IP       EXTERNAL-IP      PORT<span class="o">(</span>S<span class="o">)</span>        AGE
nodeapp-service   ClusterIP      <span class="m">10</span>.101.249.42    &lt;none&gt;           <span class="m">80</span>/TCP         78s
</pre></div>


<h4 id="514">5.1.4 서비스 확인</h4>
<div class="codehilite"><pre><span></span>curl http://10.101.249.42  <span class="c1">#여러번 수행 하기</span>

You<span class="err">&#39;</span>ve hit nodeapp-deployment-55688d9d4b-8pzsk
</pre></div>


<h4 id="515-pod-curl">5.1.5 원격 Pod에서 curl 명령 수행하기</h4>
<div class="codehilite"><pre><span></span>kubectl <span class="nb">exec</span> nodeapp-deployment-55688d9d4b-8pzsk -- curl -s http://10.101.249.42

You<span class="err">&#39;</span>ve hit nodeapp-deployment-55688d9d4b-whbk8
</pre></div>


<blockquote>
<p>.더블 대시는 kubectl 명령의의 종료를 가르킴</p>
</blockquote>
<h4 id="516">5.1.6 서비스 삭제</h4>
<div class="codehilite"><pre><span></span>kubectl delete svc nodeapp-service
</pre></div>


<h3 id="52-nodeport">5.2 NodePort</h3>
<h4 id="521-yaml-nodeport-gcp">5.2.1 yaml 을 이용한 NodePort 생성 (GCP 에서 수행 하기)</h4>
<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">apiVersion</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">node-nodeport</span>
<span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">NodePort</span>
  <span class="l l-Scalar l-Scalar-Plain">ports</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">port</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
    <span class="l l-Scalar l-Scalar-Plain">targetPort</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">8080</span>
    <span class="l l-Scalar l-Scalar-Plain">nodePort</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">30123</span>
  <span class="l l-Scalar l-Scalar-Plain">selector</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">app</span><span class="p p-Indicator">:</span>  <span class="l l-Scalar l-Scalar-Plain">node</span>
</pre></div>


<h4 id="522-nodeport">5.2.2 NodePort 조회</h4>
<div class="codehilite"><pre><span></span>kubectl get po,rs,svc

NAME                                      READY   STATUS    RESTARTS   AGE
pod/nodeapp-deployment-55688d9d4b-8pzsk   <span class="m">1</span>/1     Running   <span class="m">0</span>          145m
pod/nodeapp-deployment-55688d9d4b-pslvb   <span class="m">1</span>/1     Running   <span class="m">0</span>          145m
pod/nodeapp-deployment-55688d9d4b-whbk8   <span class="m">1</span>/1     Running   <span class="m">0</span>          145m

NAME                                            DESIRED   CURRENT   READY   AGE
replicaset.apps/nodeapp-deployment-55688d9d4b   <span class="m">3</span>         <span class="m">3</span>         <span class="m">3</span>       145m

NAME                       TYPE        CLUSTER-IP     EXTERNAL-IP   PORT<span class="o">(</span>S<span class="o">)</span>        AGE
service/kubernetes         ClusterIP   <span class="m">10</span>.96.0.1      &lt;none&gt;        <span class="m">443</span>/TCP        10d
service/nodeapp-nodeport   NodePort    <span class="m">10</span>.108.30.68   &lt;none&gt;        <span class="m">80</span>:30123/TCP   4m14s
</pre></div>


<h4 id="523-nodeport">5.2.3 NodePort 를 통한 서비스 접속 확인(여러번 수행)</h4>
<div class="codehilite"><pre><span></span>$ curl http://localhost:30123
You<span class="s1">&#39;ve hit nodeapp-deployment-55688d9d4b-pslvb</span>

<span class="s1">$ curl http://localhost:30123</span>
<span class="s1">You&#39;</span>ve hit nodeapp-deployment-55688d9d4b-whbk8

$ curl http://localhost:30123
You<span class="err">&#39;</span>ve hit nodeapp-deployment-55688d9d4b-pslvb
</pre></div>


<h4 id="524-nodeport">5.2.4 NodePort 삭제</h4>
<div class="codehilite"><pre><span></span>kubectl delete svc nodeapp-nodeport
</pre></div>


<h3 id="53-loadbalancer-gcp">5.3 LoadBalancer (GCP 에서 수행)</h3>
<h4 id="531-yaml-deployment">5.3.1 yaml 파일로 deployment 생성</h4>
<div class="codehilite"><pre><span></span>apiVersion: apps/v1
kind: Deployment
metadata:
  name: nodeapp-deployment
  labels:
    app: nodeapp
spec:
  replicas: <span class="m">3</span>
  selector:
    matchLabels:
      app: nodeapp
  template:
    metadata:
      labels:
        app: nodeapp
    spec:
      containers:
      - name: goapp-container
        image: dangtong/nodeapp
        ports:
        - containerPort: <span class="m">8080</span>
</pre></div>


<h4 id="532">5.3.2 서비스 확인</h4>
<div class="codehilite"><pre><span></span>$ kubectl get po,rs,deploy

NAME                                      READY   STATUS    RESTARTS   AGE
pod/nodeapp-deployment-7d58f5d487-7hphx   <span class="m">1</span>/1     Running   <span class="m">0</span>          20m
pod/nodeapp-deployment-7d58f5d487-d74rp   <span class="m">1</span>/1     Running   <span class="m">0</span>          20m
pod/nodeapp-deployment-7d58f5d487-r8hq8   <span class="m">1</span>/1     Running   <span class="m">0</span>          20m
NAME                                                  DESIRED   CURRENT   READY   AGE
replicaset.extensions/nodeapp-deployment-7d58f5d487   <span class="m">3</span>         <span class="m">3</span>         <span class="m">3</span>       20m
NAME                                       READY   UP-TO-DATE   AVAILABLE   AGE
deployment.extensions/nodeapp-deployment   <span class="m">3</span>/3     <span class="m">3</span>            <span class="m">3</span>           20m
</pre></div>


<div class="codehilite"><pre><span></span>kubectl get po -o wide

NAME                                  READY   STATUS    RESTARTS   AGE   IP           NODE                                  NOMINATED NODE   READINESS GATES
nodeapp-deployment-7d58f5d487-7hphx   <span class="m">1</span>/1     Running   <span class="m">0</span>          21m   <span class="m">10</span>.32.2.10   gke-gke1-default-pool-ad44d907-cq8j
nodeapp-deployment-7d58f5d487-d74rp   <span class="m">1</span>/1     Running   <span class="m">0</span>          21m   <span class="m">10</span>.32.2.12   gke-gke1-default-pool-ad44d907-cq8j
nodeapp-deployment-7d58f5d487-r8hq8   <span class="m">1</span>/1     Running   <span class="m">0</span>          21m   <span class="m">10</span>.32.2.11   gke-gke1-default-pool-ad44d907-cq8j
</pre></div>


<h4 id="532-nodeapp">5.3.2 nodeapp 접속 해보기</h4>
<div class="codehilite"><pre><span></span>$ kubectl <span class="nb">exec</span> nodeapp-deployment-7d58f5d487-7hphx -- curl -s http://10.32.2.10:8080
또는
$ kubectl <span class="nb">exec</span> -it nodeapp-deployment-7d58f5d487-7hphx bash

$ curl http://10.32.2.10:8080
You<span class="err">&#39;</span>ve hit nodeapp-deployment-7d58f5d487-7hphx
</pre></div>


<h4 id="533-yaml-loadbalancer">5.3.3 yaml 파일을 이용해 LoadBalancer 생성</h4>
<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">apiVersion</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span>  <span class="l l-Scalar l-Scalar-Plain">nodeapp-lb</span>
<span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">LoadBalancer</span>
    <span class="l l-Scalar l-Scalar-Plain">ports</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">port</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
      <span class="l l-Scalar l-Scalar-Plain">targetPort</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">8080</span>
    <span class="l l-Scalar l-Scalar-Plain">selector</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">app</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">nodeapp</span>
</pre></div>


<h4 id="535-loadbalancer">5.3.5 LoadBalancer 생성 확인</h4>
<div class="codehilite"><pre><span></span>kubectl get svc 

NAME         TYPE           CLUSTER-IP     EXTERNAL-IP   PORT<span class="o">(</span>S<span class="o">)</span>        AGE
kubernetes   ClusterIP      <span class="m">10</span>.36.0.1      &lt;none&gt;        <span class="m">443</span>/TCP        7d21h
nodeapp-lb   LoadBalancer   <span class="m">10</span>.36.14.234   &lt;pending&gt;     <span class="m">80</span>:31237/TCP   33s
</pre></div>


<p>현재 pending 상태임 20초 정도 지나면</p>
<div class="codehilite"><pre><span></span>kubectl get svc 

NAME         TYPE           CLUSTER-IP     EXTERNAL-IP      PORT<span class="o">(</span>S<span class="o">)</span>        AGE
kubernetes   ClusterIP      <span class="m">10</span>.36.0.1      &lt;none&gt;           <span class="m">443</span>/TCP        7d21h
nodeapp-lb   LoadBalancer   <span class="m">10</span>.36.14.234   <span class="m">35</span>.221.179.171   <span class="m">80</span>:31237/TCP   45s
</pre></div>


<h4 id="536">5.3.6 서비스 확인</h4>
<div class="codehilite"><pre><span></span>curl http://35.221.179.171

You<span class="err">&#39;</span>ve hit nodeapp-deployment-7d58f5d487-r8hq8
</pre></div>


<h3 id="54-ingress-gcp">5.4 Ingress (GCP 에서 수행)</h3>
<h4 id="541-deployment">5.4.1 Deployment 생성</h4>
<ul>
<li>nginx / goapp deployment 생성</li>
</ul>
<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">apiVersion</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx-deployment</span>
  <span class="l l-Scalar l-Scalar-Plain">labels</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">app</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">replicas</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
  <span class="l l-Scalar l-Scalar-Plain">selector</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">matchLabels</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">app</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
  <span class="l l-Scalar l-Scalar-Plain">template</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">labels</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">app</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
    <span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">containers</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx-container</span>
        <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx:1.7.9</span>
        <span class="l l-Scalar l-Scalar-Plain">ports</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">containerPort</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="nn">---</span>

<span class="l l-Scalar l-Scalar-Plain">apiVersion</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">goapp-deployment</span>
  <span class="l l-Scalar l-Scalar-Plain">labels</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">app</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">goapp</span>
<span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">replicas</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
  <span class="l l-Scalar l-Scalar-Plain">selector</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">matchLabels</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">app</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">goapp</span>
  <span class="l l-Scalar l-Scalar-Plain">template</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">labels</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">app</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">goapp</span>
    <span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">containers</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">goapp-container</span>
        <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">dangtong/goapp</span>
        <span class="l l-Scalar l-Scalar-Plain">ports</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">containerPort</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">8080</span>
</pre></div>


<h4 id="542-service">5.4.2 Service 생성</h4>
<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">apiVersion</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx-service</span>
<span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">ports</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">port</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
    <span class="l l-Scalar l-Scalar-Plain">targetPort</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
  <span class="l l-Scalar l-Scalar-Plain">selector</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">app</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="nn">---</span>
<span class="l l-Scalar l-Scalar-Plain">apiVersion</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">goapp-service</span>
<span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">ports</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">port</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
    <span class="l l-Scalar l-Scalar-Plain">targetPort</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">8080</span>
  <span class="l l-Scalar l-Scalar-Plain">selector</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">app</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">goapp</span>
</pre></div>


<h4 id="543-ingress">5.4.3 Ingress 생성</h4>
<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">apiVersion</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">extensions/v1beta1</span>
<span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx-goapp-Ingress</span>
<span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">tls</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">hosts</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">nginx.acorn.com</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">goapp.acorn.com</span>
    <span class="l l-Scalar l-Scalar-Plain">secretName</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">acorn-secret</span>
  <span class="l l-Scalar l-Scalar-Plain">rules</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">host</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx.acorn.com</span>
    <span class="l l-Scalar l-Scalar-Plain">http</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">paths</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">path</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/</span>
        <span class="l l-Scalar l-Scalar-Plain">backend</span><span class="p p-Indicator">:</span>
          <span class="l l-Scalar l-Scalar-Plain">serviceName</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx-service</span>
          <span class="l l-Scalar l-Scalar-Plain">servicePort</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">host</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">goapp.acorn.com</span>
    <span class="l l-Scalar l-Scalar-Plain">http</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">paths</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">path</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/</span>
        <span class="l l-Scalar l-Scalar-Plain">backend</span><span class="p p-Indicator">:</span>
          <span class="l l-Scalar l-Scalar-Plain">serviceName</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">goapp-service</span>
          <span class="l l-Scalar l-Scalar-Plain">servicePort</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
</pre></div>


<h4 id="544-ingress">5.4.4 Ingress 조회</h4>
<div class="codehilite"><pre><span></span>kubectl get Ingress

NAME                  HOSTS                             ADDRESS   PORTS     AGE
nginx-goapp-ingress   nginx.acorn.com,goapp.acorn.com             <span class="m">80</span>, <span class="m">443</span>   15s
</pre></div>


<blockquote>
<p>Ingress 가 완전히 생성되기 까지 시간이 걸립니다. 2~5분 소요</p>
</blockquote>
<p>다시 조회 합니다</p>
<div class="codehilite"><pre><span></span>kubectl get Ingress

NAME                  HOSTS                             ADDRESS          PORTS     AGE
nginx-goapp-ingress   nginx.acorn.com,goapp.acorn.com   <span class="m">35</span>.227.227.127   <span class="m">80</span>, <span class="m">443</span>   13m
</pre></div>


<h4 id="545-etchosts">5.4.5 /etc/hosts 파일 수정</h4>
<div class="codehilite"><pre><span></span>sudo vi /etc/hosts

<span class="m">35</span>.227.227.127 nginx.acorn.com goapp.acorn.com
</pre></div>


<h4 id="546">5.4.6 서비스 확인</h4>
<div class="codehilite"><pre><span></span>$ curl http://goapp.acorn.com
hostname: goapp-deployment-d7564689f-6rrzw

$ curl http://nginx.acorn.com
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Welcome to nginx!&lt;/title&gt;
&lt;style&gt;
    body <span class="o">{</span>
        width: 35em<span class="p">;</span>
        margin: <span class="m">0</span> auto<span class="p">;</span>
        font-family: Tahoma, Verdana, Arial, sans-serif<span class="p">;</span>
    <span class="o">}</span>
&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
</pre></div>


<h4 id="547-https-tls-offload">5.4.7 HTTPS 서비스 (TLS OffLoad)</h4>
<ul>
<li>인증서 생성 및 인증서 secret 등록</li>
</ul>
<div class="codehilite"><pre><span></span>openssl genrsa -out server.key <span class="m">2048</span>

openssl req -new -x509 -key server.key -out server.cert -days <span class="m">360</span> -subj /CN<span class="o">=</span>nginx.acorn.com

kubectl create  secret tls acorn-secret --cert<span class="o">=</span>server.cert --key<span class="o">=</span>server.key
</pre></div>


<ul>
<li>테스트</li>
</ul>
<div class="codehilite"><pre><span></span>$ curl -k https://nginx.acorn.com

$ curl -k https://goapp.acorn.com
</pre></div>


<h2 id="6-readiness-probe">6. Readiness Probe</h2>
<h2 id="7volums">7.Volums</h2>
<h3 id="71-emptydir">7.1 EmptyDir</h3>
<h4 id="711-docker">7.1.1 Docker 이미지 만들기</h4>
<p>아래와 같이 폴더를 만들고 ./fortune/docimg 폴더로 이동합닏다.</p>
<div class="codehilite"><pre><span></span>$ mkdir -p ./fortune/docimg
$ mkdir -p ./fortune/kubetmp
</pre></div>


<p>아래와 같이 docker 이미지를 작성하기 위해 bash 로 Application을 작성 합니다.</p>
<div class="codehilite"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="nb">trap</span> <span class="s2">&quot;exit&quot;</span> SIGINT
mkdir /var/htdocs
<span class="k">while</span> :
<span class="k">do</span>
    <span class="nb">echo</span> <span class="k">$(</span>date<span class="k">)</span> Writing fortune to /var/htdocs/index.html
    /usr/games/fortune  &gt; /var/htdocs/index.html
    sleep <span class="m">10</span>
<span class="k">done</span>
</pre></div>


<p>Dockerfile 을 작성 합니다.</p>
<div class="codehilite"><pre><span></span><span class="k">FROM</span><span class="s"> ubuntu:latest</span>
<span class="k">RUN</span> apt-get update<span class="p">;</span> apt-get -y install fortune
<span class="k">ADD</span><span class="s"> fortuneloop.sh /bin/fortuneloop.sh</span>
<span class="k">ENTRYPOINT</span><span class="s"> /bin/fortuneloop.sh</span>
</pre></div>


<p>Dcoker 이미지를 만듭니다.</p>
<div class="codehilite"><pre><span></span>$ docker build -t dangtong/fortune .
</pre></div>


<p>Docker 이미지를 Docker Hub 에 push 합니다.</p>
<div class="codehilite"><pre><span></span>$ docker login
$ docker push dangtong/fortune
</pre></div>


<h4 id="712-deployment">7.1.2 Deployment 작성</h4>
<p>fortune APP을 적용하기 위해 Deployment 를 작성 합니다.</p>
<div class="codehilite"><pre><span></span><span class="nb">cd</span> ../ktmp/
vi fortune-deploy.yaml
</pre></div>


<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">apiVersion</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">fortune-deployment</span>
  <span class="l l-Scalar l-Scalar-Plain">labels</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">app</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">fortune</span>
<span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">replicas</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
  <span class="l l-Scalar l-Scalar-Plain">selector</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">matchLabels</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">app</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">fortune</span>
  <span class="l l-Scalar l-Scalar-Plain">template</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">labels</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">app</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">fortune</span>
    <span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">containers</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">dangtong/fortune</span>
        <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">html-generator</span>
        <span class="l l-Scalar l-Scalar-Plain">volumeMounts</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">html</span>
          <span class="l l-Scalar l-Scalar-Plain">mountPath</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/var/htdocs</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
        <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">web-server</span>
        <span class="l l-Scalar l-Scalar-Plain">volumeMounts</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">html</span>
          <span class="l l-Scalar l-Scalar-Plain">mountPath</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/usr/share/nginx/html</span>
          <span class="l l-Scalar l-Scalar-Plain">readOnly</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
        <span class="l l-Scalar l-Scalar-Plain">ports</span><span class="p p-Indicator">:</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">containerPort</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
            <span class="l l-Scalar l-Scalar-Plain">protocol</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">TCP</span>
      <span class="l l-Scalar l-Scalar-Plain">volumes</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">html</span>
        <span class="l l-Scalar l-Scalar-Plain">emptyDir</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{}</span>
</pre></div>


<blockquote>
<p>html 볼륨을 html-generator 및 web-seerver 컨테이너에 모두 마운트 하였습니다.</p>
<p>html 볼륨에는 /var/htdocs 및 /usr/share/nginx/html  이름 으로 서로 따른 컨테이너에서 바라 보게 됩니다.</p>
<p>다만, web-server 컨테이너는 읽기 전용(reeadOnly) 으로만 접근 하도록 설정 하였습니다. </p>
<p>emptDir 을 디스크가 아닌 메모리에 생성 할 수도 있으며, 이를 위해서는 아래와 같이 설정을 바꾸어 주면 됩니다.</p>
<p>emptyDir: </p>
<p>​    medium: Memory</p>
</blockquote>
<h4 id="713-loadbalancer">7.1.3 LoadBalancer 작성</h4>
<div class="codehilite"><pre><span></span>vi fortune-lb.yaml
</pre></div>


<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">apiVersion</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">fortune-lb</span>
<span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">selector</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">app</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">fortune</span>
  <span class="l l-Scalar l-Scalar-Plain">ports</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">port</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
      <span class="l l-Scalar l-Scalar-Plain">targetPort</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
  <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">LoadBalancer</span>
  <span class="l l-Scalar l-Scalar-Plain">externalIPs</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">192.168.56.108</span>
</pre></div>


<h4 id="714-deployment-loadbalancer">7.1.4 Deployment 및 Loadbalancer 생성</h4>
<div class="codehilite"><pre><span></span>$ kubectl apply -f ./fortune-deploy.yaml
$ kubectl apply -f ./fortune-lb.yaml
</pre></div>


<h4 id="715">7.1.5. 서비스 확인</h4>
<div class="codehilite"><pre><span></span>curl http://192.168.56.108
</pre></div>


<h3 id="72-git-emptydir">7.2 Git EmptyDir</h3>
<h4 id="721-git">7.2.1 웹서비스용 Git 리포지토리 생성</h4>
<p>Appendix3 . Git 계정 생성 및 Sync 참조</p>
<h4 id="722-deployment-yaml">7.2.2 Deployment 용 yaml 파일 작성</h4>
<div class="codehilite"><pre><span></span>$ <span class="nb">cd</span> ./gitvolume/kubetmp
$ vi gitvolume-deploy.yaml
</pre></div>


<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">apiVersion</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">gitvolume-deployment</span>
  <span class="l l-Scalar l-Scalar-Plain">labels</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">app</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">replicas</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
  <span class="l l-Scalar l-Scalar-Plain">selector</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">matchLabels</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">app</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
  <span class="l l-Scalar l-Scalar-Plain">template</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">labels</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">app</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
    <span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">containers</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
        <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">web-server</span>
        <span class="l l-Scalar l-Scalar-Plain">volumeMounts</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">html</span>
          <span class="l l-Scalar l-Scalar-Plain">mountPath</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/usr/share/nginx/html</span>
          <span class="l l-Scalar l-Scalar-Plain">readOnly</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
        <span class="l l-Scalar l-Scalar-Plain">ports</span><span class="p p-Indicator">:</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">containerPort</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
            <span class="l l-Scalar l-Scalar-Plain">protocol</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">TCP</span>
      <span class="l l-Scalar l-Scalar-Plain">volumes</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">html</span>
        <span class="l l-Scalar l-Scalar-Plain">gitRepo</span><span class="p p-Indicator">:</span>
          <span class="l l-Scalar l-Scalar-Plain">repository</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">https://github.com/dangtong76/k8s-website.git</span>
          <span class="l l-Scalar l-Scalar-Plain">revision</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">master</span>
          <span class="l l-Scalar l-Scalar-Plain">directory</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">.</span>
</pre></div>


<h4 id="723-deployment">7.2.3 Deployment 생성</h4>
<div class="codehilite"><pre><span></span>$ kubectl apply -f ./gitvolume-deploy.yaml
</pre></div>


<h3 id="73-gce-persisteent-disk">7.3 GCE Persisteent DISK 사용하기</h3>
<h4 id="731-persistent-disk">7.3.1. Persistent DISK 생성</h4>
<ul>
<li>Disk 생성</li>
</ul>
<div class="codehilite"><pre><span></span>$ gcloud compute disks create --size<span class="o">=</span>16GiB --zone<span class="o">=</span><span class="nv">europe</span><span class="o">=</span>asia-southeast1-a mongodb
</pre></div>


<ul>
<li>생성 확인</li>
</ul>
<div class="codehilite"><pre><span></span>$ gcloud container cluster list
</pre></div>


<h4 id="732-pod-yaml">7.3.2 Pod 생성을 위한 yaml 파일 작성</h4>
<ul>
<li>파일명 : gce-pv.yaml</li>
</ul>
<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">apiVersion</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">mongodb</span>
<span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">volumes</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">mongodb-data</span>
    <span class="l l-Scalar l-Scalar-Plain">gcePersistentDisk</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">pdName</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">mongodb</span>
      <span class="l l-Scalar l-Scalar-Plain">fsType</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ext4</span>
  <span class="l l-Scalar l-Scalar-Plain">containers</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">mongo</span>
    <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span>  <span class="l l-Scalar l-Scalar-Plain">mongodb</span>
    <span class="l l-Scalar l-Scalar-Plain">volumeMounts</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span>  <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">mongodb-data</span>
       <span class="l l-Scalar l-Scalar-Plain">mountPath</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/data/db</span>
    <span class="l l-Scalar l-Scalar-Plain">ports</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">containerPort</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">27017</span>
      <span class="l l-Scalar l-Scalar-Plain">protocol</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">TCP</span>
</pre></div>


<ul>
<li>Pod 생성</li>
</ul>
<div class="codehilite"><pre><span></span>$ kubectl apply -f ./gce-pv.yaml

$ kubectl get po

NAME      READY   STATUS    RESTARTS   AGE
mongodb   <span class="m">1</span>/1     Running   <span class="m">0</span>          8m42s
</pre></div>


<ul>
<li>Disk 확인 </li>
</ul>
<div class="codehilite"><pre><span></span>$ kubectl describe pod mongodb

...<span class="o">(</span>중략<span class="o">)</span>

Volumes:
  mongodb-data:
    Type:       GCEPersistentDisk <span class="o">(</span>a Persistent Disk resource in Google Compute Engine<span class="o">)</span>
    PDName:     mongodb  <span class="c1"># 디스크이름</span>
    FSType:     ext4
    Partition:  <span class="m">0</span>
    ReadOnly:   <span class="nb">false</span>
  default-token-dgkd5:
    Type:        Secret <span class="o">(</span>a volume populated by a Secret<span class="o">)</span>
    SecretName:  default-token-dgkd5
    Optional:    <span class="nb">false</span>

...<span class="o">(</span>중략<span class="o">)</span>
</pre></div>


<h4 id="733-mongodb-insert">7.3.3 Mongodb 접속 및 데이터 Insert</h4>
<ul>
<li>접속</li>
</ul>
<div class="codehilite"><pre><span></span>kubectl <span class="nb">exec</span> -it mongodb mongo
</pre></div>


<ul>
<li>데이터 Insert</li>
</ul>
<div class="codehilite"><pre><span></span>&gt; use mystore
&gt; db.foo.insert<span class="o">({</span>first-name: <span class="s1">&#39;dangtong&#39;</span><span class="o">})</span>

&gt; db.foo.find<span class="o">()</span>
<span class="o">{</span> <span class="s2">&quot;_id&quot;</span> : ObjectId<span class="o">(</span><span class="s2">&quot;5e9684134384860bc207b1f9&quot;</span><span class="o">)</span>, <span class="s2">&quot;first-name&quot;</span> : <span class="s2">&quot;dangtong&quot;</span> <span class="o">}</span>

&gt; <span class="nb">exit</span>
</pre></div>


<h4 id="734-mongodb-pod">7.3.4 MongoDB Pod 재시작</h4>
<ul>
<li>MongoDB 중단</li>
</ul>
<div class="codehilite"><pre><span></span>$ kubectl delete pod mongodb
</pre></div>


<ul>
<li>MongoDB Pod 재생성</li>
</ul>
<div class="codehilite"><pre><span></span>$ kubectl apply -f ./gce-pv.yaml
</pre></div>


<ul>
<li>기존에 Insert 한 데이터 확인</li>
</ul>
<div class="codehilite"><pre><span></span>$ kubectl <span class="nb">exec</span> -it mongodb mongo

&gt; use mystore

&gt; db.foo.find<span class="o">()</span>
<span class="o">{</span> <span class="s2">&quot;_id&quot;</span> : ObjectId<span class="o">(</span><span class="s2">&quot;5e9684134384860bc207b1f9&quot;</span><span class="o">)</span>, <span class="s2">&quot;first-name&quot;</span> : <span class="s2">&quot;dangtong&quot;</span> <span class="o">}</span>
</pre></div>


<h4 id="735-pod">7.3.5 Pod 삭제</h4>
<div class="codehilite"><pre><span></span>$ kubectl delete po mongodb
</pre></div>


<h3 id="74-persistentvolume-persistentvolumeclaim">7.4 PersistentVolume 및 PersistentVolumeClaim</h3>
<h4 id="741-persistentvolume">7.4.1 PersistentVolume 생성</h4>
<p>gce-pv2.yaml 로 작성</p>
<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">apiVersion</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">PersistentVolume</span>
<span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
   <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">mongodb-pv</span>
<span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">capacity</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">storage</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">1Gi</span>
  <span class="l l-Scalar l-Scalar-Plain">accessModes</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ReadOnlyMany</span>
  <span class="l l-Scalar l-Scalar-Plain">persistentVolumeReclaimPolicy</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Retain</span>
  <span class="l l-Scalar l-Scalar-Plain">gcePersistentDisk</span><span class="p p-Indicator">:</span>
   <span class="l l-Scalar l-Scalar-Plain">pdName</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">mongodb</span>
   <span class="l l-Scalar l-Scalar-Plain">fsType</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ext4</span>
</pre></div>


<div class="codehilite"><pre><span></span>kubectl apply -f ./gce-pv2.yaml
</pre></div>


<div class="codehilite"><pre><span></span>kubectl get pv
</pre></div>


<h4 id="742-persistentvolumeclaim">7.4.2 PersistentVolumeClaim 생성</h4>
<p>gce-pvc.yaml 로 작성</p>
<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">apiVersion</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
<span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">mongodb-pvc</span>
<span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">resources</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">request</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">storage</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">1Gi</span>
  <span class="l l-Scalar l-Scalar-Plain">accessModes</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
  <span class="l l-Scalar l-Scalar-Plain">storageClassName</span><span class="p p-Indicator">:</span> <span class="s">&quot;&quot;</span>
</pre></div>


<div class="codehilite"><pre><span></span>kubectl apply -f ./gce-pvc.yaml
</pre></div>


<div class="codehilite"><pre><span></span>kubectl get pvc
</pre></div>


<h4 id="743-pv-pvc-pod">7.4.3 PV, PVC 를 이용한 Pod 생성</h4>
<p>gce-pod.yaml 파일 생성</p>
<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">apiVersion</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">mongodb</span>
<span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">containers</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">mongo</span>
    <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">mongodb</span>
    <span class="l l-Scalar l-Scalar-Plain">volumeMounts</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">mongodb-data</span>
      <span class="l l-Scalar l-Scalar-Plain">mountPath</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/data/db</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">Ports</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">containerPort</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">27017</span>
    <span class="l l-Scalar l-Scalar-Plain">protocol</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">TCP</span>
  <span class="l l-Scalar l-Scalar-Plain">volumes</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">mongodb-data</span>
    <span class="l l-Scalar l-Scalar-Plain">persistentVolumeClaim</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">claimName</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">mongdodb-pvc</span>
</pre></div>


<div class="codehilite"><pre><span></span>$ kubectl apply -f ./gce-pod.yaml
</pre></div>


<div class="codehilite"><pre><span></span>$ kubectl get po,pv,pvc
</pre></div>


<h4 id="744-mongodb">7.4.4 Mongodb 접속 및 데이터 확인</h4>
<div class="codehilite"><pre><span></span>$ kubectl <span class="nb">exec</span> -it mongodb mongo

&gt; use mystore

&gt; db.foo.find<span class="o">()</span>
</pre></div>


<h3 id="75-persistent-volume">7.5 Persistent Volume 의 동적 할당</h3>
<h4 id="751-storageclass">7.5.1 StorageClass 를 이용해 스토리지 유형 정의</h4>
<ul>
<li>gce-scklass.yaml</li>
</ul>
<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">apiVersion</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">storage.k8s.io/v1</span>
<span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">StorageClass</span>
<span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">fast</span>
<span class="l l-Scalar l-Scalar-Plain">provisioner</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">kubernetes.io/gce-pd</span>
<span class="l l-Scalar l-Scalar-Plain">parameters</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">pd-ssd</span>
  <span class="l l-Scalar l-Scalar-Plain">zone</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">asia-southeast1-a</span> <span class="c1">#클러스터를 만든 지역으로 설정 해야함</span>
</pre></div>


<div class="codehilite"><pre><span></span>$ kubectl apply -f ./gce-sclass.yaml
</pre></div>


<h4 id="752-pvc">7.5.2 PVC 생성</h4>
<ul>
<li>gce-pvc-sclass.yaml</li>
</ul>
<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">apiVersion</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
<span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
   <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">mongdb-pvc</span>
<span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">storageClassName</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">fast</span>
  <span class="l l-Scalar l-Scalar-Plain">resources</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">requests</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">storage</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">100Mi</span>
  <span class="l l-Scalar l-Scalar-Plain">accessModes</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
</pre></div>


<div class="codehilite"><pre><span></span>$ kubectl apply -f ./gce-pvc-sclass.yaml
</pre></div>


<h4 id="753-pv-pvc">7.5.3 PV 및 PVC 확인</h4>
<ul>
<li>pvc 확인</li>
</ul>
<div class="codehilite"><pre><span></span>$ kubectl get pvc mongdb-pvc
</pre></div>


<ul>
<li>pv 확인</li>
</ul>
<div class="codehilite"><pre><span></span>$ kubectl get pv
</pre></div>


<h4 id="754-pvc-pod">7.5.4 PVC 를 이용한 POD 생성</h4>
<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">gce-pod.yaml 파일 생성</span>

<span class="l l-Scalar l-Scalar-Plain">​```{yaml}</span>
<span class="l l-Scalar l-Scalar-Plain">apiVersion</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">mongodb</span>
<span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">containers</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">mongo</span>
    <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">mongodb</span>
    <span class="l l-Scalar l-Scalar-Plain">volumeMounts</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">mongodb-data</span>
      <span class="l l-Scalar l-Scalar-Plain">mountPath</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/data/db</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">Ports</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">containerPort</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">27017</span>
    <span class="l l-Scalar l-Scalar-Plain">protocol</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">TCP</span>
  <span class="l l-Scalar l-Scalar-Plain">volumes</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">mongodb-data</span>
    <span class="l l-Scalar l-Scalar-Plain">persistentVolumeClaim</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">claimName</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">mongdodb-pvc</span>

<span class="l l-Scalar l-Scalar-Plain">​```</span>
</pre></div>


<h2 id="8-configmap">8. ConfigMap</h2>
<h4 id="81_1">8.1 도커에서 매개변수 전달</h4>
<h5 id="811">8.1.1 디렉토리 생성 및 소스 코드 작성</h5>
<div class="codehilite"><pre><span></span>mkdir -p ./configmap/docimg/indocker
mkdir -p ./configmap/kubetmp

<span class="nb">cd</span> ./configmap/docimg/indocker
vi fortuneloop.sh
</pre></div>


<div class="codehilite"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="nb">trap</span> <span class="s2">&quot;exit&quot;</span> SIGINT
<span class="nv">INTERVAL</span><span class="o">=</span><span class="nv">$1</span>
<span class="nb">echo</span> <span class="s2">&quot;Configured to generate neew fortune every &quot;</span> <span class="nv">$INTERVAL</span> <span class="s2">&quot; seconds&quot;</span>
mkdir /var/htdocs
<span class="k">while</span> :
<span class="k">do</span>
    <span class="nb">echo</span> <span class="k">$(</span>date<span class="k">)</span> Writing fortune to /var/htdocs/index.html
    /usr/games/fortune  &gt; /var/htdocs/index.html
    sleep <span class="nv">$INTERVAL</span>
<span class="k">done</span>
</pre></div>


<h5 id="812-docker">8.1.2 Docker 이미지 생성</h5>
<div class="codehilite"><pre><span></span>$ vi dockerfile
</pre></div>


<div class="codehilite"><pre><span></span><span class="k">FROM</span><span class="s"> ub</span>
untu:latest
<span class="k">RUN</span> apt-get update<span class="p">;</span>  apt-get -y install fortune
<span class="k">ADD</span><span class="s"> fortuneloop.sh /bin/fortuneloop.sh</span>
<span class="k">ENTRYPOINT</span><span class="s"> [&quot;/bin/fortuneloop.sh&quot;]</span>
<span class="k">CMD</span><span class="s"> [&quot;10&quot;]  # args가 없으면 10초</span>
</pre></div>


<div class="codehilite"><pre><span></span>$ docker build -t dangtong/fortune:args .
$ docker push dangtong/fortune:args
</pre></div>


<blockquote>
<p>테스트를 위해 다음과 같이 수행 가능 </p>
<p>$ docker run -it dangtong/fortune:args # 기본 10초 수행</p>
<p>$ docker run -it dangtong/fortune:args 15 # 15초로 매개변수 전달</p>
</blockquote>
<h5 id="813-pod">8.1.3 Pod생성</h5>
<p>파일명 : config-fortune-pod.yaml</p>
<div class="codehilite"><pre><span></span><span class="nb">cd</span> ../../kubetmp
vi config-fortune-indocker-pod.yaml
</pre></div>


<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">apiVersion</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">fortune5s</span>
<span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">containers</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">dangtong/fortune:args</span>
    <span class="l l-Scalar l-Scalar-Plain">args</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;5&quot;</span><span class="p p-Indicator">]</span>
    <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">html-generator</span>
    <span class="l l-Scalar l-Scalar-Plain">volumeMounts</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">html</span>
      <span class="l l-Scalar l-Scalar-Plain">mountPath</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/var/htdocs</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
    <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">web-server</span>
    <span class="l l-Scalar l-Scalar-Plain">volumeMounts</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">html</span>
      <span class="l l-Scalar l-Scalar-Plain">mountPath</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/usr/share/nginx/html</span>
      <span class="l l-Scalar l-Scalar-Plain">readOnly</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class=" -Error"> </span><span class="l l-Scalar l-Scalar-Plain">ports</span><span class="p p-Indicator">:</span>
     <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">containerPort</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
       <span class="l l-Scalar l-Scalar-Plain">protocol</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">TCP</span>
  <span class="l l-Scalar l-Scalar-Plain">volumes</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">html</span>
    <span class="l l-Scalar l-Scalar-Plain">emptyDir</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{}</span>
</pre></div>


<div class="codehilite"><pre><span></span>kubectl apply -f ./config-fortune-indockeer-pod.yaml
</pre></div>


<h4 id="82-yaml">8.2 Yaml 파일을 통한 매개변수 전달</h4>
<h5 id="821-fortuneloopsh">8.2.1 fortuneloop.sh 작성</h5>
<div class="codehilite"><pre><span></span><span class="nb">cd</span> ../
mkdir -p ./docimg/inyaml
<span class="nb">cd</span> ./docimg/inyaml
vi fortuneloop.sh
</pre></div>


<div class="codehilite"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="nb">trap</span> <span class="s2">&quot;exit&quot;</span> SIGINT
<span class="nb">echo</span> <span class="s2">&quot;Configured to generate neew fortune every &quot;</span> <span class="nv">$INTERVAL</span> <span class="s2">&quot; seconds&quot;</span>
mkdir /var/htdocs
<span class="k">while</span> :
<span class="k">do</span>
    <span class="nb">echo</span> <span class="k">$(</span>date<span class="k">)</span> Writing fortune to /var/htdocs/index.html
    /usr/games/fortune  &gt; /var/htdocs/index.html
    sleep <span class="nv">$INTERVAL</span>
<span class="k">done</span>
</pre></div>


<h5 id="822-dockerfile-build">8.2.2 Dockerfile 작성 및 build</h5>
<div class="codehilite"><pre><span></span>$ vi dockerfile
</pre></div>


<div class="codehilite"><pre><span></span><span class="k">FROM</span><span class="s"> ub</span>
untu:latest
<span class="k">RUN</span> apt-get update<span class="p">;</span>  apt-get -y install fortune
<span class="k">ADD</span><span class="s"> fortuneloop.sh /bin/fortuneloop.sh</span>
<span class="k">ENTRYPOINT</span><span class="s"> [&quot;/bin/fortuneloop.sh&quot;]</span>
<span class="k">CMD</span><span class="s"> [&quot;10&quot;]  # args가 없으면 10초</span>
</pre></div>


<div class="codehilite"><pre><span></span>$ docker build -t dangtong/fortune:env .
$ docker push dangtong/fortune:env
</pre></div>


<h5 id="822-pod-yaml">8.2.2 Pod 생성및 매개변수 전달을 위한 yaml 파일 작성</h5>
<div class="codehilite"><pre><span></span><span class="nb">cd</span> ../../kubetmp
vi config-fortune-inyaml-pod.yaml
</pre></div>


<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">apiVersion</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">fortune30s</span>
<span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">containers</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">dangtong/fortune:env</span>
    <span class="l l-Scalar l-Scalar-Plain">env</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">INTERVAL</span>
      <span class="l l-Scalar l-Scalar-Plain">value</span><span class="p p-Indicator">:</span> <span class="s">&quot;30&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">html-generator</span>
    <span class="l l-Scalar l-Scalar-Plain">volumeMounts</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">html</span>
      <span class="l l-Scalar l-Scalar-Plain">mountPath</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/var/htdocs</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
    <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">web-server</span>
    <span class="l l-Scalar l-Scalar-Plain">volumeMounts</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">html</span>
      <span class="l l-Scalar l-Scalar-Plain">mountPath</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/usr/share/nginx/html</span>
      <span class="l l-Scalar l-Scalar-Plain">readOnly</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class=" -Error"> </span><span class="l l-Scalar l-Scalar-Plain">ports</span><span class="p p-Indicator">:</span>
     <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">containerPort</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
       <span class="l l-Scalar l-Scalar-Plain">protocol</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">TCP</span>
  <span class="l l-Scalar l-Scalar-Plain">volumes</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">html</span>
    <span class="l l-Scalar l-Scalar-Plain">emptyDir</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{}</span>
</pre></div>


<h4 id="83-configmap">8.3 ConfigMap 을 통한 설정</h4>
<h5 id="831-configmap">8.3.1 ConfigMap 생성 및 확인</h5>
<ul>
<li>configMap 생성</li>
</ul>
<div class="codehilite"><pre><span></span>$ kubectl create configmap fortune-config --from-literal<span class="o">=</span>sleep-interval<span class="o">=</span><span class="m">7</span>
</pre></div>


<blockquote>
<p>ConfigMap 생성시 이름은 영문자,숫자, 대시, 밑줄, 점 만 포함 할 수 있습니다.</p>
<p>만약 여러개의 매개변수를 저장 할려면 --from-literal=sleep-interval=5 --from-literal=sleep-count=10 와 같이 from-literal 부분을 여러번 반복해서 입력 하면 됩니다.</p>
</blockquote>
<ul>
<li>configMap 확인</li>
</ul>
<div class="codehilite"><pre><span></span>$ kubectl get cm fortune-config

NAME             DATA   AGE
fortune-config   <span class="m">1</span>      15s

$ kubectl get configmap fortune-config. -o yaml

apiVersion: v1
data:
  sleep-interval: <span class="s2">&quot;7&quot;</span>
kind: ConfigMap
metadata:
  creationTimestamp: <span class="s2">&quot;2020-04-16T09:09:33Z&quot;</span>
  name: fortune-config
  namespace: default
  resourceVersion: <span class="s2">&quot;1044269&quot;</span>
  selfLink: /api/v1/namespaces/default/configmaps/fortune-config
  uid: 85723e0a-1959-4ace-9365-47c101ebef82
</pre></div>


<h5 id="832-configmap-yaml">8.3.2 ConfigMap을 환경변수로  전달한는 yaml 파일 작성</h5>
<ul>
<li>Yaml 파일 생성</li>
</ul>
<div class="codehilite"><pre><span></span>vi config-fortune-mapenv-pod.yaml
</pre></div>


<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">apiVersion</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">fortune7s</span>
<span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">containers</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">dangtong/fortune:env</span>
    <span class="l l-Scalar l-Scalar-Plain">env</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">INTERVAL</span>
      <span class="l l-Scalar l-Scalar-Plain">valueFrom</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">configMapKeyRef</span><span class="p p-Indicator">:</span>
          <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">fortune-config</span>
          <span class="l l-Scalar l-Scalar-Plain">key</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">sleep-interval</span>
    <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">html-generator</span>
    <span class="l l-Scalar l-Scalar-Plain">volumeMounts</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">html</span>
      <span class="l l-Scalar l-Scalar-Plain">mountPath</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/var/htdocs</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
    <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">web-server</span>
    <span class="l l-Scalar l-Scalar-Plain">volumeMounts</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">html</span>
      <span class="l l-Scalar l-Scalar-Plain">mountPath</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/usr/share/nginx/html</span>
      <span class="l l-Scalar l-Scalar-Plain">readOnly</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="l l-Scalar l-Scalar-Plain">ports</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">containerPort</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
      <span class="l l-Scalar l-Scalar-Plain">protocol</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">TCP</span>
  <span class="l l-Scalar l-Scalar-Plain">volumes</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">html</span>
    <span class="l l-Scalar l-Scalar-Plain">emptyDir</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{}</span>
</pre></div>


<h5 id="833-pod">8.3.3 Pod 생성 및 확인</h5>
<ul>
<li>Pod 생성</li>
</ul>
<div class="codehilite"><pre><span></span>$ kubectl create -f ./config-fortune-mapenv-pod.yaml
</pre></div>


<ul>
<li>Pod 생성 확인</li>
</ul>
<div class="codehilite"><pre><span></span>$ kubectl get po, cm

$ kubectl describe cm

Name:         fortune-config
Namespace:    default
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;

<span class="nv">Data</span>
<span class="o">====</span>
sleep-interval:
----
<span class="m">7</span>
Events:  &lt;none&gt;
</pre></div>


<ul>
<li>configMap 삭제</li>
</ul>
<div class="codehilite"><pre><span></span>$ kubectl delete configmap fortune-config 
</pre></div>


<h4 id="84-configmap-volume">8.4 ConfigMap Volume 사용 (파일숨김)</h4>
<h5 id="841-configmap">8.4.1 ConfigMap 생성</h5>
<p>파일명 : custom-nginx-config.conf</p>
<div class="codehilite"><pre><span></span>server {
    listen              8080;
    server_name     www.acron.com

    gzip on;
    gzip_types text/plain application/xml;
    location / {
        root    /usr/share/nginx/html;
        index   index.html index.htm;
    }
}
</pre></div>


<div class="codehilite"><pre><span></span>$ kubectl create configmap fortune-config --from-file<span class="o">=</span>configmap-files 
</pre></div>


<h5 id="842-configmap-volume-pod">8.4.2 configMap volume 이용 Pod 생성</h5>
<ul>
<li>Yaml 파일 작성 : config-fortune-mapvol-pod.yaml</li>
</ul>
<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">apiVersion</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx-configvol</span>
<span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">containers</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx:1.7.9</span>
    <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">web-server</span>
    <span class="l l-Scalar l-Scalar-Plain">volumeMounts</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">config</span>
      <span class="l l-Scalar l-Scalar-Plain">mountPath</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/nginx/conf.d/default.conf</span>
      <span class="l l-Scalar l-Scalar-Plain">readOnly</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="l l-Scalar l-Scalar-Plain">ports</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">containerPort</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">8080</span>
      <span class="l l-Scalar l-Scalar-Plain">protocol</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">TCP</span>
  <span class="l l-Scalar l-Scalar-Plain">volumes</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">config</span>
    <span class="l l-Scalar l-Scalar-Plain">configMap</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">fortune-config</span>
</pre></div>


<blockquote>
<p>서버에 접속해서 디렉토리 구조를 한번 보는것이 좋습니다.</p>
<p>kubectl exec -it nginx-pod bash</p>
</blockquote>
<div class="codehilite"><pre><span></span>$ kubectl apply -f ./config-fortune-mapvol-pod.yaml
</pre></div>


<h5 id="843-configmap-volume">8.4.3 ConfigMap Volume  참조  확인</h5>
<div class="codehilite"><pre><span></span>$ kubectl get pod -o wide

AME              READY   STATUS    RESTARTS   AGE     IP          NODE                 
nginx-configvol   <span class="m">1</span>/1     Running   <span class="m">0</span>          9m25s   <span class="m">10</span>.32.0.2   worker01.acorn.com
</pre></div>


<ul>
<li>Response 에 압축(gzip)을 사용 하는지 확인</li>
</ul>
<div class="codehilite"><pre><span></span>$ curl -H <span class="s2">&quot;Accept-Encoding: gzip&quot;</span> -I <span class="m">10</span>.32.0.2:8080
</pre></div>


<ul>
<li>마운트된 configMap 볼륨 내용확인</li>
</ul>
<div class="codehilite"><pre><span></span>$ kubectl <span class="nb">exec</span> nginx-configvol -c web-server ls /etc/nginx/conf.d

nginx-config.conf
sleep-interval

$ kubectl <span class="nb">exec</span> -it nginx-configvol sh
</pre></div>


<h5 id="844-configmap">8.4.4 ConfigMap 동적 변경</h5>
<ul>
<li>사전 테스트</li>
</ul>
<div class="codehilite"><pre><span></span>$ curl -H <span class="s2">&quot;Accept-Encoding: gzip&quot;</span> -I <span class="m">10</span>.32.0.2:8080

HTTP/1.1 <span class="m">200</span> OK
Server: nginx/1.17.9
Date: Fri, <span class="m">17</span> Apr <span class="m">2020</span> <span class="m">06</span>:10:32 GMT
Content-Type: text/html
Last-Modified: Tue, <span class="m">03</span> Mar <span class="m">2020</span> <span class="m">14</span>:32:47 GMT
Connection: keep-alive
ETag: W/<span class="s2">&quot;5e5e6a8f-264&quot;</span>
Content-Encoding: gzip
</pre></div>


<ul>
<li>configMap 변경</li>
</ul>
<div class="codehilite"><pre><span></span>$ kubectl edit cm fortune-config
</pre></div>


<p><strong>gzip on</strong> 부분을   <strong>gzip off </strong>  로 변경 합니다.</p>
<div class="codehilite"><pre><span></span>apiVersion: v1
data:
  nginx-config.conf: <span class="s2">&quot;server {\n  listen\t80;\n  server_name\tnginx.acorn.com;\n\n</span>
<span class="s2">    \ gzip off;\n  gzip_types text/plain application/xml;\n  location / {\n    root\t/usr/share/nginx/html;\n</span>
<span class="s2">    \   index\tindex.html index.htm;\n  }  \n}\n\n\n&quot;</span>
  nginx-ssl-config.conf: <span class="s1">&#39;##Nginx SSL Config&#39;</span>
  sleep-interval: <span class="p">|</span>
    <span class="m">25</span>
kind: ConfigMap
metadata:
  creationTimestamp: <span class="s2">&quot;2020-04-16T15:58:42Z&quot;</span>
  name: fortune-config
  namespace: default
  resourceVersion: <span class="s2">&quot;1115758&quot;</span>
  selfLink: /api/v1/namespaces/default/configmaps/fortune-config
  uid: 182302d8-f30f-4045-9615-36e24b185ecb
</pre></div>


<ul>
<li>변경후 테스트</li>
</ul>
<div class="codehilite"><pre><span></span>$ curl -H <span class="s2">&quot;Accept-Encoding: gzip&quot;</span> -I <span class="m">10</span>.32.0.2:8080

HTTP/1.1 <span class="m">200</span> OK
Server: nginx/1.17.9
Date: Fri, <span class="m">17</span> Apr <span class="m">2020</span> <span class="m">06</span>:10:32 GMT
Content-Type: text/html
Last-Modified: Tue, <span class="m">03</span> Mar <span class="m">2020</span> <span class="m">14</span>:32:47 GMT
Connection: keep-alive
ETag: W/<span class="s2">&quot;5e5e6a8f-264&quot;</span>
Content-Encoding: gzip
</pre></div>


<ul>
<li>reload 로 변경 사항 컨테이너에  알리기</li>
</ul>
<div class="codehilite"><pre><span></span>$ kubectl  <span class="nb">exec</span> nginx-configvol -c web-server -- nginx -s reload
</pre></div>


<ul>
<li>최종 테스트</li>
</ul>
<div class="codehilite"><pre><span></span>$ curl -H <span class="s2">&quot;Accept-Encoding: gzip&quot;</span> -I <span class="m">10</span>.32.0.2:8080

HTTP/1.1 <span class="m">200</span> OK
Server: nginx/1.17.9
Date: Fri, <span class="m">17</span> Apr <span class="m">2020</span> <span class="m">06</span>:10:32 GMT
Content-Type: text/html
Last-Modified: Tue, <span class="m">03</span> Mar <span class="m">2020</span> <span class="m">14</span>:32:47 GMT
Connection: keep-alive
ETag: W/<span class="s2">&quot;5e5e6a8f-264&quot;</span>
</pre></div>


<h4 id="85-configmap-volume">8.5 ConfigMap Volume(파일 추가)</h4>
<h5 id="851-configmap-volume-pod">8.5.1 configMap volume 이용 Pod 생성</h5>
<ul>
<li>Yaml 파일 작성 : config-fortune-mapvol-pod2.yaml</li>
</ul>
<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx-configvol</span>
<span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">containers</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx:1.7.9</span>
    <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">web-server</span>
    <span class="l l-Scalar l-Scalar-Plain">volumeMounts</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">config</span>
      <span class="l l-Scalar l-Scalar-Plain">mountPath</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/nginx/conf.d/default.conf</span>
      <span class="l l-Scalar l-Scalar-Plain">subPath</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx-config.conf</span>
      <span class="l l-Scalar l-Scalar-Plain">readOnly</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="l l-Scalar l-Scalar-Plain">ports</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">containerPort</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">8080</span>
      <span class="l l-Scalar l-Scalar-Plain">protocol</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">TCP</span>
  <span class="l l-Scalar l-Scalar-Plain">volumes</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">config</span>
    <span class="l l-Scalar l-Scalar-Plain">configMap</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">fortune-config</span>
      <span class="l l-Scalar l-Scalar-Plain">defaultMode</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0660</span>
</pre></div>


<blockquote>
<p>nginx 1.7.9 이상 버전, 예를 들면 nginx:latest 로 하면 /etc/nginx/conf.d 폴더내에 default.conf 파일만 존재 합니다. Example_ssl.conf 파일은 없습니다. 테스트를 위해서 nginx:1.7.9 버전으로 설정 한것입니다.</p>
</blockquote>
<div class="codehilite"><pre><span></span>$ kubectl apply -f ./config-fortune-mapvol-pod.yaml
</pre></div>


<h5 id="852-confimap">8.5.2 서비스 및 ConfiMap 확인</h5>
<ul>
<li>서비스 확인</li>
</ul>
<div class="codehilite"><pre><span></span>$ curl -H <span class="s2">&quot;Accept-Encoding: gzip&quot;</span> -I <span class="m">10</span>.32.0.2:8080
</pre></div>


<ul>
<li>configMap 확인</li>
</ul>
<div class="codehilite"><pre><span></span>$ kubectl <span class="nb">exec</span> nginx-configvol -c web-server ls /etc/nginx/conf.d
</pre></div>


<h5 id="853-configmap">8.5.3 ConfigMap 추가</h5>
<ul>
<li>configMap 추가</li>
</ul>
<div class="codehilite"><pre><span></span>$ kubectl edit cm fortune-config
</pre></div>


<p>아래와  같이 nginx-ssl-config.conf 키값을 추가합니다.</p>
<div class="codehilite"><pre><span></span>apiVersion: v1
data:
  nginx-config.conf: <span class="s2">&quot;server {\n  listen\t80;\n  server_name\tnginx.acorn.com;\n\n</span>
<span class="s2">    \ gzip on;\n  gzip_types text/plain application/xml;\n  location / {\n    root\t/usr/share/nginx/html;\n</span>
<span class="s2">    \   index\tindex.html index.htm;\n  }  \n}\n\n\n&quot;</span>
  nginx-ssl-config.conf: <span class="s2">&quot;&quot;</span><span class="c1">##Nginx SSL Config&quot; # 이부분이 추가됨</span>
  sleep-interval: <span class="p">|</span>
    <span class="m">25</span>
kind: ConfigMap
metadata:
  creationTimestamp: <span class="s2">&quot;2020-04-16T15:58:42Z&quot;</span>
  name: fortune-config
  namespace: default
  resourceVersion: <span class="s2">&quot;1098337&quot;</span>
  selfLink: /api/v1/namespaces/default/configmaps/fortune-config
  uid: 182302d8-f30f-4045-9615-36e24b185ecb
</pre></div>


<h5 id="854-configmap-pod">8.5.4 ConfigMap 추가된 Pod 생성</h5>
<ul>
<li>설정 파일 추가 하기위해 yaml 파일 수정</li>
</ul>
<p>파일명 :  config-fortune-mapvol-pod3.yaml</p>
<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx-configvol</span>
<span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">containers</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx:1.7.9</span>
    <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">web-server</span>
    <span class="l l-Scalar l-Scalar-Plain">volumeMounts</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">config</span> <span class="c1">#default.conf 파일 교체</span>
      <span class="l l-Scalar l-Scalar-Plain">mountPath</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/nginx/conf.d/default.conf</span>
      <span class="l l-Scalar l-Scalar-Plain">subPath</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx-config.conf</span>
      <span class="l l-Scalar l-Scalar-Plain">readOnly</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">config</span> <span class="c1">#example_ssl.conf 파일 교체</span>
      <span class="l l-Scalar l-Scalar-Plain">mountPath</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/nginx/conf.d/example_ssl.conf</span>
      <span class="l l-Scalar l-Scalar-Plain">subPath</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx-ssl-config.conf</span>
      <span class="l l-Scalar l-Scalar-Plain">readOnly</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="l l-Scalar l-Scalar-Plain">ports</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">containerPort</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">8080</span>
      <span class="l l-Scalar l-Scalar-Plain">protocol</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">TCP</span>
  <span class="l l-Scalar l-Scalar-Plain">volumes</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">config</span>
    <span class="l l-Scalar l-Scalar-Plain">configMap</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">fortune-config</span>
      <span class="l l-Scalar l-Scalar-Plain">defaultMode</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0660</span>
</pre></div>


<div class="codehilite"><pre><span></span>$ kubectl apply -f ./ config-fortune-mapvol-pod3.yaml
</pre></div>


<h5 id="856-configmap">8.5.6 추가된 ConfigMap 확인</h5>
<ul>
<li>서비스  확인</li>
</ul>
<div class="codehilite"><pre><span></span>$ curl http://10.32.0.4
</pre></div>


<ul>
<li>configMap 확인</li>
</ul>
<div class="codehilite"><pre><span></span>$ kubectl <span class="nb">exec</span> -it nginx-configvol bash

$ <span class="nb">cd</span> /etc/nginx/conf.d
$ ls -al 
</pre></div>


<h2 id="9-secret">9. Secret</h2>
<ul>
<li>configMap 수정</li>
</ul>
<div class="codehilite"><pre><span></span>kubectl edit configmap fortune-config
</pre></div>


<ul>
<li>Pod 생성 : 8.3.2 의 yaml 파일 참조</li>
</ul>
<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">apiVersion</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">fortune-https</span>
<span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">containers</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">dangtong/fortune:env</span>
    <span class="l l-Scalar l-Scalar-Plain">env</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">INTERVAL</span>
      <span class="l l-Scalar l-Scalar-Plain">valueFrom</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">configMapKeyRef</span><span class="p p-Indicator">:</span>
          <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">fortune-config</span>
          <span class="l l-Scalar l-Scalar-Plain">key</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">sleep-interval</span>
    <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">html-generator</span>
    <span class="l l-Scalar l-Scalar-Plain">volumeMounts</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">html</span>
      <span class="l l-Scalar l-Scalar-Plain">mountPath</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/var/htdocs</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
    <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">web-server</span>
    <span class="l l-Scalar l-Scalar-Plain">volumeMounts</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">html</span>
      <span class="l l-Scalar l-Scalar-Plain">mountPath</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/usr/share/nginx/html</span>
      <span class="l l-Scalar l-Scalar-Plain">readOnly</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">config</span> <span class="c1"># 추가</span>
      <span class="l l-Scalar l-Scalar-Plain">mountPath</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/nginx/conf.d</span>
      <span class="l l-Scalar l-Scalar-Plain">readOnly</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">certs</span> <span class="c1"># 추가</span>
      <span class="l l-Scalar l-Scalar-Plain">mountPath</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/nginx/certs/</span>
      <span class="l l-Scalar l-Scalar-Plain">readOnly</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="l l-Scalar l-Scalar-Plain">ports</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">containerPort</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">containerPort</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">443</span> <span class="c1"># 추가</span>
  <span class="l l-Scalar l-Scalar-Plain">volumes</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">html</span>
    <span class="l l-Scalar l-Scalar-Plain">emptyDir</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{}</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">config</span> <span class="c1"># 추가</span>
    <span class="l l-Scalar l-Scalar-Plain">configMap</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">fortune-config</span>
      <span class="l l-Scalar l-Scalar-Plain">items</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">key</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx-config.conf</span>
        <span class="l l-Scalar l-Scalar-Plain">path</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">https.conf</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">certs</span>  <span class="c1">#추가</span>
    <span class="l l-Scalar l-Scalar-Plain">secret</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">secretName</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">fortune-https</span>
</pre></div>


<hr />
<h1 id="appendix">Appendix</h1>
<h2 id="appendix-0-virtualbox">Appendix 0. VirtualBox 이미지 구성</h2>
<h3 id="1-virtualbox">1. VirtualBox 다운로드 및 설치</h3>
<p>다운로드 : <a href="https://www.virtualbox.org/wiki/Downloads">https://www.virtualbox.org/wiki/Downloads</a></p>
<p><img alt="virtualbox-down" src="./img/virtualbox-down-3549200.png" /></p>
<h3 id="2">2. 가상 이미지 가져오기</h3>
<ul>
<li>구글 드라이버 URL</li>
</ul>
<p>https://drive.google.com/open?id=1qAv-FyIWbQVIxNn3MKfjIwbVdvo4rxVl</p>
<h3 id="3_1">3. 가상 이미지 가져오기</h3>
<p>버추얼 박스 실행 후에 <kbd> 파일 </kbd> &gt; <kbd>가상이미지 가져오기</kbd> 클릭</p>
<p><img alt="vbox-choose-image" src="../../sas_book/img/vbox-choose-image.png" /></p>
<h3 id="4-vm">4. VM 설정</h3>
<p>vm 이름, CPU 개수, MAC 주소 정책 을 아래와 같이 수정 합니다.</p>
<p><img alt="vbox-config" src="./img/vbox-config.png" /></p>
<h3 id="5-vm">5. VM 복제</h3>
<p>오른쪽마우스 -&gt; 복제 클릭</p>
<p><img alt="vbox-copy" src="./img/vbox-copy.png" /></p>
<p>VM이름 및 MAC주소정책 변경 후 <kbd> 복제 </kbd> 클릭</p>
<p><img alt="vbox-copy-config" src="./img/vbox-copy-config.png" /></p>
<p>동일한 방법으로 worker02 VM 또 생성 합니다. 최종적으로 아래와 같이 3개의 VM 이 보이면 됩니다.</p>
<p><img alt="vbox-overall" src="./img/vbox-overall.png" /></p>
<h2 id="appendix-1">Appendix 1. 쿠버네티스 설치</h2>
<h3 id="1">1.설치 사전 작업</h3>
<h4 id="11-nftable-disable">1.1 Nftable disable</h4>
<div class="codehilite"><pre><span></span>sudo update-alternatives --set iptables /usr/sbin/iptables-legacy
sudo update-alternatives --set ip6tables /usr/sbin/ip6tables-legacy
sudo update-alternatives --set arptables /usr/sbin/arptables-legacy
sudo update-alternatives --set ebtables /usr/sbin/ebtables-legacy
</pre></div>


<h4 id="12">1.2 호스트명 변경</h4>
<div class="codehilite"><pre><span></span><span class="c1"># hostnamectl set-hostname [FQDN-HOST-NAME] --static</span>
hostnamectl set-hostname master
hostnamectl set-hostname master.sas.com --static

hostnamectl set-hostname worker1
hostnamectl set-hostname worker1.sas.com --static

hostnamectl set-hostname worker2
hostnamectl set-hostname worker2.sas.com --static
</pre></div>


<h4 id="13">1.3 각노드에 호스트 파일 등록</h4>
<div class="codehilite"><pre><span></span><span class="m">172</span>.31.43.23 master.sas.com master
<span class="m">172</span>.31.42.202 worker1.sas.com worker1
<span class="m">172</span>.31.32.175 worker2.sas.com worker2
</pre></div>


<h4 id="14">1.4 방화벽 점검</h4>
<h5 id="141-control-plane">1.4.1 Control Plane 노드</h5>
<table>
<thead>
<tr>
<th align="left">Protocol</th>
<th align="left">Direction</th>
<th align="left">Port Range</th>
<th align="left">Purpose</th>
<th align="left">Used By</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">TCP</td>
<td align="left">Inbound</td>
<td align="left">6443*</td>
<td align="left">Kubernetes API server</td>
<td align="left">All</td>
</tr>
<tr>
<td align="left">TCP</td>
<td align="left">Inbound</td>
<td align="left">2379-2380</td>
<td align="left">etcd server client API</td>
<td align="left">kube-apiserver, etcd</td>
</tr>
<tr>
<td align="left">TCP</td>
<td align="left">Inbound</td>
<td align="left">10250</td>
<td align="left">Kubelet API</td>
<td align="left">Self, Control plane</td>
</tr>
<tr>
<td align="left">TCP</td>
<td align="left">Inbound</td>
<td align="left">10251</td>
<td align="left">kube-scheduler</td>
<td align="left">Self</td>
</tr>
<tr>
<td align="left">TCP</td>
<td align="left">Inbound</td>
<td align="left">10252</td>
<td align="left">kube-controller-manager</td>
<td align="left">Self</td>
</tr>
</tbody>
</table>
<h5 id="142-worker">1.4.2 worker 노드</h5>
<table>
<thead>
<tr>
<th align="left">Protocol</th>
<th align="left">Direction</th>
<th align="left">Port Range</th>
<th align="left">Purpose</th>
<th align="left">Used By</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">TCP</td>
<td align="left">Inbound</td>
<td align="left">10250</td>
<td align="left">Kubelet API</td>
<td align="left">Self, Control plane</td>
</tr>
<tr>
<td align="left">TCP</td>
<td align="left">Inbound</td>
<td align="left">30000-32767</td>
<td align="left">NodePort Services**</td>
<td align="left">All</td>
</tr>
</tbody>
</table>
<h3 id="2-runtime">2. Runtime 설치</h3>
<h4 id="21-all-nodes">2.1  도커 설치 (all nodes)</h4>
<div class="codehilite"><pre><span></span>sudo apt update
sudo apt install docker.io
</pre></div>


<h4 id="22-kubernetes-all-nodes">2.2 kubernetes 설치 (all nodes)</h4>
<p>설치 스크립트 <a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/#before-you-begin">클릭</a></p>
<div class="codehilite"><pre><span></span>sudo apt-get update <span class="o">&amp;&amp;</span> sudo apt-get install -y apt-transport-https curl
curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg <span class="p">|</span> sudo apt-key add -
cat <span class="s">&lt;&lt;EOF | sudo tee /etc/apt/sources.list.d/kubernetes.list</span>
<span class="s">deb https://apt.kubernetes.io/ kubernetes-xenial main</span>
<span class="s">EOF</span>
sudo apt-get update
sudo apt-get install -y kubelet kubeadm kubectl
sudo apt-mark hold kubelet kubeadm kubectl
</pre></div>


<h3 id="3-post-installation">3. Post Installation</h3>
<h4 id="31-swap-all-nodes">3.1 SWAP 기능 해제(all nodes)</h4>
<div class="codehilite"><pre><span></span>sudo swapoff -a <span class="c1"># 현재 일시적용</span>
sudo sed -i <span class="s1">&#39;/swap/s/^/#/&#39;</span> /etc/fstab <span class="c1"># 재가동 후에도 swapoff 할려면 수행 해야함</span>
</pre></div>


<p>도커 데몬을 system 서비스에 등록하지 않으면 kubernetes 설치시에 warning 발생 하기 때문에 아래와 같이 등록해줌 </p>
<div class="codehilite"><pre><span></span><span class="c1"># Setup daemon.</span>
cat &gt; /etc/docker/daemon.json <span class="s">&lt;&lt;EOF</span>
<span class="s">{</span>
<span class="s">  &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;],</span>
<span class="s">  &quot;log-driver&quot;: &quot;json-file&quot;,</span>
<span class="s">  &quot;log-opts&quot;: {</span>
<span class="s">    &quot;max-size&quot;: &quot;100m&quot;</span>
<span class="s">  },</span>
<span class="s">  &quot;storage-driver&quot;: &quot;overlay2&quot;</span>
<span class="s">}</span>
<span class="s">EOF</span>

mkdir -p /etc/systemd/system/docker.service.d

<span class="c1"># Restart docker.</span>
systemctl <span class="nb">enable</span> docker.service
systemctl daemon-reload
systemctl restart docker
</pre></div>


<h4 id="32-kubeadm-master-node">3.2 kubeadm을 사용하여 마스터 설정 (master node)</h4>
<p>네트워크 인터페이스가 여러개일 경우 가장 우선 순위가 가장 높은 인터페이스가 자동 선정 되기 때문에 '--apiserver-advertise-address' 옵션을 사용해서 ip 혹은 인터페이스 명을 지정해야 합니다.</p>
<div class="codehilite"><pre><span></span>sudo kubeadm init --pod-network-cidr<span class="o">=</span><span class="m">192</span>.168.0.0/16 --apiserver-advertise-address<span class="o">=</span><span class="m">192</span>.168.56.108 

<span class="c1"># kubeadmin init 시에 여러 가지 옵션들</span>
<span class="c1"># --pod-network-cidr=192.168.0.0/16</span>
<span class="c1"># --control-plane-endpoint=192.168.56.108 </span>
<span class="c1"># --apiserver-cert-extra-sans=192.168.56.108</span>

<span class="c1"># 잘못 설치한 경우 master 및 worker 노드에 수행 하면 모든 설정을 초기화함</span>
<span class="c1"># kubeadm reset cleanup-node</span>
</pre></div>


<h3 id="4_1">4. 워커 노드 등록</h3>
<h4 id="41-worker-nodes">4.1 워커 노드 등록 (worker nodes)</h4>
<blockquote>
<p>반듯이 kubeadm init 을 통해 나온 로그에 표시된 ip 와 token 으로 worker 노드에서만 수행</p>
</blockquote>
<div class="codehilite"><pre><span></span>kubeadm join <span class="m">192</span>.168.56.108:6443 --token dro5or.x9ujk49k0aadiz8s <span class="se">\</span>
    --discovery-token-ca-cert-hash sha256:b6372f30c5733a5c88d0a6b6095efbf4cb495329cbcd19df33e7a894a96ec53d
</pre></div>


<h4 id="42-kube-client">4.2 마스터 노드 kube client 설정</h4>
<div class="codehilite"><pre><span></span>mkdir -p <span class="nv">$HOME</span>/.kube
sudo cp -i /etc/kubernetes/admin.conf <span class="nv">$HOME</span>/.kube/config
sudo chown <span class="k">$(</span>id -u<span class="k">)</span>:<span class="k">$(</span>id -g<span class="k">)</span> <span class="nv">$HOME</span>/.kube/config
</pre></div>


<h4 id="43">4.3 클러스터 상태 확인</h4>
<p>결과가 모두 not ready 로 나옴</p>
<div class="codehilite"><pre><span></span>kubectl get nodes
</pre></div>


<h4 id="44">4.4 네트워크 어플리케이션 설치</h4>
<p>네트워크 툴 설치 후에는 모든 노드가 ready 로 나와야 함</p>
<div class="codehilite"><pre><span></span>kubectl apply -f <span class="s2">&quot;https://cloud.weave.works/k8s/net?k8s-version=</span><span class="k">$(</span>kubectl version <span class="p">|</span> base64 <span class="p">|</span> tr -d <span class="s1">&#39;\n&#39;</span><span class="k">)</span><span class="s2">&quot;</span>

kubectl get nodes
</pre></div>


<h4 id="45-kubectl">4.5 kubectl 명령어 자동완성 패키지 설치</h4>
<div class="codehilite"><pre><span></span><span class="c1"># 자동 완성을 bash 셸에 영구적으로 추가한다</span>
<span class="nb">echo</span> <span class="s2">&quot;# k8s auto completion and alias&quot;</span> &gt;&gt; ~/.bashrc 
<span class="nb">echo</span> <span class="s2">&quot;source &lt;(kubectl completion bash)&quot;</span> &gt;&gt; ~/.bashrc 
<span class="nb">echo</span> <span class="s2">&quot;alias k=kubectl&quot;</span>  &gt;&gt; ~/.bashrc
<span class="nb">echo</span> <span class="s2">&quot;complete -F __start_kubectl k&quot;</span> &gt;&gt; ~/.bashrc
</pre></div>


<h3 id="5-etcd">5. etcd 설치</h3>
<p>기본적으로 내장 etcd 가 있지만, etcd-io 의 릴리즈로 설치 합니다.</p>
<p>다운로드 url : <a href="https://github.com/etcd-io/etcd/releases">클릭</a></p>
<div class="codehilite"><pre><span></span>wget https://github.com/etcd-io/etcd/releases/download/v3.3.18/etcd-v3.3.18-linux-amd64.tar.gz
tar -xf etcd-v3.3.18-linux-amd64.tar.gz
<span class="nb">cd</span> etcd-v3.3.18-linux-amd64

sudo <span class="nv">ETCDCTL_API</span><span class="o">=</span><span class="m">3</span> ./etcdctl --endpoints <span class="m">127</span>.0.0.1:2379 <span class="se">\</span>
--cacert /etc/kubernetes/pki/etcd/ca.crt <span class="se">\</span>
--cert /etc/kubernetes/pki/etcd/server.crt <span class="se">\</span>
--key /etc/kubernetes/pki/etcd/server.key <span class="se">\</span>
get / --prefix --keys-only 
</pre></div>


<h2 id="appendix-2-gke">Appendix 2. 구글 GKE 사용하기</h2>
<h4 id="1_1">1. 회원가입</h4>
<ul>
<li>$300 무료 크레딧 제공</li>
<li>신용카드 필요 (한도를 넘으도 자동 과금 안됨)</li>
<li>http://cloud.google.com 에서 회원 가입</li>
</ul>
<h4 id="2_1">2. 프로젝트 생성</h4>
<ul>
<li><kbd>프로젝트 선택</kbd> 을 클릭 합니다.</li>
</ul>
<p><img alt="프로젝트 선택" src="./img/GKE-project-int.png" /></p>
<ul>
<li><kbd>새 프로젝트</kbd> 를 클릭 합니다.</li>
</ul>
<p><img alt="" src="./img/GKE-project-choose.png" /></p>
<ul>
<li>프로젝트 이름에 원하는 값을 입력하고 <kbd>만들기</kbd> 클릭</li>
</ul>
<p><img alt="GKE-new-project" src="./img/GKE-new-project.png" /></p>
<h4 id="3_2">3. 쿠버네티스 클러스터 생성</h4>
<ul>
<li>홈메뉴 에서 <kbd> Kubernetes Engine </kbd> 클릭</li>
</ul>
<p><img alt="GKE-ngine-enter" src="./img/GKE-ngine-enter.png" /></p>
<ul>
<li>프로젝트를 선택하기 위해 <kbd> 프로젝트 선택</kbd> 클릭</li>
</ul>
<p><img alt="GKE-choose-project-for-create-cluster" src="./img/GKE-choose-project-for-create-cluster.png" /></p>
<ul>
<li>팝업창이 뜨면 프로젝트 gke-first 를 선택하고 <kbd> 열기 </kbd> 클릭</li>
</ul>
<p><img alt="GKE-open-project" src="./img/GKE-open-project.png" /></p>
<ul>
<li>1분정도 기다린 후에  <kbd> 클러스터 만들기 </kbd> 클릭</li>
</ul>
<p><img alt="" src="./img/GKE-create-cluster.png" /></p>
<ul>
<li>클러스터 기본사항 에서 영역을 "asia-east1-a" 로 선택 한후,   <kbd> 만들기</kbd> 클릭</li>
</ul>
<p><img alt="GKE-create-cluster-1" src="./img/GKE-create-cluster-1.png" /></p>
<ul>
<li>아래와 같이 k8s 클러스터를 생성 중인 화면이 나오면 정상 적으로 진행이 된 것입니다.</li>
</ul>
<p><img alt="GKE-cluster-complete" src="./img/GKE-cluster-complete.png" /></p>
<h4 id="4_2">4. 쿠버네티스 클러스터 접속 테스트</h4>
<ul>
<li>GKE 클러스터가 생성되면 <kbd> 연결 </kbd> 클릭</li>
</ul>
<p><img alt="GKE-cluster-connect-1" src="./img/GKE-cluster-connect-1.png" /></p>
<ul>
<li>팝업창이 뜨면 <kbd> Cloud Shell에서 실행 </kbd> 클릭</li>
</ul>
<p><img alt="GKE-cluster-connect-2" src="./img/GKE-cluster-connect-2.png" /></p>
<h2 id="appendix-3-git-sync">Appendix 3.  Git 계정 생성 및 Sync</h2>
<h3 id="1git">1.Git 계정생성</h3>
<p>www.github.com 에서 계정 생성</p>
<h3 id="2-git">2. Git 리포지토리 생성</h3>
<ul>
<li>GitHub.com 에 자신의 계정으로 로그인하여 아래 화면과 같이 리포지토리 생성</li>
</ul>
<p><img alt="" src="./img/git_repo_create.png" /></p>
<ul>
<li>리포지토리 이름을 아래와 같이 입력하고. 생성 합니다. (Repository name : k8s-web)</li>
</ul>
<p><img alt="git_repo_create_spec" src="./img/git_repo_create_spec.png" /></p>
<h3 id="3_3">3. 소스 파일 작성</h3>
<div class="codehilite"><pre><span></span>$ mkdir -p ./gitvolumn/html
$ mkdir -p ./gitvolumn/kubetmp
$ <span class="nb">cd</span> ./gitvolumn/html
$ vi index.html
</pre></div>


<p>index.html 이름으로 아래 페이지를 작성 합니다.</p>
<div class="codehilite"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>K8s Landing Page<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Hello Kubernetes !!!<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>


<h3 id="4-git">4. Git 리포지토리 생성 및 초기화</h3>
<div class="codehilite"><pre><span></span>$ git init
$ git add .
$ git commit -a -m <span class="s2">&quot;first commit&quot;</span>

$ git remote add origin https://github.com/&lt;계정명&gt;/k8s-web.git
$ git remote -v
$ git push origin master

$ git status
</pre></div>


<h2 id="appendix-4-persist-volume-ceph">Appendix 4. Persist Volume 서비스를 위한 Ceph 설치</h2>
<h3 id="1-ceph-worker01-worker02">1. Ceph 설치(worker01, worker02)</h3>
<div class="codehilite"><pre><span></span>$ apt-cache search ceph

$ apt install ceph
</pre></div>
            </div>
        </div>

        <div id="generated-at">
        Generated at: 2020-04-20 03:34:39
    </div>
            

        <div id="footer">
            Powered by
            <a href="https://github.com/menduo/mdtree" target="_blank"
                title="https://github.com/menduo/mdtree">
                https://github.com/menduo/mdtree
            </a>
        </div>
</div>
</body>

<script>

</script>


</html>

